
<!DOCTYPE html>

<html>
<head><meta content="noindex,nofollow" name="robots"/>
<title>The decorator module version 3 is out!</title>
<meta charset="utf-8"/>
<meta content="Michele Simionato" name="author">
<link href="../_/https/www.artima.com/artima.css" rel="stylesheet" type="text/css"/>
<link href="../_/https/www.artima.com/favicon.ico" rel="shortcut icon"/>
</meta></head>
<body><table cellspacing="0" width="100%">
<tr>
<td align="left" valign="bottom">
<a href="../_/https/www.artima.com/index.html"><img alt="The Artima Developer Community" border="0" height="43" src="../_/https/www.artima.com/images/a7.gif" width="550"/></a>
</td>
</tr></table>
<table bgcolor="#333333" width="100%">
<tr>
<td align="center">
<div class="ml">
<a class="hl" href="../_/https/www.artima.com/articles/index.html">Articles</a> |
<a class="hl" href="../_/https/www.artima.com/news/index.html">News</a> |
<a class="hl" href="../index.html">Weblogs</a> |
<a class="hl" href="../_/https/www.artima.com/shop/catalog/index.html">Books</a> |
<a class="hl" href="../_/https/www.artima.com/forums/index.html">Forums</a>
</div>
</td>
</tr>
</table>
<table bgcolor="#CCCCCC" width="100%">
<tr>
<td align="center">
<div class="sc">
<a href="../index.html">Artima Weblogs</a> | 

<a href="../index.html$/blogger=micheles.html">Michele Simionato's Weblog</a> | 

<a href="../_/https/www.artima.com/forums/flat.html$/forum=106&amp;thread=245050.html">Discuss</a> | 
<a href="mailto:?subject=The decorator module version 3 is out!&amp;body= %0AArtima Weblogs %0AThe decorator module version 3 is out! %0Aby Michele Simionato %0A%0Ahttps://www.artima.com/weblogs/viewpost.jsp?thread=245050">Email</a> | 
<a href="../viewpostP.html$/thread=245050.html">Print</a> | 
<a href="../bloggers.html">Bloggers</a> | 
<a class="sl" href="thread=243843.html" title="What about a decorator module version 3.0?">Previous</a> | 
<a class="sl" href="thread=246341.html" title="Mixins considered harmful/1">Next</a>
</div>
</td>
</tr>
</table>
<table bgcolor="#EEEEEE" width="100%">
<tr>
<td align="center">
<div class="sc">
<span style="color: #555555;">Sponsored Link</span> <span style="color: #888888;">•</span>
<script language="JavaScript" src="../_/https/www.artima.com/zcr/adx.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
   if (!document.phpAds_used) document.phpAds_used = ',';
   phpAds_random = new String (Math.random()); phpAds_random = phpAds_random.substring(2,11);
   
   document.write ("<" + "script language='JavaScript' type='text/javascript' src='");
   document.write ("../_/https/www.artima.com/zcr/adjs.html$/n=.html" + phpAds_random);
   document.write ("&amp;what=zone:9&amp;target=_top");   document.write ("&amp;exclude=" + document.phpAds_used);
   if (document.referrer)
      document.write ("&amp;referer=" + escape(document.referrer));
   document.write ("'><" + "/script>");
//-->
</script><noscript><a href="../_/https/www.artima.com/zcr/adclick.html$/n=a799ecf6.html" target="_top"><img alt="" border="0" src="../_/https/www.artima.com/zcr/adview.html$/what=zone:9&amp;n=a0587811.html"/></a></noscript>
</div>
</td>
</tr>
</table>
<br/>
<div class="vegies">
<div class="tc">
<span class="sts">The Explorer</span><br>
<span class="ts">The decorator module version 3 is out!</span><br/>
<span class="as">by Michele Simionato</span><br/>
<span class="pd">December 14, 2008</span><br/>
</br></div>
<blockquote>
<b>Summary</b><br/>
After a few weeks of work, version 3 of the decorator module is finally out. The new version is a major rewrite of the original implementation, lots of things have been improved under the hood, and the documentation has had a major overhaul too. The module is hosted on the PyPI site: http://pypi.python.org/pypi/decorator.

</blockquote>
<hr align="left" width="90%"/>
<table align="right">
<tr>
<td>
<div class="adnotice">
Advertisement
</div>
<center>
<script language="JavaScript" src="../_/https/www.artima.com/zcr/adx.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
if (!document.phpAds_used) document.phpAds_used = ',';
phpAds_random = new String (Math.random()); phpAds_random = phpAds_random.substring(2,11);
document.write ("<" + "script language='JavaScript' type='text/javascript' src='");
document.write ("../_/https/www.artima.com/zcr/adjs.html$/n=.html" + phpAds_random);
document.write ("&amp;what=zone:2");
document.write ("&amp;exclude=" + document.phpAds_used);
if (document.referrer)
document.write ("&amp;referer=" + escape(document.referrer));
document.write ("'><" + "/script>");
//-->
</script><noscript><a href="../_/https/www.artima.com/zcr/adclick.html$/n=a74ab060.html" target="_blank"><img alt="" border="0" src="../_/https/www.artima.com/zcr/adview.html$/what=zone:2&amp;n=a74ab060.html"/></a></noscript>
</center>
</td>
</tr>
</table>
<p>
<p>This post is intended for users of <a class="reference" href="../_/http/www.phyast.pitt.edu/~micheles/python/documentation.html">old versions of the decorator
module</a> who want to know what's new and the reasons for the change.
Version 3 is a major release and it breaks compatibility with the past
in a minor way, but I expect 99.9% of my users to upgrade
to the new version without seeing any difference. You can download
the tarball <a class="reference" href="../_/http/pypi.python.org/packages/source/d/decorator/decorator-3.0.0.tar.gz">here</a>.</p>
<p>Here is a list of the most relevant changes/improvements.</p>
<ul class="simple">
<li>I have completed the move to PyPI. For a long time I have wanted to
move the package from my site (which is hosted on the Pittsburgh
University servers and completely out of my control) to PyPI. The
first version to be hosted on PyPI was version 2.3.2, released two
weeks ago. The impressive thing - to me, at least - is that I had 1008
downloads in thirteen days: incredible! I have no idea of how many
downloads I had for the previous versions, so I cannot compare, but
from now on I can have an idea of the popularity of the module.
That's good. The move to PyPI was not complete however, since, the
documentation for the module was still hosted on my site.
With version 3.0, instead, everything is hosted on PyPI.</li>
<li>The documentation now is extracted from a Python file containing lots
of doctests, following an approach that I have called <em>geek publishing</em>
and that I have described here:
<a class="reference" href="../_/http/stacktrace.it/2008/01/geek-publishing/index.html">http://stacktrace.it/2008/01/geek-publishing/</a> (I intend to translate
that article and to republish it here soon or later).
That means that all the examples provided are doctested by using the
standard Python module: I do not need to supplement a custom
doctester script as I did in the past. The documentation is extracted
by using a custom script, by I do not need to distribute it, I have
just included in the tarball the generated .html and .pdf files.</li>
<li>I have substantially modified the documentation. Various sections have
been removed. In particular the examples <tt class="docutils literal"><span class="pre">redirecting_stdout</span></tt> and
<tt class="docutils literal"><span class="pre">locked</span></tt> are no more there, since the functionality is better implemented
by using the <tt class="docutils literal"><span class="pre">with</span></tt> statement instead of a decorator. At the time of
the first version of the module, in early 2005, those
examples were good examples, but Python has changed in the meanwhile. You can
still find them in the old documentation of the module, which
will stay on my personal site for the foreseeable future:
<a class="reference" href="../_/http/www.phyast.pitt.edu/~micheles/python/documentation.html">http://www.phyast.pitt.edu/~micheles/python/documentation.html</a>.
The example of a permission system based on decorators has been
removed because the documentation is already quite long (the PDF
version takes 18 pages).</li>
<li>Various examples have been substantially improved. For instance,
the new implementation of the <tt class="docutils literal"><span class="pre">memoize</span></tt> decorator if much nicer
than the old one, and it is easier to compare the approach suggested
by the <tt class="docutils literal"><span class="pre">decorator</span></tt> module with the approach suggested by the
standard library, i.e. <tt class="docutils literal"><span class="pre">functool.update_wrapper</span></tt> trick. The <tt class="docutils literal"><span class="pre">delayed</span></tt>
decorator example has been removed: instead a much more interesting
<tt class="docutils literal"><span class="pre">async</span></tt> decorator has been added, showing how to run a blocking
function in a separated thread or process.</li>
<li>The utility functions <tt class="docutils literal"><span class="pre">new_wrapper</span></tt> and <tt class="docutils literal"><span class="pre">get_info</span></tt> have been
deprecated, since they were little used. Their job can be better
performed by the new class <tt class="docutils literal"><span class="pre">FunctionMaker</span></tt>, which is the building
block over which <tt class="docutils literal"><span class="pre">decorator</span></tt> is implemented. That allows you to define
your own custom version of <tt class="docutils literal"><span class="pre">decorator</span></tt>, if you really want.</li>
<li>There was a long standing issue with the decorator module, i.e. the
problem of extracting the source code from a decorated function.
Version 3.0 gives a workaround. It adds an attribute <tt class="docutils literal"><span class="pre">.undecorated</span></tt>
to the decorated function, a reference to the original function,
so that you can get the wanted source code with the trick
<tt class="docutils literal"><span class="pre">inspect.getsource(func.undecorated)</span></tt>. This is actually possible
even in version 2.3, but it was (intentionally) left undocumented,
since I hoped in a better solution such as a patch to the <tt class="docutils literal"><span class="pre">inspect</span></tt>
module. However, the fix did not make it through Python 2.6 and 3.0, so
I have decided to document the workaround for the time being.</li>
<li>The <tt class="docutils literal"><span class="pre">decorator</span></tt> function has been extended and now it may take one or
two arguments. <tt class="docutils literal"><span class="pre">decorator(caller)</span></tt> still returns a decorator, as before,
but now you can also use the syntax <tt class="docutils literal"><span class="pre">decorator(caller,</span> <span class="pre">func)</span></tt> which
returns directly the decorated function; <tt class="docutils literal"><span class="pre">decorator(caller,</span> <span class="pre">func)</span></tt> is
akin to <tt class="docutils literal"><span class="pre">decorator(caller)(func)</span></tt> but more efficient. The new syntax
made possible to simplify many examples and I could remove the explicit
support for <a class="reference" href="../_/http/www.phyast.pitt.edu/~micheles/python/documentation.html#class-decorators-and-decorator-factories">decorator factories</a> which I added in haste in version 2.3
and I regretted pretty soon.</li>
</ul>
<p>There are also a few considerations I would like to make.</p>
<p>From the start the <tt class="docutils literal"><span class="pre">decorator</span></tt> module was developed with the
attitude of <em>teach a man to fish</em>: instead of providing a large
API, I have provided a significant collections of examples and recipes.
The idea is that you should be able to write your own decorators by
yourselves. Version 3 of the module
is going even more in that direction.</p>
<p>I have refactored the internals
so that now you can not only write you decorators on your own, but
you can also write your own decorator facility - the equivalent of
<tt class="docutils literal"><span class="pre">decorator</span></tt> - by means of the <tt class="docutils literal"><span class="pre">FunctionMaker</span></tt> class.
At the same time the rewriting makes the module more of a library
and less of a framework. For instance, in past versions you were forced
to write your decorators in terms of caller functions with the signature
<tt class="docutils literal"><span class="pre">caller(f,</span> <span class="pre">*args,</span> <span class="pre">**kw)</span></tt>; now you can write your own decorator
framework and use the conventions you like. In the documentation I
give the example of <tt class="docutils literal"><span class="pre">decorator_apply</span></tt>, which is able to convert
third party decorators into signature preserving decorators without
rewriting them.</p>
<p>I did not expect the <tt class="docutils literal"><span class="pre">decorator</span></tt> module to leave so long (it is
nearly four years old already). In my original intentions, the module
was intended to be provisional, a workaround that should have been dropped
once better support for decorators entered in the standard library.
Unfortunately that never happened. It is true that Python 2.5 added
some support for decorators in the <tt class="docutils literal"><span class="pre">functools</span></tt> module, but that
support is insufficient in my opinion. Also, I had great hopes for
the <em>Function Signature Object</em> (<a class="reference" href="../_/http/www.python.org/dev/peps/pep-0362/index.html">PEP 362</a>) but after more than two
years nothing happened.
I still hope it will become possible to change the signature of functions
in future versions of Python: when that will happen, the <tt class="docutils literal"><span class="pre">decorator</span></tt>
module will become obsolete and I will have less code to maintain.</p>
<p>Finally, I have a couple of questions for you, PyPI experts.
Is there a simple way to
remove the annoying excessive vertical space in the PyPI style-sheet?
Look at <a class="reference" href="../_/http/pypi.python.org/pypi/decorator/index.html">http://pypi.python.org/pypi/decorator</a> to see what I am
referring to. I have uploaded the documentation simply by inserting
raw XHTML into the <tt class="docutils literal"><span class="pre">long_description</span></tt> field of the <tt class="docutils literal"><span class="pre">setup.py</span></tt>
script and running <tt class="docutils literal"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">register</span></tt>. It worked but it is
kind of a hack. I see that there is the possibility to upload the
documentation as a zip file, labeled as experimental feature.
I tried it by hand and it works, but I
would like to know if there is a way to perform the upload
automatically, with some option in the <tt class="docutils literal"><span class="pre">setup.py</span></tt> script.</p>
<!-- http://pypi.python.org/pypi/decorator -->
<h1>Talk Back!</h1>
<p>
Have an opinion?


Readers have already posted

<a href="../_/https/www.artima.com/forums/flat.html$/forum=106&amp;thread=245050.html">2

comments</a>
about this weblog entry. Why not

<a href="../_/https/www.artima.com/forums/post.html$/forum=106&amp;thread=245050&amp;reply=true.html">add yours</a>?


<h1>RSS Feed</h1>
<p>
If you'd like to be notified whenever Michele Simionato adds a new entry to <a href="../index.html$/blogger=micheles.html">his weblog</a>, subscribe to his <a href="../feeds/bloggers/micheles.rss">RSS feed</a>.

<center>
<div class="sociallinks">
<a href="../_/http/digg.com/submit$/phase=2&amp;url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D245050&amp;title=The+decorator+module+version+3+is+out%21&amp;bodytext=After+a+few+weeks+of+work%2C+version+3+of+the+decorator+module+is+finally+out.+The+new+version+is+a+major+rewrite+of+the+original+implementation%2C+lots+of+things+have+been+improved+under+the+hood%2C+and+the+documentation+has+had+a+major+overhaul+too.+The+_&amp;topic=programming">
<img alt="Digg" border="0" height="14" hspace="8" src="../_/https/www.artima.com/images/digg.gif" width="16">Digg
  </img></a>
  |
  <a href="../_/http/del.icio.us/post$/url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D245050&amp;title=The+decorator+module+version+3+is+out%21">
<img alt="del.icio.us" border="0" height="16" hspace="8" src="../_/https/www.artima.com/images/delicious.gif" vspace="1" width="16">del.icio.us
  </img></a>
  |
  <a href="../_/http/programming.reddit.com/submit$/url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D245050&amp;title=The+decorator+module+version+3+is+out%21">
<img alt="Reddit" border="0" height="18" hspace="8" src="../_/https/www.artima.com/images/reddit.gif" width="18"/>Reddit
  </a>
</div>
</center>
<h1>About the Blogger</h1>
<p>
<table><tr valign="bottom"><td><img align="right" src="../_/https/www.artima.com/images/micheleSimionato.jpg"/></td><td>Michele Simionato started his career as a Theoretical Physicist, working in Italy, France and the U.S. He turned to programming in 2003; since then he has been working professionally as a Python developer and now he lives in Milan, Italy. Michele is well known in the Python community for his posts in the newsgroup(s), his articles and his Open Source libraries and recipes. His interests include object oriented programming, functional programming, and in general programming metodologies that enable us to manage the complexity of modern software developement.</td></tr></table><p>
<div class="sp">This weblog entry is Copyright © 2008 Michele Simionato. All rights reserved.</div>
</p></p></p></p></p></div>

<hr width="100%">
<table align="center" width="50%">
<tr>
<td>
<div class="horizontaltextadbox">
<div class="adheadline">Sponsored Links</div>
<div id="sponsoredlinks">
</div>
</div>
</td>
</tr>
</table>
<hr width="100%"/>
<center>
<script type="text/javascript"><!--
google_ad_client = "pub-3911176865765226";
google_alternate_color = "ffffff";
google_ad_width = 728;
google_ad_height = 15;
google_ad_format = "728x15_0ads_al";
google_ad_channel = "";
google_color_border = "ffffff";
google_color_bg = "FFFFFF";
google_color_link = "003090";
google_color_text = "000000";
google_color_url = "666666";
//--></script>
<script src="../_/https/pagead2.googlesyndication.com/pagead/show_ads.js" type="text/javascript">
</script>
<br>
<br/>
<!-- SiteSearch Google -->
<form action="../_/https/www.google.com/custom/index.html" method="get">
<table bgcolor="#ffffff" border="0">
<tr><td align="left" height="32" nowrap="nowrap" valign="top">
<a href="../_/https/www.google.com/index.html">
<img alt="Google" border="0" src="../_/https/www.google.com/logos/Logo_25wht.gif"/></a>
</td>
<td nowrap="nowrap">
<input name="domains" type="hidden" value="Artima.com"/>
<input maxlength="255" name="q" size="31" type="text" value=""/>
<input name="sa" type="submit" value="Search"/>
</td></tr>
<tr>
<td> </td>
<td nowrap="nowrap">
<font color="#000000" size="-1">
<input name="sitesearch" type="radio" value=""/> Web
<input checked="checked" name="sitesearch" type="radio" value="Artima.com"/>Artima.com
</font>  
<input name="client" type="hidden" value="pub-3911176865765226"/>
<input name="forid" type="hidden" value="1"/>
<input name="ie" type="hidden" value="ISO-8859-1"/>
<input name="oe" type="hidden" value="ISO-8859-1"/>
<input name="cof" type="hidden" value="GALT:#008000;GL:1;DIV:#336699;VLC:663399;AH:center;BGC:FFFFFF;LBGC:FFFFFF;ALC:0000FF;LC:0000FF;T:000000;GFNT:0000FF;GIMP:0000FF;LH:50;LW:150;L:https://www.artima.com/images/artima150.gif;S:https://www.artima.com;FORID:1;"/>
<input name="hl" type="hidden" value="en"/>
</td></tr></table>
</form>
<!-- SiteSearch Google -->
</br></center>
<br/>
<div class="sp">
<div style="text-align: center;">
<a href="../_/https/www.artima.com/copyright.html">Copyright</a> © 1996-2019 Artima, Inc. All Rights Reserved. - <a href="../_/https/www.artima.com/privacy.html">Privacy Policy</a> - <a href="../_/https/www.artima.com/termsofuse.html">Terms of Use</a>
</div>
</div>
<br/>
<script language="JavaScript" type="text/javascript">
<!--
function initBannerVarForZone(zone) {
        initBannerVarForZoneWithScript(zone, 'adjs_modified');
}

function initBannerVarForZoneWithScript(zone, phpScript) {

        if (!document.phpAds_used) document.phpAds_used = ',';
        phpAds_random = new String (Math.random());
        phpAds_random = phpAds_random.substring(2,11);

        var nextScriptSrc = '../_/https/www.artima.com/zcr/index.html' + phpScript + '.php?n=' +
                phpAds_random  +
                '&amp;what=zone:' + zone + '&amp;target=_top&amp;block=1&amp;blockcampaign=1' +
                '&amp;exclude=' + document.phpAds_used;

        document.write("<script language='JavaScript' type='text/javascript' src='");
        document.write(nextScriptSrc);
        document.write("'><\/script>");

}

function replaceDiv(divID) {
        document.getElementById(divID).innerHTML = phpadsbanner;
}
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
initBannerVarForZone(3);
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
replaceDiv('leftskyscraper');
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
initBannerVarForZoneWithScript(4, 'textman');
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
replaceDiv('sponsoredlinks');
-->
</script>
</hr><a href="https://dafoster.net/projects/crystal-web-archiver/" id="cr-footer-banner" style="border-top: 2px #B40010 solid;background: #FFFAE1;font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;font-variant: initial;font-weight: initial;text-transform: none;font-size: 14px;color: #6c757d;line-height: 2.0;cursor: pointer;display: flex;align-items: center;justify-content: center;gap: 4px;clear: both;" target="_blank"><img height="24" onerror="this.style['display'] = 'none';" src="../_/crystal/resources/appicon.png" width="24"/><span>This page was archived with Crystal</span><script>window.addEventListener('load', function() { const $1 = document.querySelector('#cr-footer-banner'); if (!$1) { return; } if (window !== window.top) { let $2 = false; if (window.name) { const $3 = window.parent.document.getElementsByName(window.name); if ($3.length === 1) { const $4 = $3[0]; if ($4.tagName === 'FRAME' && $4.parentElement.tagName === 'FRAMESET') { let $5 = $4; while (true) { if ($5.parentElement.tagName !== 'FRAMESET') { $2 = true; break; } if ($5.parentElement.attributes['rows'] !== undefined) { const $6 = $5.parentElement.children; if ($5 === $6[$6.length - 1]) { $5 = $5.parentElement; continue; } else { break; } } else if ($5.parentElement.attributes['cols'] !== undefined) { const $7 = Array.from($5.parentElement.children); const $8 = $7.indexOf($5); if ($8 === -1) { break; } const $9 = $5.parentElement.attributes['cols'].value.split(','); const $10 = $9.map((s) => parseInt(s.trim())); if ($9[$8].trim() === '*' || $10[$8] === Math.max.apply(null, $10)) { $5 = $5.parentElement; continue; } else { break; } } else { break; } } } } } if (!$2) { $1.style['display'] = 'none'; } } const $11 = $1.getBoundingClientRect(); const $12 = ($11.y < window.innerHeight - $11.height); if ($12) { $1.style['position'] = 'fixed'; $1.style['bottom'] = '0'; $1.style['left'] = '0'; $1.style['right'] = '0'; $1.style['z-index'] = '9999'; } const $13 = ( document.body.getBoundingClientRect().height < $11.height * 2 ); if ($13) { $1.style['display'] = 'none'; }
});</script></a></body>
</html>
