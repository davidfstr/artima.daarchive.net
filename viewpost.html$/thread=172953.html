
<!DOCTYPE html>

<html>
<head><meta content="noindex,nofollow" name="robots"/>
<title>Subduing CLASSPATH</title>
<meta charset="utf-8"/>
<meta content="Bruce Eckel" name="author">
<link href="../_/https/www.artima.com/artima.css" rel="stylesheet" type="text/css"/>
<link href="../_/https/www.artima.com/favicon.ico" rel="shortcut icon"/>
</meta></head>
<body><table cellspacing="0" width="100%">
<tr>
<td align="left" valign="bottom">
<a href="../_/https/www.artima.com/index.html"><img alt="The Artima Developer Community" border="0" height="43" src="../_/https/www.artima.com/images/a7.gif" width="550"/></a>
</td>
</tr></table>
<table bgcolor="#333333" width="100%">
<tr>
<td align="center">
<div class="ml">
<a class="hl" href="../_/https/www.artima.com/articles/index.html">Articles</a> |
<a class="hl" href="../_/https/www.artima.com/news/index.html">News</a> |
<a class="hl" href="../index.html">Weblogs</a> |
<a class="hl" href="../_/https/www.artima.com/shop/catalog/index.html">Books</a> |
<a class="hl" href="../_/https/www.artima.com/forums/index.html">Forums</a>
</div>
</td>
</tr>
</table>
<table bgcolor="#CCCCCC" width="100%">
<tr>
<td align="center">
<div class="sc">
<a href="../index.html">Artima Weblogs</a> | 

<a href="../index.html$/blogger=beckel.html">Bruce Eckel's Weblog</a> | 

<a href="../_/https/www.artima.com/forums/flat.html$/forum=106&amp;thread=172953.html">Discuss</a> | 
<a href="mailto:?subject=Subduing CLASSPATH&amp;body= %0AArtima Weblogs %0ASubduing CLASSPATH %0Aby Bruce Eckel %0A%0Ahttps://www.artima.com/weblogs/viewpost.jsp?thread=172953">Email</a> | 
<a href="../viewpostP.html$/thread=172953.html">Print</a> | 
<a href="../bloggers.html">Bloggers</a> | 
<a class="sl" href="thread=170038.html" title="The Web Frameworks Jam and Turbogears">Previous</a> | 
<a class="sl" href="thread=175595.html" title="Ruby and Scala">Next</a>
</div>
</td>
</tr>
</table>
<table bgcolor="#EEEEEE" width="100%">
<tr>
<td align="center">
<div class="sc">
<span style="color: #555555;">Sponsored Link</span> <span style="color: #888888;">•</span>
<script language="JavaScript" src="../_/https/www.artima.com/zcr/adx.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
   if (!document.phpAds_used) document.phpAds_used = ',';
   phpAds_random = new String (Math.random()); phpAds_random = phpAds_random.substring(2,11);
   
   document.write ("<" + "script language='JavaScript' type='text/javascript' src='");
   document.write ("../_/https/www.artima.com/zcr/adjs.html$/n=.html" + phpAds_random);
   document.write ("&amp;what=zone:9&amp;target=_top");   document.write ("&amp;exclude=" + document.phpAds_used);
   if (document.referrer)
      document.write ("&amp;referer=" + escape(document.referrer));
   document.write ("'><" + "/script>");
//-->
</script><noscript><a href="../_/https/www.artima.com/zcr/adclick.html$/n=a799ecf6.html" target="_top"><img alt="" border="0" src="../_/https/www.artima.com/zcr/adview.html$/what=zone:9&amp;n=a0587811.html"/></a></noscript>
</div>
</td>
</tr>
</table>
<br/>
<div class="vegies">
<div class="tc">
<span class="sts">Computing Thoughts</span><br>
<span class="ts">Subduing CLASSPATH</span><br/>
<span class="as">by Bruce Eckel</span><br/>
<span class="pd">August 21, 2006</span><br/>
</br></div>
<blockquote>
<b>Summary</b><br/>
Setting CLASSPATH for directories and jars driving you crazy? I finally decided to do something about it.

</blockquote>
<hr align="left" width="90%"/>
<table align="right">
<tr>
<td>
<div class="adnotice">
Advertisement
</div>
<center>
<script language="JavaScript" src="../_/https/www.artima.com/zcr/adx.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
if (!document.phpAds_used) document.phpAds_used = ',';
phpAds_random = new String (Math.random()); phpAds_random = phpAds_random.substring(2,11);
document.write ("<" + "script language='JavaScript' type='text/javascript' src='");
document.write ("../_/https/www.artima.com/zcr/adjs.html$/n=.html" + phpAds_random);
document.write ("&amp;what=zone:2");
document.write ("&amp;exclude=" + document.phpAds_used);
if (document.referrer)
document.write ("&amp;referer=" + escape(document.referrer));
document.write ("'><" + "/script>");
//-->
</script><noscript><a href="../_/https/www.artima.com/zcr/adclick.html$/n=a74ab060.html" target="_blank"><img alt="" border="0" src="../_/https/www.artima.com/zcr/adview.html$/what=zone:2&amp;n=a74ab060.html"/></a></noscript>
</center>
</td>
</tr>
</table>
<p>
The answer is some heavy-handed automation and convention. First, why bother trying to put files in the jre\lib\ext directory? Last I heard, there was some kind of security issue so it's prevented, maybe, in some cases. I don't want to have to know what those cases are.

<p>Besides, you have to click down a bunch of directories to find jre\lib\ext, and at least on my system there always seems to end up being two of them, one for the JDK and one for the JRE, and half the time I put it in the wrong place. Too confusing, too much effort.

<p>How about if all jar files just go in a directory called C:\jar? I don't think that will hurt anything, and it will be much easier to manage. Also, if you need to move your setup from your desktop to your laptop, all you have to do is copy that directory.

<p>Well, almost. The other problem is that every time you add a new jar or a new directory to the CLASSPATH, you have to go in and set the environment variables on my computer, editing a really long line in a little tiny window. I'll be happy if I don't have to do that again.

<p>Also, it's very easy to get incorrect and old, nonexistent elements in your CLASSPATH. I'd like that to be automatically fixed, as well.

<p>Conveniently, Python is very good at all kinds of file and directory stuff. But even better, it has the <b>_winreg</b> module (as part of the standard Python distribution), which allows you to directly modify the registry.

<p>The following program pulls your current CLASSPATH from the registry (so there are no problems if the CLASSPATH has been temporarily changed for one command window), removes duplicates and dead links, and then does one of three things:
<ol>
<li>If there are jar files in the current directory and you don't provide command-line arguments, all the jar files are added to your CLASSPATH.
<li>If there are no jar files in the current directory, that directory is added to the CLASSPATH.
<li>If you provide command-line arguments, those are assumed to be jar files and added to the classpath.
</li></li></li></ol>
<p>So if you put this program in your C:\jars directory, every time you throw in a new jar file you can just double-click it to add that jar to your CLASSPATH. Should make hand-installation a lot simpler!

<p>Finally, this might be the ideal solution for beginners and classroom situations, where lots of time is lost struggling with silly CLASSPATH issues.

<p>I got most of the information about how to do this by googling for it, but 
<a href="../_/http/aspn.activestate.com/ASPN/Cookbook/Python/Recipe/416087/index.html">this article</a> was especially helpful.

<pre><b>
#!python
"""
SetClasspath.py by Bruce Eckel, 2006 www.MindView.net
Permission granted for free use and distribution as long as this notice is maintained.

Warning! This program modifies the Windows Registry! Use at your own risk.

With no arguments:
    If there are jar files in the current directory, each one is added to the CLASSPATH.
    If there are no jar files, the current directory is added to the CLASSPATH.

With arguments:
    Each argument must be a jar file name. Each argument is added to the CLASSPATH.

Duplicate CLASSPATH entries and nonexistent paths are removed.

I recommend creating C:\jars directory, and adding this program to that directory.
Whenever you need to add a new jar, throw it in C:\jars and double-click this program.
That way, if you need the same set of jars on another machine, just copy the
directory and run this program.

It's also useful to create a batch/cmd file to run this program, and to place
that file in your Windows PATH. Then you can run the program from any directory.
The batch file might look like this:
python C:\jars\SetClassPath.py %1 %2 %3 %4 %5 %6 %7 %8 %9
If you're running Cygwin, you can make a shell file to do the same thing:
python C:/jars/SetClassPath.py $1 $2 $3 $4 $5 $6 $7 $8 $9

This program requires PythonWin, which you can find at:
http://starship.python.net/crew/mhammond/win32/
"""
from _winreg import *
import os, glob, sys
import win32gui, win32con # From PythonWin
path = r'SYSTEM\CurrentControlSet\Control\Session Manager\Environment'

def getClassPath():
    try:
        reg = ConnectRegistry(None, HKEY_LOCAL_MACHINE)
        key = OpenKey(reg, path, 0, KEY_ALL_ACCESS)
        i = 0
        while True:
            try:
                name, value, valueType = EnumValue(key, i)
                if name == 'CLASSPATH':
                    return value
                i += 1
            except EnvironmentError:
                return ""
    finally:
        CloseKey(key)
        CloseKey(reg)

def setClassPath(newPath):
    try:
        reg = ConnectRegistry(None, HKEY_LOCAL_MACHINE)
        key = OpenKey(reg, path, 0, KEY_ALL_ACCESS)
        SetValueEx(key, 'CLASSPATH', 0, REG_SZ, newPath)
        win32gui.SendMessage(win32con.HWND_BROADCAST, win32con.WM_SETTINGCHANGE, 0, 'Environment')
    finally:
        CloseKey(key)
        CloseKey(reg)

if __name__=='__main__':
    # set prevents duplicates, 'if os.path.exists(p)' prunes nonexistent paths:
    pathparts = set([p for p in getClassPath().split(os.pathsep) if os.path.exists(p)])
    pathparts.add(".")
    pathparts.add("..")
    if len(sys.argv) &gt; 1:
        for arg in sys.argv[1:]:
            if not arg.endswith(".jar"):
                print "Arguments must be jar file names: problem with [" + arg + "]"
                sys.exit(1)
            if not os.path.exists(arg):
                print arg, "does not exist in this directory"
                sys.exit(1)
            pathparts.add(os.path.abspath(arg))
    else:
        jars = glob.glob("*.jar")
        if jars:
            for jar in jars:
                pathparts.add(os.path.abspath(jar))
        else:
            pathparts.add(os.getcwd())
    result = list(pathparts)
    result.sort()
    newClasspath = os.pathsep.join(result) + os.pathsep
    setClassPath(newClasspath)
    print getClassPath()
</b></pre>
<p>If there's a Linuxphile among you who would like to add a Linux (and presumably OSX would work for free) option to the above program, I'd love to incorporate that.

<h1>Talk Back!</h1>
<p>
Have an opinion?


Readers have already posted

<a href="../_/https/www.artima.com/forums/flat.html$/forum=106&amp;thread=172953.html">26

comments</a>
about this weblog entry. Why not

<a href="../_/https/www.artima.com/forums/post.html$/forum=106&amp;thread=172953&amp;reply=true.html">add yours</a>?


<h1>RSS Feed</h1>
<p>
If you'd like to be notified whenever Bruce Eckel adds a new entry to <a href="../index.html$/blogger=beckel.html">his weblog</a>, subscribe to his <a href="../feeds/bloggers/beckel.rss">RSS feed</a>.

<center>
<div class="sociallinks">
<a href="../_/http/digg.com/submit$/phase=2&amp;url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D172953&amp;title=Subduing+CLASSPATH&amp;bodytext=Setting+CLASSPATH+for+directories+and+jars+driving+you+crazy%3F+I+finally+decided+to+do+something+about+it.&amp;topic=programming">
<img alt="Digg" border="0" height="14" hspace="8" src="../_/https/www.artima.com/images/digg.gif" width="16">Digg
  </img></a>
  |
  <a href="../_/http/del.icio.us/post$/url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D172953&amp;title=Subduing+CLASSPATH">
<img alt="del.icio.us" border="0" height="16" hspace="8" src="../_/https/www.artima.com/images/delicious.gif" vspace="1" width="16">del.icio.us
  </img></a>
  |
  <a href="../_/http/programming.reddit.com/submit$/url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D172953&amp;title=Subduing+CLASSPATH">
<img alt="Reddit" border="0" height="18" hspace="8" src="../_/https/www.artima.com/images/reddit.gif" width="18"/>Reddit
  </a>
</div>
</center>
<h1>About the Blogger</h1>
<p>
<table><tr valign="bottom"><td><img align="right" src="../_/https/www.artima.com/images/bruceeckel.jpg"/></td><td>Bruce Eckel (<a href="../_/http/www.bruceeckel.com/index.html">www.BruceEckel.com</a>) provides development assistance in Python with user interfaces in Flex. He is the author of Thinking in Java (Prentice-Hall, 1998, 2nd Edition, 2000, 3rd Edition, 2003, 4th Edition, 2005), the Hands-On Java Seminar CD ROM (available on the Web site), Thinking in C++ (PH 1995; 2nd edition 2000, Volume 2 with Chuck Allison, 2003), C++ Inside &amp; Out (Osborne/McGraw-Hill 1993), among others. He's given hundreds of presentations throughout the world, published over 150 articles in numerous magazines, was a founding member of the ANSI/ISO C++ committee and speaks regularly at conferences.</td></tr></table><p>
<div class="sp">This weblog entry is Copyright © 2006 Bruce Eckel. All rights reserved.</div>
</p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></div>

<hr width="100%">
<table align="center" width="50%">
<tr>
<td>
<div class="horizontaltextadbox">
<div class="adheadline">Sponsored Links</div>
<div id="sponsoredlinks">
</div>
</div>
</td>
</tr>
</table>
<hr width="100%"/>
<center>
<script type="text/javascript"><!--
google_ad_client = "pub-3911176865765226";
google_alternate_color = "ffffff";
google_ad_width = 728;
google_ad_height = 15;
google_ad_format = "728x15_0ads_al";
google_ad_channel = "";
google_color_border = "ffffff";
google_color_bg = "FFFFFF";
google_color_link = "003090";
google_color_text = "000000";
google_color_url = "666666";
//--></script>
<script src="../_/https/pagead2.googlesyndication.com/pagead/show_ads.js" type="text/javascript">
</script>
<br>
<br/>
<!-- SiteSearch Google -->
<form action="../_/https/www.google.com/custom/index.html" method="get">
<table bgcolor="#ffffff" border="0">
<tr><td align="left" height="32" nowrap="nowrap" valign="top">
<a href="../_/https/www.google.com/index.html">
<img alt="Google" border="0" src="../_/https/www.google.com/logos/Logo_25wht.gif"/></a>
</td>
<td nowrap="nowrap">
<input name="domains" type="hidden" value="Artima.com"/>
<input maxlength="255" name="q" size="31" type="text" value=""/>
<input name="sa" type="submit" value="Search"/>
</td></tr>
<tr>
<td> </td>
<td nowrap="nowrap">
<font color="#000000" size="-1">
<input name="sitesearch" type="radio" value=""/> Web
<input checked="checked" name="sitesearch" type="radio" value="Artima.com"/>Artima.com
</font>  
<input name="client" type="hidden" value="pub-3911176865765226"/>
<input name="forid" type="hidden" value="1"/>
<input name="ie" type="hidden" value="ISO-8859-1"/>
<input name="oe" type="hidden" value="ISO-8859-1"/>
<input name="cof" type="hidden" value="GALT:#008000;GL:1;DIV:#336699;VLC:663399;AH:center;BGC:FFFFFF;LBGC:FFFFFF;ALC:0000FF;LC:0000FF;T:000000;GFNT:0000FF;GIMP:0000FF;LH:50;LW:150;L:https://www.artima.com/images/artima150.gif;S:https://www.artima.com;FORID:1;"/>
<input name="hl" type="hidden" value="en"/>
</td></tr></table>
</form>
<!-- SiteSearch Google -->
</br></center>
<br/>
<div class="sp">
<div style="text-align: center;">
<a href="../_/https/www.artima.com/copyright.html">Copyright</a> © 1996-2019 Artima, Inc. All Rights Reserved. - <a href="../_/https/www.artima.com/privacy.html">Privacy Policy</a> - <a href="../_/https/www.artima.com/termsofuse.html">Terms of Use</a>
</div>
</div>
<br/>
<script language="JavaScript" type="text/javascript">
<!--
function initBannerVarForZone(zone) {
        initBannerVarForZoneWithScript(zone, 'adjs_modified');
}

function initBannerVarForZoneWithScript(zone, phpScript) {

        if (!document.phpAds_used) document.phpAds_used = ',';
        phpAds_random = new String (Math.random());
        phpAds_random = phpAds_random.substring(2,11);

        var nextScriptSrc = '../_/https/www.artima.com/zcr/index.html' + phpScript + '.php?n=' +
                phpAds_random  +
                '&amp;what=zone:' + zone + '&amp;target=_top&amp;block=1&amp;blockcampaign=1' +
                '&amp;exclude=' + document.phpAds_used;

        document.write("<script language='JavaScript' type='text/javascript' src='");
        document.write(nextScriptSrc);
        document.write("'><\/script>");

}

function replaceDiv(divID) {
        document.getElementById(divID).innerHTML = phpadsbanner;
}
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
initBannerVarForZone(3);
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
replaceDiv('leftskyscraper');
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
initBannerVarForZoneWithScript(4, 'textman');
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
replaceDiv('sponsoredlinks');
-->
</script>
</hr><a href="https://dafoster.net/projects/crystal-web-archiver/" id="cr-footer-banner" style="border-top: 2px #B40010 solid;background: #FFFAE1;font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;font-variant: initial;font-weight: initial;text-transform: none;font-size: 14px;color: #6c757d;line-height: 2.0;cursor: pointer;display: flex;align-items: center;justify-content: center;gap: 4px;clear: both;" target="_blank"><img height="24" onerror="this.style['display'] = 'none';" src="../_/crystal/resources/appicon.png" width="24"/><span>This page was archived with Crystal</span><script>window.addEventListener('load', function() { const $1 = document.querySelector('#cr-footer-banner'); if (!$1) { return; } if (window !== window.top) { let $2 = false; if (window.name) { const $3 = window.parent.document.getElementsByName(window.name); if ($3.length === 1) { const $4 = $3[0]; if ($4.tagName === 'FRAME' && $4.parentElement.tagName === 'FRAMESET') { let $5 = $4; while (true) { if ($5.parentElement.tagName !== 'FRAMESET') { $2 = true; break; } if ($5.parentElement.attributes['rows'] !== undefined) { const $6 = $5.parentElement.children; if ($5 === $6[$6.length - 1]) { $5 = $5.parentElement; continue; } else { break; } } else if ($5.parentElement.attributes['cols'] !== undefined) { const $7 = Array.from($5.parentElement.children); const $8 = $7.indexOf($5); if ($8 === -1) { break; } const $9 = $5.parentElement.attributes['cols'].value.split(','); const $10 = $9.map((s) => parseInt(s.trim())); if ($9[$8].trim() === '*' || $10[$8] === Math.max.apply(null, $10)) { $5 = $5.parentElement; continue; } else { break; } } else { break; } } } } } if (!$2) { $1.style['display'] = 'none'; } } const $11 = $1.getBoundingClientRect(); const $12 = ($11.y < window.innerHeight - $11.height); if ($12) { $1.style['position'] = 'fixed'; $1.style['bottom'] = '0'; $1.style['left'] = '0'; $1.style['right'] = '0'; $1.style['z-index'] = '9999'; } const $13 = ( document.body.getBoundingClientRect().height < $11.height * 2 ); if ($13) { $1.style['display'] = 'none'; }
});</script></a></body>
</html>
