
<!DOCTYPE html>

<html>
<head><meta content="noindex,nofollow" name="robots"/>
<title>Percolating Nones in Scala</title>
<meta charset="utf-8"/>
<meta content="Bill Venners" name="author">
<link href="../_/https/www.artima.com/artima.css" rel="stylesheet" type="text/css"/>
<link href="../_/https/www.artima.com/favicon.ico" rel="shortcut icon"/>
</meta></head>
<body><table cellspacing="0" width="100%">
<tr>
<td align="left" valign="bottom">
<a href="../_/https/www.artima.com/index.html"><img alt="The Artima Developer Community" border="0" height="43" src="../_/https/www.artima.com/images/a7.gif" width="550"/></a>
</td>
</tr></table>
<table bgcolor="#333333" width="100%">
<tr>
<td align="center">
<div class="ml">
<a class="hl" href="../_/https/www.artima.com/articles/index.html">Articles</a> |
<a class="hl" href="../_/https/www.artima.com/news/index.html">News</a> |
<a class="hl" href="../index.html">Weblogs</a> |
<a class="hl" href="../_/https/www.artima.com/shop/catalog/index.html">Books</a> |
<a class="hl" href="../_/https/www.artima.com/forums/index.html">Forums</a>
</div>
</td>
</tr>
</table>
<table bgcolor="#D3D3D3" width="100%">
<tr>
<td align="center">
<div class="sc">
<a href="../index.html">Artima Weblogs</a> | 

<a href="../index.html$/blogger=bv.html">Bill Venners' Weblog</a> | 

<a href="../_/https/www.artima.com/forums/flat.html$/forum=106&amp;thread=267933.html">Discuss</a> | 
<a href="mailto:?subject=Percolating Nones in Scala&amp;body= %0AArtima Weblogs %0APercolating Nones in Scala %0Aby Bill Venners %0A%0Ahttps://www.artima.com/weblogs/viewpost.jsp?thread=267933">Email</a> | 
<a href="../viewpostP.html$/thread=267933.html">Print</a> | 
<a href="../bloggers.html">Bloggers</a> | 
<a class="sl" href="thread=266543.html" title="Are Shorter Variable Names Better?">Previous</a> | 
<a class="sl" href="thread=268689.html" title="Josh Bloch on the Semantic Gap">Next</a>
</div>
</td>
</tr>
</table>
<table bgcolor="#EEEEEE" width="100%">
<tr>
<td align="center">
<div class="sc">
<span style="color: #555555;">Sponsored Link</span> <span style="color: #888888;">•</span>
<script language="JavaScript" src="../_/https/www.artima.com/zcr/adx.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
   if (!document.phpAds_used) document.phpAds_used = ',';
   phpAds_random = new String (Math.random()); phpAds_random = phpAds_random.substring(2,11);
   
   document.write ("<" + "script language='JavaScript' type='text/javascript' src='");
   document.write ("../_/https/www.artima.com/zcr/adjs.html$/n=.html" + phpAds_random);
   document.write ("&amp;what=zone:9&amp;target=_top");   document.write ("&amp;exclude=" + document.phpAds_used);
   if (document.referrer)
      document.write ("&amp;referer=" + escape(document.referrer));
   document.write ("'><" + "/script>");
//-->
</script><noscript><a href="../_/https/www.artima.com/zcr/adclick.html$/n=a799ecf6.html" target="_top"><img alt="" border="0" src="../_/https/www.artima.com/zcr/adview.html$/what=zone:9&amp;n=a0587811.html"/></a></noscript>
</div>
</td>
</tr>
</table>
<br/>
<div class="vegies">
<div class="tc">
<span class="sts">Angle Brackets and Curly Braces</span><br>
<span class="ts">Percolating Nones in Scala</span><br/>
<span class="as">by Bill Venners</span><br/>
<span class="pd">September 12, 2009</span><br/>
</br></div>
<blockquote>
<b>Summary</b><br/>
Scala has an Option type that provides a type-safe alternative to using null to represent optional values. In this blog post, I show how to replace nested conditionals involving Option with a for-expression.

</blockquote>
<hr align="left" width="90%"/>
<table align="right">
<tr>
<td>
<div class="adnotice">
Advertisement
</div>
<center>
<script language="JavaScript" src="../_/https/www.artima.com/zcr/adx.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
if (!document.phpAds_used) document.phpAds_used = ',';
phpAds_random = new String (Math.random()); phpAds_random = phpAds_random.substring(2,11);
document.write ("<" + "script language='JavaScript' type='text/javascript' src='");
document.write ("../_/https/www.artima.com/zcr/adjs.html$/n=.html" + phpAds_random);
document.write ("&amp;what=zone:2");
document.write ("&amp;exclude=" + document.phpAds_used);
if (document.referrer)
document.write ("&amp;referer=" + escape(document.referrer));
document.write ("'><" + "/script>");
//-->
</script><noscript><a href="../_/https/www.artima.com/zcr/adclick.html$/n=a74ab060.html" target="_blank"><img alt="" border="0" src="../_/https/www.artima.com/zcr/adview.html$/what=zone:2&amp;n=a74ab060.html"/></a></noscript>
</center>
</td>
</tr>
</table>
<p>
<p>
Scala's <code>Option</code> type has only two possible subtypes, <code>Some[T]</code> and <code>None</code>. If an <code>Option</code> is a <code>Some</code>, the optional value does indeed exist. If it is a <code>None</code>, however, the value does not exist. In other words, <code>None</code> indicates in Scala what <code>null</code> often indicates in Java.
</p>
<p>
Idiomatic Scala APIs use <code>Option</code> to represent optional values. For example, here's a <code>find</code> method that looks for a specified character, <code>c</code>, in a specified string, <code>s</code>:
</p>
<pre>
def find(c: Char, s: String): Option[Int] =
    s.indexOf(c) match {
        case -1 =&gt; None
        case c =&gt; Some(c)
    }
</pre>
<p>
If the string contains the character, <code>find</code> returns the index of the first occurence of the character wrapped in a <code>Some</code>.
Otherwise, it returns <code>None</code> to indicate the character does not exist
in the string.
</p>
<p>
Here's another example. The
<code>superChar</code> method returns the character at the specified index, <code>i</code>, of the string, "supercalifragilisticexpialidotious", wrapped in
a <code>Some</code>, or <code>None</code> if <code>i</code> is greater than or equal to the length of "supercalifragilisticexpialidotious":
</p>
<pre>
def superChar(i: Int): Option[Char] = {
    val song = "supercalifragilisticexpialidotious"
    if (i &lt; song.length) Some(song(i)) else None
}
</pre>
<p>
In the unlikely event that you want to determine the character in supercalifragilisticexpialidotious at the same index as the first occurrence of a particular character in a particular string, you
could first call <code>find</code>. If it's result is a <code>Some</code>, you have
the index of that character in the string. You can then pass that index to
<code>superChar</code>. If it returns a <code>Some</code>, then you have the
character in supercalifragilisticexpialidotious that sits at the same index as
your chosen character in your chosen string. Now imagine further you want to find
the index of the first occurrence of this result character in your
original string. You could invoke <code>find</code> again, this time passing in the result character
and the original string.
</p>
<p>
Now three things could go wrong here:
</p>
<ol>
<li>Character c might not be in string s.</li>
<li>Character c is in string s, but at an index greater than or
equal to the number of characters in supercalifragilisticexpialidotious.
<li>If the previous two problems didn't materialize, the result character still might not be in string s.</li>
</li></ol>
<p>
The traditional Java-style approach to deal with this situation with a nested if-else construct, as is done in the following <code>percolate1</code> method. If all goes well, it returns the desired index, wrapped in a <code>Some</code>. But if any of the three potential problems happen, it returns a <code>None</code>:
</p>
<pre>
def percolate1(c: Char, s: String) = { // (Not idiomatic Scala)
    val index = find(c, s)
    if (index.isDefined) { // isDefined is true for Some, false for None
        val resultChar = superChar(index.get) // get grabs the value out of the Some
        if (resultChar.isDefined) {
            find(resultChar.get, s)
        }
        else {
            None
        }
    }
    else {
        None
    }
}
</pre>
<p>
A more idiomatic way to accomplish this in Scala is with a nested pattern match. That
would look like this:
</p>
<pre>
def percolate2(c: Char, s: String) = {
    find(c, s) match {
        case Some(index) =&gt;
            superChar(index) match {
                case Some(resultChar) =&gt; find(resultChar, s)
                case None =&gt; None
            }
        case None =&gt; None
    }
}
</pre>
<p>
While this is a bit more concise and leaves less room for error than
the nested if-else construct, Scala has an even better way to accomplish
this. You can use a for-expression, like this:
</p>
<pre>
def percolate3(c: Char, s: String) =
    for {
        index &lt;- find(c, s)
        resultChar &lt;- superChar(index)
        result &lt;- find(resultChar, s)
    } yield result
</pre>
<p>
Using any of these approaches, a <code>None</code> will percolate
out no matter where the failure occurs.
</p>
<p>
Here are some examples in the Scala interpreter. Given <code>c</code> and <code>"cats"</code>, <code>percolate3</code> will return <code>Some(3)</code> because <code>c</code> is at index 0 in <code>cats</code>, index 0 in supercalifragilisticexpialidotious contains <code>s</code>, and <code>s</code> in <code>"cats"</code> appears at index 3:
</p>
<pre>
scala&gt; percolate3('c', "cats")
res0: Option[Int] = Some(3)
</pre>
<p>
The previous example made it all the way through. If any of the three potential problems occurs, a <code>None</code> will occur at that step and percolate out all the way to the result. Here the first call to <code>find</code> results in <code>None</code>, so <code>None</code> percolates out as the result of <code>percolate3</code>:
</p>
<pre>
scala&gt; percolate3('d', "cats")
res1: Option[Int] = None
</pre>
<p>
Here the initial call to <code>find</code> returns <code>Some(68)</code>, but because 68 is greater than the length of supercalifragilisticexpialidotious, the subsequent call to <code>superChar</code> results in a <code>None</code>, which percolates out:
</p>
<pre>
scala&gt; percolate3('c', "--------------------------------------------------------------------cats") 
res2: Option[Int] = None
</pre>
<p>
And here the first call to <code>find</code> results in <code>Some(2)</code>, and <code>superChar</code> results in <code>Some(u)</code>, but because <code>"cats"</code> doesn't contain a <code>u</code>, the second call to <code>find</code> results in a <code>None</code>, which is returned:
</p>
<pre>
scala&gt; percolate3('a', "cats")
res2: Option[Int] = None
</pre>
<p>
Using a for expression for this can seem non-intuitive because we're used to doing
this kind of thing to iterate over collections.
One way to think of an <code>Option</code> is as a collection that can contain either
zero or one value--like a special kind of <code>List</code> that can either be an 
empty <code>List</code> or a <code>List</code> with only one value in it. The nice thing is you can  compose up to as many operations like this as you need and be confident <code>None</code>s  that happen at any step along the way will simply percolate through to the end.
</p>
<h1>Talk Back!</h1>
<p>
Have an opinion?


Readers have already posted

<a href="../_/https/www.artima.com/forums/flat.html$/forum=106&amp;thread=267933.html">4

comments</a>
about this weblog entry. Why not

<a href="../_/https/www.artima.com/forums/post.html$/forum=106&amp;thread=267933&amp;reply=true.html">add yours</a>?


<h1>RSS Feed</h1>
<p>
If you'd like to be notified whenever Bill Venners adds a new entry to <a href="../index.html$/blogger=bv.html">his weblog</a>, subscribe to his <a href="../feeds/bloggers/bv.rss">RSS feed</a>.

<center>
<div class="sociallinks">
<a href="../_/http/digg.com/submit$/phase=2&amp;url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D267933&amp;title=Percolating+Nones+in+Scala&amp;bodytext=Scala+has+an+Option+type+that+provides+a+type-safe+alternative+to+using+null+to+represent+optional+values.+In+this+blog+post%2C+I+show+how+to+replace+nested+conditionals+involving+Option+with+a+for-expression.&amp;topic=programming">
<img alt="Digg" border="0" height="14" hspace="8" src="../_/https/www.artima.com/images/digg.gif" width="16">Digg
  </img></a>
  |
  <a href="../_/http/del.icio.us/post$/url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D267933&amp;title=Percolating+Nones+in+Scala">
<img alt="del.icio.us" border="0" height="16" hspace="8" src="../_/https/www.artima.com/images/delicious.gif" vspace="1" width="16">del.icio.us
  </img></a>
  |
  <a href="../_/http/programming.reddit.com/submit$/url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D267933&amp;title=Percolating+Nones+in+Scala">
<img alt="Reddit" border="0" height="18" hspace="8" src="../_/https/www.artima.com/images/reddit.gif" width="18"/>Reddit
  </a>
</div>
</center>
<h1>About the Blogger</h1>
<p>
<table><tr valign="bottom"><td><img align="right" src="../_/https/www.artima.com/images/bv.jpg"/></td><td>Bill Venners is president of Artima, Inc., publisher of Artima Developer (www.artima.com). He is author of the book, <em>Inside the Java Virtual Machine</em>, a programmer-oriented survey of the Java platform's architecture and internals. His popular columns in JavaWorld magazine covered Java internals, object-oriented design, and Jini. Active in the Jini Community since its inception, Bill led the Jini Community's ServiceUI project, whose ServiceUI API became the de facto standard way to associate user interfaces to Jini services.  Bill is also the lead developer and designer of ScalaTest, an open source testing tool for Scala and Java developers, and coauthor with Martin Odersky and Lex Spoon of the book, <em>Programming in Scala</em>.</td></tr></table><p>
<div class="sp">This weblog entry is Copyright © 2009 Bill Venners. All rights reserved.</div>
</p></p></p></p></p></div>

<hr width="100%">
<table align="center" width="50%">
<tr>
<td>
<div class="horizontaltextadbox">
<div class="adheadline">Sponsored Links</div>
<div id="sponsoredlinks">
</div>
</div>
</td>
</tr>
</table>
<hr width="100%"/>
<center>
<script type="text/javascript"><!--
google_ad_client = "pub-3911176865765226";
google_alternate_color = "ffffff";
google_ad_width = 728;
google_ad_height = 15;
google_ad_format = "728x15_0ads_al";
google_ad_channel = "";
google_color_border = "ffffff";
google_color_bg = "FFFFFF";
google_color_link = "003090";
google_color_text = "000000";
google_color_url = "666666";
//--></script>
<script src="../_/https/pagead2.googlesyndication.com/pagead/show_ads.js" type="text/javascript">
</script>
<br>
<br/>
<!-- SiteSearch Google -->
<form action="../_/https/www.google.com/custom/index.html" method="get">
<table bgcolor="#ffffff" border="0">
<tr><td align="left" height="32" nowrap="nowrap" valign="top">
<a href="../_/https/www.google.com/index.html">
<img alt="Google" border="0" src="../_/https/www.google.com/logos/Logo_25wht.gif"/></a>
</td>
<td nowrap="nowrap">
<input name="domains" type="hidden" value="Artima.com"/>
<input maxlength="255" name="q" size="31" type="text" value=""/>
<input name="sa" type="submit" value="Search"/>
</td></tr>
<tr>
<td> </td>
<td nowrap="nowrap">
<font color="#000000" size="-1">
<input name="sitesearch" type="radio" value=""/> Web
<input checked="checked" name="sitesearch" type="radio" value="Artima.com"/>Artima.com
</font>  
<input name="client" type="hidden" value="pub-3911176865765226"/>
<input name="forid" type="hidden" value="1"/>
<input name="ie" type="hidden" value="ISO-8859-1"/>
<input name="oe" type="hidden" value="ISO-8859-1"/>
<input name="cof" type="hidden" value="GALT:#008000;GL:1;DIV:#336699;VLC:663399;AH:center;BGC:FFFFFF;LBGC:FFFFFF;ALC:0000FF;LC:0000FF;T:000000;GFNT:0000FF;GIMP:0000FF;LH:50;LW:150;L:https://www.artima.com/images/artima150.gif;S:https://www.artima.com;FORID:1;"/>
<input name="hl" type="hidden" value="en"/>
</td></tr></table>
</form>
<!-- SiteSearch Google -->
</br></center>
<br/>
<div class="sp">
<div style="text-align: center;">
<a href="../_/https/www.artima.com/copyright.html">Copyright</a> © 1996-2019 Artima, Inc. All Rights Reserved. - <a href="../_/https/www.artima.com/privacy.html">Privacy Policy</a> - <a href="../_/https/www.artima.com/termsofuse.html">Terms of Use</a>
</div>
</div>
<br/>
<script language="JavaScript" type="text/javascript">
<!--
function initBannerVarForZone(zone) {
        initBannerVarForZoneWithScript(zone, 'adjs_modified');
}

function initBannerVarForZoneWithScript(zone, phpScript) {

        if (!document.phpAds_used) document.phpAds_used = ',';
        phpAds_random = new String (Math.random());
        phpAds_random = phpAds_random.substring(2,11);

        var nextScriptSrc = '../_/https/www.artima.com/zcr/index.html' + phpScript + '.php?n=' +
                phpAds_random  +
                '&amp;what=zone:' + zone + '&amp;target=_top&amp;block=1&amp;blockcampaign=1' +
                '&amp;exclude=' + document.phpAds_used;

        document.write("<script language='JavaScript' type='text/javascript' src='");
        document.write(nextScriptSrc);
        document.write("'><\/script>");

}

function replaceDiv(divID) {
        document.getElementById(divID).innerHTML = phpadsbanner;
}
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
initBannerVarForZone(3);
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
replaceDiv('leftskyscraper');
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
initBannerVarForZoneWithScript(4, 'textman');
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
replaceDiv('sponsoredlinks');
-->
</script>
</hr><a href="https://dafoster.net/projects/crystal-web-archiver/" id="cr-footer-banner" style="border-top: 2px #B40010 solid;background: #FFFAE1;font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;font-variant: initial;font-weight: initial;text-transform: none;font-size: 14px;color: #6c757d;line-height: 2.0;cursor: pointer;display: flex;align-items: center;justify-content: center;gap: 4px;clear: both;" target="_blank"><img height="24" onerror="this.style['display'] = 'none';" src="../_/crystal/resources/appicon.png" width="24"/><span>This page was archived with Crystal</span><script>window.addEventListener('load', function() { const $1 = document.querySelector('#cr-footer-banner'); if (!$1) { return; } if (window !== window.top) { let $2 = false; if (window.name) { const $3 = window.parent.document.getElementsByName(window.name); if ($3.length === 1) { const $4 = $3[0]; if ($4.tagName === 'FRAME' && $4.parentElement.tagName === 'FRAMESET') { let $5 = $4; while (true) { if ($5.parentElement.tagName !== 'FRAMESET') { $2 = true; break; } if ($5.parentElement.attributes['rows'] !== undefined) { const $6 = $5.parentElement.children; if ($5 === $6[$6.length - 1]) { $5 = $5.parentElement; continue; } else { break; } } else if ($5.parentElement.attributes['cols'] !== undefined) { const $7 = Array.from($5.parentElement.children); const $8 = $7.indexOf($5); if ($8 === -1) { break; } const $9 = $5.parentElement.attributes['cols'].value.split(','); const $10 = $9.map((s) => parseInt(s.trim())); if ($9[$8].trim() === '*' || $10[$8] === Math.max.apply(null, $10)) { $5 = $5.parentElement; continue; } else { break; } } else { break; } } } } } if (!$2) { $1.style['display'] = 'none'; } } const $11 = $1.getBoundingClientRect(); const $12 = ($11.y < window.innerHeight - $11.height); if ($12) { $1.style['position'] = 'fixed'; $1.style['bottom'] = '0'; $1.style['left'] = '0'; $1.style['right'] = '0'; $1.style['z-index'] = '9999'; } const $13 = ( document.body.getBoundingClientRect().height < $11.height * 2 ); if ($13) { $1.style['display'] = 'none'; }
});</script></a></body>
</html>
