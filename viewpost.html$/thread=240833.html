
<!DOCTYPE html>

<html>
<head><meta content="noindex,nofollow" name="robots"/>
<title>The Adventures of a Pythonista in Schemeland/11</title>
<meta charset="utf-8"/>
<meta content="Michele Simionato" name="author">
<link href="../_/https/www.artima.com/artima.css" rel="stylesheet" type="text/css"/>
<link href="../_/https/www.artima.com/favicon.ico" rel="shortcut icon"/>
</meta></head>
<body><table cellspacing="0" width="100%">
<tr>
<td align="left" valign="bottom">
<a href="../_/https/www.artima.com/index.html"><img alt="The Artima Developer Community" border="0" height="43" src="../_/https/www.artima.com/images/a7.gif" width="550"/></a>
</td>
</tr></table>
<table bgcolor="#333333" width="100%">
<tr>
<td align="center">
<div class="ml">
<a class="hl" href="../_/https/www.artima.com/articles/index.html">Articles</a> |
<a class="hl" href="../_/https/www.artima.com/news/index.html">News</a> |
<a class="hl" href="../index.html">Weblogs</a> |
<a class="hl" href="../_/https/www.artima.com/shop/catalog/index.html">Books</a> |
<a class="hl" href="../_/https/www.artima.com/forums/index.html">Forums</a>
</div>
</td>
</tr>
</table>
<table bgcolor="#CCCCCC" width="100%">
<tr>
<td align="center">
<div class="sc">
<a href="../index.html">Artima Weblogs</a> | 

<a href="../index.html$/blogger=micheles.html">Michele Simionato's Weblog</a> | 

<a href="../_/https/www.artima.com/forums/flat.html$/forum=106&amp;thread=240833.html">Discuss</a> | 
<a href="mailto:?subject=The Adventures of a Pythonista in Schemeland/11&amp;body= %0AArtima Weblogs %0AThe Adventures of a Pythonista in Schemeland/11 %0Aby Michele Simionato %0A%0Ahttps://www.artima.com/weblogs/viewpost.jsp?thread=240833">Email</a> | 
<a href="../viewpostP.html$/thread=240833.html">Print</a> | 
<a href="../bloggers.html">Bloggers</a> | 
<a class="sl" href="thread=240805.html" title="The Adventures of a Pythonista in Schemeland/10">Previous</a> | 
<a class="sl" href="thread=240836.html" title="The Adventures of a Pythonista in Schemeland/12">Next</a>
</div>
</td>
</tr>
</table>
<table bgcolor="#EEEEEE" width="100%">
<tr>
<td align="center">
<div class="sc">
<span style="color: #555555;">Sponsored Link</span> <span style="color: #888888;">•</span>
<script language="JavaScript" src="../_/https/www.artima.com/zcr/adx.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
   if (!document.phpAds_used) document.phpAds_used = ',';
   phpAds_random = new String (Math.random()); phpAds_random = phpAds_random.substring(2,11);
   
   document.write ("<" + "script language='JavaScript' type='text/javascript' src='");
   document.write ("../_/https/www.artima.com/zcr/adjs.html$/n=.html" + phpAds_random);
   document.write ("&amp;what=zone:9&amp;target=_top");   document.write ("&amp;exclude=" + document.phpAds_used);
   if (document.referrer)
      document.write ("&amp;referer=" + escape(document.referrer));
   document.write ("'><" + "/script>");
//-->
</script><noscript><a href="../_/https/www.artima.com/zcr/adclick.html$/n=a799ecf6.html" target="_top"><img alt="" border="0" src="../_/https/www.artima.com/zcr/adview.html$/what=zone:9&amp;n=a0587811.html"/></a></noscript>
</div>
</td>
</tr>
</table>
<br/>
<div class="vegies">
<div class="tc">
<span class="sts">The Explorer</span><br>
<span class="ts">The Adventures of a Pythonista in Schemeland/11</span><br/>
<span class="as">by Michele Simionato</span><br/>
<span class="pd">November 11, 2008</span><br/>
</br></div>
<blockquote>
<b>Summary</b><br/>
In this episode I will discuss the multiple evaluation issue, then I will show how macros can improve performance. Finally, I will give a practical example of how macros can be used to define a unit test framework.

</blockquote>
<hr align="left" width="90%"/>
<table align="right">
<tr>
<td>
<div class="adnotice">
Advertisement
</div>
<center>
<script language="JavaScript" src="../_/https/www.artima.com/zcr/adx.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
if (!document.phpAds_used) document.phpAds_used = ',';
phpAds_random = new String (Math.random()); phpAds_random = phpAds_random.substring(2,11);
document.write ("<" + "script language='JavaScript' type='text/javascript' src='");
document.write ("../_/https/www.artima.com/zcr/adjs.html$/n=.html" + phpAds_random);
document.write ("&amp;what=zone:2");
document.write ("&amp;exclude=" + document.phpAds_used);
if (document.referrer)
document.write ("&amp;referer=" + escape(document.referrer));
document.write ("'><" + "/script>");
//-->
</script><noscript><a href="../_/https/www.artima.com/zcr/adclick.html$/n=a74ab060.html" target="_blank"><img alt="" border="0" src="../_/https/www.artima.com/zcr/adview.html$/what=zone:2&amp;n=a74ab060.html"/></a></noscript>
</center>
</td>
</tr>
</table>
<p>
<div class="section">
<h1><a id="the-problem-of-multiple-evaluation" name="the-problem-of-multiple-evaluation">The problem of multiple evaluation</a></h1>
<p>In <a class="reference" href="../_/http/www.artima.com/weblogs/viewpost.html$/thread=240805.html">episode #10</a> I gave an example of a macro implementing
a C-like <tt class="docutils literal"><span class="pre">for</span></tt> loop and I said that it was suffering from the
problem of multiple evaluation. Here I explain what the
problem is and how to cure it. In order to understand the issue,
you must always remember that macros <em>expand</em> code at compile time,
but they not <em>evaluate</em> it: this means that pattern variables do <em>not</em>
correspond to evaluated expression, as ordinary variables, but they
correspond to expressions to be evaluated later, at runtime.</p>
<p>As a consequence, it is easy to write macros
that evaluate expressions more times than needed. For instance,
consider the following simplified version of a C-like <tt class="docutils literal"><span class="pre">for</span></tt> loop,
with a runtime type check:</p>
<pre class="literal-block">
(def-syntax (for i start end body ...)
  #'(begin
     (assert (and (number? start) (number? end))); type-check
     (let loop ((i start))
       (unless (&gt;= i end) body ... (loop (+ i 1))))))
</pre>
<p>Suppose the variable <tt class="docutils literal"><span class="pre">end</span></tt> to be determined dynamically
with a computation:</p>
<pre class="literal-block">
&gt; (define (get-end)
  (printf "computing the value of end\n")
 3)
</pre>
<p>Then our naive macro suffers from the multiple evaluation problem:</p>
<pre class="literal-block">
&gt; (for i 0 (get-end) 'do-nothing)
computing the value of end
computing the value of end
computing the value of end
computing the value of end
computing the value of end
</pre>
<p>As you see, in this example <tt class="docutils literal"><span class="pre">end</span></tt> is recomputed 5 times!
The reason is clear if you look at the expansion of the macro:</p>
<pre class="literal-block">
&gt; (syntax-expand (for i 0 (get-end) 'do-nothing))
(begin
 (assert (and (number? 0) (number? (get-end))))
 (let loop ((i 0))
   (unless (&gt;= i (get-end)) 'do-nothing (loop (+ i 1)))))
</pre>
<p>The <tt class="docutils literal"><span class="pre">get-end</span></tt> function is called once in the assertion and
four times in the loop; that is inefficient and can have very
dramatic effects if the function has side effects.
The solution is to save the value of <tt class="docutils literal"><span class="pre">end</span></tt> (and we could do the same
for the value of <tt class="docutils literal"><span class="pre">start</span></tt>, which is computed twice) in a variable:</p>
<pre class="literal-block">
(def-syntax (for i start end body ...)
   #'(let ((s start) (e end))
     (assert (and (number? s) (number? e)))
     (let loop ((i s))
       (unless (&gt;= i e) body ... (loop (+ i 1))))))
</pre>
<p>Now <tt class="docutils literal"><span class="pre">get-end</span></tt> is called only once and we are all happy :-)</p>
<p>As an exercise, you could extend <tt class="docutils literal"><span class="pre">for</span></tt> to accept a generic step.
You can find the solution in the Italian <a class="reference" href="../_/http/stacktrace.it/2008/04/le-avventure-di-un-pythonista-schemeland8/index.html">original version</a> of this article,
which is quite different and uses <tt class="docutils literal"><span class="pre">syntax-rules</span></tt>.</p>
<img alt="../_/http/www.phyast.pitt.edu/~micheles/scheme/gears.png" src="../_/http/www.phyast.pitt.edu/~micheles/scheme/gears.png" style="width: 240px;">
</img></div>
<div class="section">
<h1><a id="taking-advantage-of-multiple-evaluation" name="taking-advantage-of-multiple-evaluation">Taking advantage of multiple evaluation</a></h1>
<p>Sometimes we can make good use of the multiple evaluation "feature".
For instance, let me consided again the higher order
function <tt class="docutils literal"><span class="pre">call</span></tt> I introduced in <a class="reference" href="../_/http/www.artima.com/weblogs/viewpost.html$/thread=239699.html">episode #5</a>, when
discussing benchmark. That function has an issue: it is
called at each iteration in the inner loop and therefore it wastes
time. However, it is possible to replace the higher order function
with a macro, therefore avoiding the cost of a function call.
Here is the code for a <tt class="docutils literal"><span class="pre">repeat</span></tt> macro doing the job of <tt class="docutils literal"><span class="pre">call</span></tt>:</p>
<pre class="literal-block">
(library (repeat-macro)
(export repeat)
(import (rnrs) (sweet-macros))

(def-syntax (repeat n body body* ...)
  #'(let loop ((i 0))
      (when (&lt; i n) body body* ... (loop (+ 1 i)))))
)
</pre>
<p><tt class="docutils literal"><span class="pre">repeat</span></tt> expands into a loop and therefore the body is evaluated <tt class="docutils literal"><span class="pre">n</span></tt>
times, which is exactly what we need for a benchmark.
To check that the macro is effectively more efficient, I did measure
the time spent in summing 1+1 ten million of times:</p>
<pre class="literal-block">
(import (rnrs) (repeat-macro) (repeat) (only (ikarus) time))
(define n (string-&gt;number (car (reverse (command-line)))))
(time (call 10000000 + 1 n))
(time (repeat 10000000 (+ 1 n)))
</pre>
<p>I took the number <tt class="docutils literal"><span class="pre">n</span></tt> from the command line arguments
in order to fool the compiler: if I hard coded <tt class="docutils literal"><span class="pre">(+</span> <span class="pre">1</span> <span class="pre">1)</span></tt>, the compiler
would replace it with 2 at compilation time, therefore not performing
the computation! (In the original version of this episode I made that
mistake, thanks to Aziz Ghuloum for pointing it out).
The output of the script is the following:</p>
<pre class="literal-block">
$ scheme-script repeat-benchmark.ss 1
running stats for (call 10000000 + 1 n):
    no collections
    396 ms elapsed cpu time, including 0 ms collecting
    394 ms elapsed real time, including 0 ms collecting
    32 bytes allocated
running stats for (repeat 10000000 (+ 1 n)):
    no collections
    40 ms elapsed cpu time, including 0 ms collecting
    40 ms elapsed real time, including 0 ms collecting
    0 bytes allocated
</pre>
<p>As you see, avoiding the function call makes a lot of difference
(the benchmark is 10 times faster!) since the great majority of the
time is wasted in calling the benchmarking
function and not in the real addition.
Here the improvement is spectacular since summing two integers is a
very fast operation: replacing <tt class="docutils literal"><span class="pre">call</span></tt> with <tt class="docutils literal"><span class="pre">repeat</span></tt> in the
benchmark factorial does not make a big difference instead.</p>
</div>
<div class="section">
<h1><a id="a-micro-framework-for-unit-tests" name="a-micro-framework-for-unit-tests">A micro-framework for unit tests</a></h1>
<p>It is time to give a more practical example of Scheme macros.  In this
paragraph, I will define a very simple unit test framework called
<tt class="docutils literal"><span class="pre">easy-test</span></tt>.</p>
<p>Clearly, there are already unit test frameworks
available for Scheme, including two SRFIs (<a class="reference" href="../_/http/srfi.schemers.org/srfi-64/srfi-64.html">64</a> and <a class="reference" href="../_/http/srfi.schemers.org/srfi-78/srfi-78.html">78</a>); my interests
here is not in the testing framework, it is in the implementation, which makes
a pedagogical exercise in macrology.</p>
<p>The source code takes just a page:</p>
<img alt="../_/http/www.phyast.pitt.edu/~micheles/scheme/feu_rouge.jpg" src="../_/http/www.phyast.pitt.edu/~micheles/scheme/feu_rouge.jpg">
<pre class="literal-block">
(library (easy-test)
(export test run-tests runner run print-nothing print-dot print-msg)
(import (rnrs) (only (ikarus) printf) (sweet-macros))

;; test macro
(def-syntax (test description expr expected)
  #'(lambda (cmd)
      (case cmd
        ((descr) description)
        ((values) '(expr  expected))
        ((run) (equal? expr expected))
        (else (error 'test "Invalid command" cmd)))))

;; three helper functions
(define (print-nothing descr expr expected)
  (display ""))

(define (print-dot descr expr expected)
  (display "."))

(define (print-msg descr expr expected)
  (printf "\n'~a' failed. Expected ~a, got ~a\n" descr expected expr))

;; full runner
(define (run-tests print-success print-failure . tests)
  (let loop ((tests tests) (success 0) (failure 0))
    (if (null? tests)
        (list success failure)
        (let* ((test1 (car tests))
               (descr (test1 'descr)) (vals (test1 'values)))
          (if (test1 'run)
              (begin; the test succeeded
                (apply print-success descr vals)
                (loop (cdr tests) (+ 1 success) failure))
              (begin; the test failed
                (apply print-failure descr vals)
                (loop (cdr tests) success (+ 1 failure))))))))

;; runner factory
(define (runner print-success print-failure)
  (lambda tests (apply run-tests print-success print-failure tests)))

;; default runner
(define run (runner print-dot print-msg))

)
</pre>
<p>The core of the framework is the <tt class="docutils literal"><span class="pre">test</span></tt> macro, which is a bit different
from the macros we have defined until now. The reason why the <tt class="docutils literal"><span class="pre">test</span></tt>
macro is different is that it expands into a <tt class="docutils literal"><span class="pre">lambda</span></tt>-expression
and therefore the arguments
of the macro are evaluated only when the <tt class="docutils literal"><span class="pre">lambda</span></tt> function is called
and not at definition time. In other words, we are using a pattern of
<em>delayed evaluation</em> here. This is important, since we want to distinguish
the definition of a test from its execution. For instance, let me
define a trivial test:</p>
<pre class="literal-block">
&gt; (import (easy-test))
&gt; (define test1 (test "1+1=2" (+ 1 1) 2))
</pre>
<p>The first argument of the macro is a string describing the test, which
is nice to have in the error message for failed tests; the second
argument of the macro is the expression to check and the third
argument is the expected result.</p>
<p>Macro application results in a
function which is able to respond to the commands
<tt class="docutils literal"><span class="pre">'descr</span></tt> (returning the description string), <tt class="docutils literal"><span class="pre">'values</span></tt>
(returning a list with the quoted input expression and the quoted
expected output) and <tt class="docutils literal"><span class="pre">'run</span></tt> (returning the result of the test, as
a boolean flag). This is implemented via the <a class="reference" href="../_/http/www.r6rs.org/final/html/r6rs/r6rs-Z-H-14.html#node_idx_384">case expression</a> in
the <tt class="docutils literal"><span class="pre">test</span></tt> macro:</p>
<pre class="literal-block">
(case cmd
  ((descr) description)
  ((values) '(expr  expected))
  ((run) (equal? expr expected))
  (else (error 'test "Invalid command" cmd)))
</pre>
<p>Here is how it works in our example:</p>
<pre class="literal-block">
&gt; (test1 'descr)
"1+1=2"
&gt; (test1 'values)
((+ 1 1) 2)
&gt; (test1 'run) ; the test passed
#t
</pre>
<p>The framework provides
three predefined functions <tt class="docutils literal"><span class="pre">print-nothing</span></tt>,
<tt class="docutils literal"><span class="pre">print-msg</span></tt> and <tt class="docutils literal"><span class="pre">print-dot</span></tt> to print feedback about how the
tests are going; moreover, it is possible to define custom
reporting functions. A reporting function is simply a function
with three arguments <tt class="docutils literal"><span class="pre">(descr</span> <span class="pre">expr</span> <span class="pre">expected)</span></tt> where <tt class="docutils literal"><span class="pre">descr</span></tt>
is a string with the description of the test,
<tt class="docutils literal"><span class="pre">expr</span></tt> is the expression to be checked and <tt class="docutils literal"><span class="pre">expected</span></tt> is the expected
result. You can specify the reporting functions to use by defining
a test runner as in this example:</p>
<pre class="literal-block">
&gt; (define run-quiet (runner print-nothing print-msg))
&gt; (run-quiet
    (test "1+1=2" (+ 1 1) 2)
    (test "2*1=2" (* 2 1) 2)
    (test "2+2=3" (+ 2 2) 3))
'2+2=3' failed. Expected 3, got 4
(2 1)
</pre>
<p>The runner returns a list with the number of passed tests
and failed tests (in our case <tt class="docutils literal"><span class="pre">'(2</span> <span class="pre">1)</span></tt>).</p>
<p>It is also possible to use the default runner (<tt class="docutils literal"><span class="pre">run</span></tt>):
the framework will use the default reporting functions,
i.e. <tt class="docutils literal"><span class="pre">print-dot</span></tt> for successful tests and <tt class="docutils literal"><span class="pre">print-msg</span></tt> for failed
tests.</p>
</img></div>
<h1>Talk Back!</h1>
<p>
Have an opinion?


Readers have already posted

<a href="../_/https/www.artima.com/forums/flat.html$/forum=106&amp;thread=240833.html">3

comments</a>
about this weblog entry. Why not

<a href="../_/https/www.artima.com/forums/post.html$/forum=106&amp;thread=240833&amp;reply=true.html">add yours</a>?


<h1>RSS Feed</h1>
<p>
If you'd like to be notified whenever Michele Simionato adds a new entry to <a href="../index.html$/blogger=micheles.html">his weblog</a>, subscribe to his <a href="../feeds/bloggers/micheles.rss">RSS feed</a>.

<center>
<div class="sociallinks">
<a href="../_/http/digg.com/submit$/phase=2&amp;url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D240833&amp;title=The+Adventures+of+a+Pythonista+in+Schemeland%2F11&amp;bodytext=In+this+episode+I+will+discuss+the+multiple+evaluation+issue%2C+then+I+will+show+how+macros+can+improve+performance.+Finally%2C+I+will+give+a+practical+example+of+how+macros+can+be+used+to+define+a+unit+test+framework.&amp;topic=programming">
<img alt="Digg" border="0" height="14" hspace="8" src="../_/https/www.artima.com/images/digg.gif" width="16"/>Digg
  </a>
  |
  <a href="../_/http/del.icio.us/post$/url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D240833&amp;title=The+Adventures+of+a+Pythonista+in+Schemeland%2F11">
<img alt="del.icio.us" border="0" height="16" hspace="8" src="../_/https/www.artima.com/images/delicious.gif" vspace="1" width="16"/>del.icio.us
  </a>
  |
  <a href="../_/http/programming.reddit.com/submit$/url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D240833&amp;title=The+Adventures+of+a+Pythonista+in+Schemeland%2F11">
<img alt="Reddit" border="0" height="18" hspace="8" src="../_/https/www.artima.com/images/reddit.gif" width="18"/>Reddit
  </a>
</div>
</center>
<h1>About the Blogger</h1>
<p>
<table><tr valign="bottom"><td><img align="right" src="../_/https/www.artima.com/images/micheleSimionato.jpg"/></td><td>Michele Simionato started his career as a Theoretical Physicist, working in Italy, France and the U.S. He turned to programming in 2003; since then he has been working professionally as a Python developer and now he lives in Milan, Italy. Michele is well known in the Python community for his posts in the newsgroup(s), his articles and his Open Source libraries and recipes. His interests include object oriented programming, functional programming, and in general programming metodologies that enable us to manage the complexity of modern software developement.</td></tr></table><p>
<div class="sp">This weblog entry is Copyright © 2008 Michele Simionato. All rights reserved.</div>
</p></p></p></p></p></div>

<hr width="100%">
<table align="center" width="50%">
<tr>
<td>
<div class="horizontaltextadbox">
<div class="adheadline">Sponsored Links</div>
<div id="sponsoredlinks">
</div>
</div>
</td>
</tr>
</table>
<hr width="100%"/>
<center>
<script type="text/javascript"><!--
google_ad_client = "pub-3911176865765226";
google_alternate_color = "ffffff";
google_ad_width = 728;
google_ad_height = 15;
google_ad_format = "728x15_0ads_al";
google_ad_channel = "";
google_color_border = "ffffff";
google_color_bg = "FFFFFF";
google_color_link = "003090";
google_color_text = "000000";
google_color_url = "666666";
//--></script>
<script src="../_/https/pagead2.googlesyndication.com/pagead/show_ads.js" type="text/javascript">
</script>
<br>
<br/>
<!-- SiteSearch Google -->
<form action="../_/https/www.google.com/custom/index.html" method="get">
<table bgcolor="#ffffff" border="0">
<tr><td align="left" height="32" nowrap="nowrap" valign="top">
<a href="../_/https/www.google.com/index.html">
<img alt="Google" border="0" src="../_/https/www.google.com/logos/Logo_25wht.gif"/></a>
</td>
<td nowrap="nowrap">
<input name="domains" type="hidden" value="Artima.com"/>
<input maxlength="255" name="q" size="31" type="text" value=""/>
<input name="sa" type="submit" value="Search"/>
</td></tr>
<tr>
<td> </td>
<td nowrap="nowrap">
<font color="#000000" size="-1">
<input name="sitesearch" type="radio" value=""/> Web
<input checked="checked" name="sitesearch" type="radio" value="Artima.com"/>Artima.com
</font>  
<input name="client" type="hidden" value="pub-3911176865765226"/>
<input name="forid" type="hidden" value="1"/>
<input name="ie" type="hidden" value="ISO-8859-1"/>
<input name="oe" type="hidden" value="ISO-8859-1"/>
<input name="cof" type="hidden" value="GALT:#008000;GL:1;DIV:#336699;VLC:663399;AH:center;BGC:FFFFFF;LBGC:FFFFFF;ALC:0000FF;LC:0000FF;T:000000;GFNT:0000FF;GIMP:0000FF;LH:50;LW:150;L:https://www.artima.com/images/artima150.gif;S:https://www.artima.com;FORID:1;"/>
<input name="hl" type="hidden" value="en"/>
</td></tr></table>
</form>
<!-- SiteSearch Google -->
</br></center>
<br/>
<div class="sp">
<div style="text-align: center;">
<a href="../_/https/www.artima.com/copyright.html">Copyright</a> © 1996-2019 Artima, Inc. All Rights Reserved. - <a href="../_/https/www.artima.com/privacy.html">Privacy Policy</a> - <a href="../_/https/www.artima.com/termsofuse.html">Terms of Use</a>
</div>
</div>
<br/>
<script language="JavaScript" type="text/javascript">
<!--
function initBannerVarForZone(zone) {
        initBannerVarForZoneWithScript(zone, 'adjs_modified');
}

function initBannerVarForZoneWithScript(zone, phpScript) {

        if (!document.phpAds_used) document.phpAds_used = ',';
        phpAds_random = new String (Math.random());
        phpAds_random = phpAds_random.substring(2,11);

        var nextScriptSrc = '../_/https/www.artima.com/zcr/index.html' + phpScript + '.php?n=' +
                phpAds_random  +
                '&amp;what=zone:' + zone + '&amp;target=_top&amp;block=1&amp;blockcampaign=1' +
                '&amp;exclude=' + document.phpAds_used;

        document.write("<script language='JavaScript' type='text/javascript' src='");
        document.write(nextScriptSrc);
        document.write("'><\/script>");

}

function replaceDiv(divID) {
        document.getElementById(divID).innerHTML = phpadsbanner;
}
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
initBannerVarForZone(3);
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
replaceDiv('leftskyscraper');
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
initBannerVarForZoneWithScript(4, 'textman');
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
replaceDiv('sponsoredlinks');
-->
</script>
</hr><a href="https://dafoster.net/projects/crystal-web-archiver/" id="cr-footer-banner" style="border-top: 2px #B40010 solid;background: #FFFAE1;font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;font-variant: initial;font-weight: initial;text-transform: none;font-size: 14px;color: #6c757d;line-height: 2.0;cursor: pointer;display: flex;align-items: center;justify-content: center;gap: 4px;clear: both;" target="_blank"><img height="24" onerror="this.style['display'] = 'none';" src="../_/crystal/resources/appicon.png" width="24"/><span>This page was archived with Crystal</span><script>window.addEventListener('load', function() { const $1 = document.querySelector('#cr-footer-banner'); if (!$1) { return; } if (window !== window.top) { let $2 = false; if (window.name) { const $3 = window.parent.document.getElementsByName(window.name); if ($3.length === 1) { const $4 = $3[0]; if ($4.tagName === 'FRAME' && $4.parentElement.tagName === 'FRAMESET') { let $5 = $4; while (true) { if ($5.parentElement.tagName !== 'FRAMESET') { $2 = true; break; } if ($5.parentElement.attributes['rows'] !== undefined) { const $6 = $5.parentElement.children; if ($5 === $6[$6.length - 1]) { $5 = $5.parentElement; continue; } else { break; } } else if ($5.parentElement.attributes['cols'] !== undefined) { const $7 = Array.from($5.parentElement.children); const $8 = $7.indexOf($5); if ($8 === -1) { break; } const $9 = $5.parentElement.attributes['cols'].value.split(','); const $10 = $9.map((s) => parseInt(s.trim())); if ($9[$8].trim() === '*' || $10[$8] === Math.max.apply(null, $10)) { $5 = $5.parentElement; continue; } else { break; } } else { break; } } } } } if (!$2) { $1.style['display'] = 'none'; } } const $11 = $1.getBoundingClientRect(); const $12 = ($11.y < window.innerHeight - $11.height); if ($12) { $1.style['position'] = 'fixed'; $1.style['bottom'] = '0'; $1.style['left'] = '0'; $1.style['right'] = '0'; $1.style['z-index'] = '9999'; } const $13 = ( document.body.getBoundingClientRect().height < $11.height * 2 ); if ($13) { $1.style['display'] = 'none'; }
});</script></a></body>
</html>
