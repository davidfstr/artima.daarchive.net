
<!DOCTYPE html>

<html>
<head><meta content="noindex,nofollow" name="robots"/>
<title>Some Objects are More Equal Than Others</title>
<meta charset="utf-8"/>
<meta content="Cay Horstmann" name="author">
<link href="../_/https/www.artima.com/artima.css" rel="stylesheet" type="text/css"/>
<link href="../_/https/www.artima.com/favicon.ico" rel="shortcut icon"/>
</meta></head>
<body><table cellspacing="0" width="100%">
<tr>
<td align="left" valign="bottom">
<a href="../_/https/www.artima.com/index.html"><img alt="The Artima Developer Community" border="0" height="43" src="../_/https/www.artima.com/images/a7.gif" width="550"/></a>
</td>
</tr></table>
<table bgcolor="#333333" width="100%">
<tr>
<td align="center">
<div class="ml">
<a class="hl" href="../_/https/www.artima.com/articles/index.html">Articles</a> |
<a class="hl" href="../_/https/www.artima.com/news/index.html">News</a> |
<a class="hl" href="../index.html">Weblogs</a> |
<a class="hl" href="../_/https/www.artima.com/shop/catalog/index.html">Books</a> |
<a class="hl" href="../_/https/www.artima.com/forums/index.html">Forums</a>
</div>
</td>
</tr>
</table>
<table bgcolor="#CCCCCC" width="100%">
<tr>
<td align="center">
<div class="sc">
<a href="../index.html">Artima Weblogs</a> | 

<a href="../index.html$/blogger=cay.html">Cay Horstmann's Weblog</a> | 

<a href="../_/https/www.artima.com/forums/flat.html$/forum=106&amp;thread=4744.html">Discuss</a> | 
<a href="mailto:?subject=Some Objects are More Equal Than Others&amp;body= %0AArtima Weblogs %0ASome Objects are More Equal Than Others %0Aby Cay Horstmann %0A%0Ahttps://www.artima.com/weblogs/viewpost.jsp?thread=4744">Email</a> | 
<a href="../viewpostP.html$/thread=4744.html">Print</a> | 
<a href="../bloggers.html">Bloggers</a> | 
Previous | 
<a class="sl" href="thread=4894.html" title="Irritating Interfaces and Iterators">Next</a>
</div>
</td>
</tr>
</table>
<table bgcolor="#EEEEEE" width="100%">
<tr>
<td align="center">
<div class="sc">
<span style="color: #555555;">Sponsored Link</span> <span style="color: #888888;">•</span>
<script language="JavaScript" src="../_/https/www.artima.com/zcr/adx.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
   if (!document.phpAds_used) document.phpAds_used = ',';
   phpAds_random = new String (Math.random()); phpAds_random = phpAds_random.substring(2,11);
   
   document.write ("<" + "script language='JavaScript' type='text/javascript' src='");
   document.write ("../_/https/www.artima.com/zcr/adjs.html$/n=.html" + phpAds_random);
   document.write ("&amp;what=zone:9&amp;target=_top");   document.write ("&amp;exclude=" + document.phpAds_used);
   if (document.referrer)
      document.write ("&amp;referer=" + escape(document.referrer));
   document.write ("'><" + "/script>");
//-->
</script><noscript><a href="../_/https/www.artima.com/zcr/adclick.html$/n=a799ecf6.html" target="_top"><img alt="" border="0" src="../_/https/www.artima.com/zcr/adview.html$/what=zone:9&amp;n=a0587811.html"/></a></noscript>
</div>
</td>
</tr>
</table>
<br/>
<div class="vegies">
<div class="tc">
<span class="sts">The Coding Curmudgeon</span><br>
<span class="ts">Some Objects are More Equal Than Others</span><br/>
<span class="as">by Cay Horstmann</span><br/>
<span class="pd">May 9, 2003</span><br/>
</br></div>
<blockquote>
<b>Summary</b><br/>
Many Java programmers believe that they should include an instanceof test in equals methods. Many authors egg them on. This article explains why this is very wrong and muddleheaded in almost all cases, and urges programmers to test for equality of classes instead.

</blockquote>
<hr align="left" width="90%"/>
<table align="right">
<tr>
<td>
<div class="adnotice">
Advertisement
</div>
<center>
<script language="JavaScript" src="../_/https/www.artima.com/zcr/adx.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
if (!document.phpAds_used) document.phpAds_used = ',';
phpAds_random = new String (Math.random()); phpAds_random = phpAds_random.substring(2,11);
document.write ("<" + "script language='JavaScript' type='text/javascript' src='");
document.write ("../_/https/www.artima.com/zcr/adjs.html$/n=.html" + phpAds_random);
document.write ("&amp;what=zone:2");
document.write ("&amp;exclude=" + document.phpAds_used);
if (document.referrer)
document.write ("&amp;referer=" + escape(document.referrer));
document.write ("'><" + "/script>");
//-->
</script><noscript><a href="../_/https/www.artima.com/zcr/adclick.html$/n=a74ab060.html" target="_blank"><img alt="" border="0" src="../_/https/www.artima.com/zcr/adview.html$/what=zone:2&amp;n=a74ab060.html"/></a></noscript>
</center>
</td>
</tr>
</table>
<p>
The Java Language Specification states that the <span style="font-family: monospace;">equals</span> method of any class
should be reflexive, symmetric (well, almost...<span style="font-family: monospace;">null.equals(x)</span> is different from <span style="font-family: monospace;">x.equals(null)</span>), and
transitive. <br/>
<br/>
That's easy enough to achieve:<br/>
<br/>
<pre>public Employee<br/>{<br/>   public boolean equals(Object other)<br/>   {<br/>      if (getClass() != other.getClass()) return false;<br/>      // cast other to Employee and compare fields<br/>      . . .<br/>   }<br/>}<br/></pre>
<p>What bugs me is how many programmers do something different and
dangerous, and how many authors egg them on. If you look at the
implementations of <span style="font-family: monospace;">equals</span>
in the source of the standard library (about 150), you will find that
the majority use an <span style="font-family: monospace;">instanceof</span>
test instead. <br/>
</p>
<pre>public Employee<br/>{<br/>   public boolean equals(Object other)<br/>   {<br/>      if (!(other instanceof Employee)) return false;<br/>      // cast other to Employee and compare fields<br/>      . . .<br/>   }<br/>}<br/><span style="font-style: italic;"></span><span style="font-style: italic;"></span></pre>
<p>This is a crummy idea. In many (most?) cases, a subclass will want
to override <span style="font-family: monospace;">equals</span> by
comparing the superclass fields and the subclass fields, like this:<br/>
</p>
<pre>public Manager extends Employee<br/>{<br/>   public boolean equals(Object other)<br/>   {<br/>      . . . <br/>      if (!super.equals(other)) return false;<br/>      // cast other to Manager and compare fields<br/>      return bonus == ((Manager)other).bonus;<br/>   }<br/>}<br/><span style="font-style: italic;"></span><span style="font-style: italic;"></span></pre>
<p>But now <span style="font-family: monospace;">equals</span> has
become seriously asymmetric:<br/>
</p>
<ul>
<li><span style="font-family: monospace;">anEmployee.equals(aManager)</span>
compares <span style="font-family: monospace;">true</span> if the
employee and manager have the same superclass data</li>
<li><span style="font-family: monospace;">aManager.equals(anEmployee)</span>
throws an exception</li>
</ul>
That problem can be avoided easily. Does it ever make sense for an <span style="font-family: monospace;">Employee</span> to equal a <span style="font-family: monospace;">Manager</span>? No. Just forget about <span style="font-family: monospace;">instanceof</span> and test for equality
of classes instead.<br/>
<p>Why don't more authors mention this?<br/>
</p>
<p>For example, Josh Bloch has a chapter on <span style="font-family: monospace;">equals</span> in his Effective Java
book, and he never once mentions the <span style="font-family: monospace;">getClass() != other.getClass()</span>
test. <br/>
</p>
<p>Instead, he pontificates about a rather pointless example with <span style="font-family: monospace;">Point</span> and <span style="font-family: monospace;">ColoredPoint</span> classes where <span style="font-family: monospace;">equals</span> does <span style="font-style: italic;">not</span> take the point's colors into
consideration.<br/>
</p>
<p>Why is there a stubborn refusal in the Java literature to recognize
the obvious?<br/>
</p>
<ul>
<li>You should almost always test for <span style="font-family: monospace;">getClass() != other.getClass()</span>
in an <span style="font-family: monospace;">equals</span> method</li>
<li>There is a <span style="font-style: italic;">small</span> number
of cases where <span style="font-family: monospace;">instanceof</span>
makes sense, namely if<br/>
</li>
<ul>
<li>a superclass has fixed the semantics for <span style="font-family: monospace;">equals</span></li>
<li>the state of various subclasses differ in inessential ways from
the state of the superclass</li>
<li>and the subclasses can add value by redefining <span style="font-family: monospace;">equals</span> to be more efficient<br/>
</li>
</ul>
This is the case in the java.util.Collection hierarchy.
</ul>
<span style="font-family: monospace;"></span>If a class is <span style="font-family: monospace;">final</span> it doesn't matter. But
there are lots of non-final classes with bad definitions of <span style="font-family: monospace;">equals</span>, for no better reason
than that the folks who should know better set a bad example. <br/>
<br/>
That's my pet peeve of the day.

<h1>Talk Back!</h1>
<p>
Have an opinion?


Readers have already posted

<a href="../_/https/www.artima.com/forums/flat.html$/forum=106&amp;thread=4744.html">28

comments</a>
about this weblog entry. Why not

<a href="../_/https/www.artima.com/forums/post.html$/forum=106&amp;thread=4744&amp;reply=true.html">add yours</a>?


<h1>RSS Feed</h1>
<p>
If you'd like to be notified whenever Cay Horstmann adds a new entry to <a href="../index.html$/blogger=cay.html">his weblog</a>, subscribe to his <a href="../feeds/bloggers/cay.rss">RSS feed</a>.

<center>
<div class="sociallinks">
<a href="../_/http/digg.com/submit$/phase=2&amp;url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D4744&amp;title=Some+Objects+are+More+Equal+Than+Others&amp;bodytext=Many+Java+programmers+believe+that+they+should+include+an+instanceof+test+in+equals+methods.+Many+authors+egg+them+on.+This+article+explains+why+this+is+very+wrong+and+muddleheaded+in+almost+all+cases%2C+and+urges+programmers+to+test+for+equality+of+_&amp;topic=programming">
<img alt="Digg" border="0" height="14" hspace="8" src="../_/https/www.artima.com/images/digg.gif" width="16">Digg
  </img></a>
  |
  <a href="../_/http/del.icio.us/post$/url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D4744&amp;title=Some+Objects+are+More+Equal+Than+Others">
<img alt="del.icio.us" border="0" height="16" hspace="8" src="../_/https/www.artima.com/images/delicious.gif" vspace="1" width="16">del.icio.us
  </img></a>
  |
  <a href="../_/http/programming.reddit.com/submit$/url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D4744&amp;title=Some+Objects+are+More+Equal+Than+Others">
<img alt="Reddit" border="0" height="18" hspace="8" src="../_/https/www.artima.com/images/reddit.gif" width="18"/>Reddit
  </a>
</div>
</center>
<h1>About the Blogger</h1>
<p>
<table><tr valign="bottom"><td><img align="right" src="../_/https/www.artima.com/images/cayHorstman.jpg"/></td><td>Cay Horstmann is a professor of computer science at San Jose State University. He is an experienced professional programmer and was VP of Technology and CTO at Preview Systems Inc. He wrote many successful professional and college books, including Core Java (with Gary Cornell), Big Java, Big C++ (with Tim Budd), and OO Design &amp; Patterns.</td></tr></table><p>
<div class="sp">This weblog entry is Copyright © 2003 Cay Horstmann. All rights reserved.</div>
</p></p></p></p></p></div>

<hr width="100%">
<table align="center" width="50%">
<tr>
<td>
<div class="horizontaltextadbox">
<div class="adheadline">Sponsored Links</div>
<div id="sponsoredlinks">
</div>
</div>
</td>
</tr>
</table>
<hr width="100%"/>
<center>
<script type="text/javascript"><!--
google_ad_client = "pub-3911176865765226";
google_alternate_color = "ffffff";
google_ad_width = 728;
google_ad_height = 15;
google_ad_format = "728x15_0ads_al";
google_ad_channel = "";
google_color_border = "ffffff";
google_color_bg = "FFFFFF";
google_color_link = "003090";
google_color_text = "000000";
google_color_url = "666666";
//--></script>
<script src="../_/https/pagead2.googlesyndication.com/pagead/show_ads.js" type="text/javascript">
</script>
<br>
<br>
<!-- SiteSearch Google -->
<form action="../_/https/www.google.com/custom/index.html" method="get">
<table bgcolor="#ffffff" border="0">
<tr><td align="left" height="32" nowrap="nowrap" valign="top">
<a href="../_/https/www.google.com/index.html">
<img alt="Google" border="0" src="../_/https/www.google.com/logos/Logo_25wht.gif"/></a>
</td>
<td nowrap="nowrap">
<input name="domains" type="hidden" value="Artima.com"/>
<input maxlength="255" name="q" size="31" type="text" value=""/>
<input name="sa" type="submit" value="Search"/>
</td></tr>
<tr>
<td> </td>
<td nowrap="nowrap">
<font color="#000000" size="-1">
<input name="sitesearch" type="radio" value=""/> Web
<input checked="checked" name="sitesearch" type="radio" value="Artima.com"/>Artima.com
</font>  
<input name="client" type="hidden" value="pub-3911176865765226"/>
<input name="forid" type="hidden" value="1"/>
<input name="ie" type="hidden" value="ISO-8859-1"/>
<input name="oe" type="hidden" value="ISO-8859-1"/>
<input name="cof" type="hidden" value="GALT:#008000;GL:1;DIV:#336699;VLC:663399;AH:center;BGC:FFFFFF;LBGC:FFFFFF;ALC:0000FF;LC:0000FF;T:000000;GFNT:0000FF;GIMP:0000FF;LH:50;LW:150;L:https://www.artima.com/images/artima150.gif;S:https://www.artima.com;FORID:1;"/>
<input name="hl" type="hidden" value="en"/>
</td></tr></table>
</form>
<!-- SiteSearch Google -->
</br></br></center>
<br>
<div class="sp">
<div style="text-align: center;">
<a href="../_/https/www.artima.com/copyright.html">Copyright</a> © 1996-2019 Artima, Inc. All Rights Reserved. - <a href="../_/https/www.artima.com/privacy.html">Privacy Policy</a> - <a href="../_/https/www.artima.com/termsofuse.html">Terms of Use</a>
</div>
</div>
<br>
<script language="JavaScript" type="text/javascript">
<!--
function initBannerVarForZone(zone) {
        initBannerVarForZoneWithScript(zone, 'adjs_modified');
}

function initBannerVarForZoneWithScript(zone, phpScript) {

        if (!document.phpAds_used) document.phpAds_used = ',';
        phpAds_random = new String (Math.random());
        phpAds_random = phpAds_random.substring(2,11);

        var nextScriptSrc = '../_/https/www.artima.com/zcr/index.html' + phpScript + '.php?n=' +
                phpAds_random  +
                '&amp;what=zone:' + zone + '&amp;target=_top&amp;block=1&amp;blockcampaign=1' +
                '&amp;exclude=' + document.phpAds_used;

        document.write("<script language='JavaScript' type='text/javascript' src='");
        document.write(nextScriptSrc);
        document.write("'><\/script>");

}

function replaceDiv(divID) {
        document.getElementById(divID).innerHTML = phpadsbanner;
}
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
initBannerVarForZone(3);
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
replaceDiv('leftskyscraper');
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
initBannerVarForZoneWithScript(4, 'textman');
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
replaceDiv('sponsoredlinks');
-->
</script>
</br></br></hr><a href="https://dafoster.net/projects/crystal-web-archiver/" id="cr-footer-banner" style="border-top: 2px #B40010 solid;background: #FFFAE1;font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;font-variant: initial;font-weight: initial;text-transform: none;font-size: 14px;color: #6c757d;line-height: 2.0;cursor: pointer;display: flex;align-items: center;justify-content: center;gap: 4px;clear: both;" target="_blank"><img height="24" onerror="this.style['display'] = 'none';" src="../_/crystal/resources/appicon.png" width="24"/><span>This page was archived with Crystal</span><script>window.addEventListener('load', function() { const $1 = document.querySelector('#cr-footer-banner'); if (!$1) { return; } if (window !== window.top) { let $2 = false; if (window.name) { const $3 = window.parent.document.getElementsByName(window.name); if ($3.length === 1) { const $4 = $3[0]; if ($4.tagName === 'FRAME' && $4.parentElement.tagName === 'FRAMESET') { let $5 = $4; while (true) { if ($5.parentElement.tagName !== 'FRAMESET') { $2 = true; break; } if ($5.parentElement.attributes['rows'] !== undefined) { const $6 = $5.parentElement.children; if ($5 === $6[$6.length - 1]) { $5 = $5.parentElement; continue; } else { break; } } else if ($5.parentElement.attributes['cols'] !== undefined) { const $7 = Array.from($5.parentElement.children); const $8 = $7.indexOf($5); if ($8 === -1) { break; } const $9 = $5.parentElement.attributes['cols'].value.split(','); const $10 = $9.map((s) => parseInt(s.trim())); if ($9[$8].trim() === '*' || $10[$8] === Math.max.apply(null, $10)) { $5 = $5.parentElement; continue; } else { break; } } else { break; } } } } } if (!$2) { $1.style['display'] = 'none'; } } const $11 = $1.getBoundingClientRect(); const $12 = ($11.y < window.innerHeight - $11.height); if ($12) { $1.style['position'] = 'fixed'; $1.style['bottom'] = '0'; $1.style['left'] = '0'; $1.style['right'] = '0'; $1.style['z-index'] = '9999'; } const $13 = ( document.body.getBoundingClientRect().height < $11.height * 2 ); if ($13) { $1.style['display'] = 'none'; }
});</script></a></body>
</html>
