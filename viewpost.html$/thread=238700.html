
<!DOCTYPE html>

<html>
<head><meta content="noindex,nofollow" name="robots"/>
<title>Service Locator Pattern Revisited, Part 2</title>
<meta charset="utf-8"/>
<meta content="Ian Robertson" name="author">
<link href="../_/https/www.artima.com/artima.css" rel="stylesheet" type="text/css"/>
<link href="../_/https/www.artima.com/favicon.ico" rel="shortcut icon"/>
</meta></head>
<body><table cellspacing="0" width="100%">
<tr>
<td align="left" valign="bottom">
<a href="../_/https/www.artima.com/index.html"><img alt="The Artima Developer Community" border="0" height="43" src="../_/https/www.artima.com/images/a7.gif" width="550"/></a>
</td>
</tr></table>
<table bgcolor="#333333" width="100%">
<tr>
<td align="center">
<div class="ml">
<a class="hl" href="../_/https/www.artima.com/articles/index.html">Articles</a> |
<a class="hl" href="../_/https/www.artima.com/news/index.html">News</a> |
<a class="hl" href="../index.html">Weblogs</a> |
<a class="hl" href="../_/https/www.artima.com/shop/catalog/index.html">Books</a> |
<a class="hl" href="../_/https/www.artima.com/forums/index.html">Forums</a>
</div>
</td>
</tr>
</table>
<table bgcolor="#CCCCCC" width="100%">
<tr>
<td align="center">
<div class="sc">
<a href="../index.html">Artima Weblogs</a> | 

<a href="../index.html$/blogger=ianr.html">Ian Robertson's Weblog</a> | 

<a href="../_/https/www.artima.com/forums/flat.html$/forum=106&amp;thread=238700.html">Discuss</a> | 
<a href="mailto:?subject=Service Locator Pattern Revisited, Part 2&amp;body= %0AArtima Weblogs %0AService Locator Pattern Revisited, Part 2 %0Aby Ian Robertson %0A%0Ahttps://www.artima.com/weblogs/viewpost.jsp?thread=238700">Email</a> | 
<a href="../viewpostP.html$/thread=238700.html">Print</a> | 
<a href="../bloggers.html">Bloggers</a> | 
<a class="sl" href="thread=238562.html" title="Service Locator Pattern Revisited, Part 1">Previous</a> | 
<a class="sl" href="thread=281160.html" title="Pattern matching in Scala for expressions">Next</a>
</div>
</td>
</tr>
</table>
<table bgcolor="#EEEEEE" width="100%">
<tr>
<td align="center">
<div class="sc">
<span style="color: #555555;">Sponsored Link</span> <span style="color: #888888;">•</span>
<script language="JavaScript" src="../_/https/www.artima.com/zcr/adx.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
   if (!document.phpAds_used) document.phpAds_used = ',';
   phpAds_random = new String (Math.random()); phpAds_random = phpAds_random.substring(2,11);
   
   document.write ("<" + "script language='JavaScript' type='text/javascript' src='");
   document.write ("../_/https/www.artima.com/zcr/adjs.html$/n=.html" + phpAds_random);
   document.write ("&amp;what=zone:9&amp;target=_top");   document.write ("&amp;exclude=" + document.phpAds_used);
   if (document.referrer)
      document.write ("&amp;referer=" + escape(document.referrer));
   document.write ("'><" + "/script>");
//-->
</script><noscript><a href="../_/https/www.artima.com/zcr/adclick.html$/n=a799ecf6.html" target="_top"><img alt="" border="0" src="../_/https/www.artima.com/zcr/adview.html$/what=zone:9&amp;n=a0587811.html"/></a></noscript>
</div>
</td>
</tr>
</table>
<br/>
<div class="vegies">
<div class="tc">
<span class="sts">Code by Any Other Name</span><br>
<span class="ts">Service Locator Pattern Revisited, Part 2</span><br/>
<span class="as">by Ian Robertson</span><br/>
<span class="pd">September 17, 2008</span><br/>
</br></div>
<blockquote>
<b>Summary</b><br/>
Once the boilerplate traditionally associated with the Service Locator Pattern is eliminated, one of the key motivations for Dependency Injection is reduced, if not eliminated.  This article, the second of a two part series, looks at the pros and cons of each approach to interacting with services.

</blockquote>
<hr align="left" width="90%"/>
<table align="right">
<tr>
<td>
<div class="adnotice">
Advertisement
</div>
<center>
<script language="JavaScript" src="../_/https/www.artima.com/zcr/adx.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
if (!document.phpAds_used) document.phpAds_used = ',';
phpAds_random = new String (Math.random()); phpAds_random = phpAds_random.substring(2,11);
document.write ("<" + "script language='JavaScript' type='text/javascript' src='");
document.write ("../_/https/www.artima.com/zcr/adjs.html$/n=.html" + phpAds_random);
document.write ("&amp;what=zone:2");
document.write ("&amp;exclude=" + document.phpAds_used);
if (document.referrer)
document.write ("&amp;referer=" + escape(document.referrer));
document.write ("'><" + "/script>");
//-->
</script><noscript><a href="../_/https/www.artima.com/zcr/adclick.html$/n=a74ab060.html" target="_blank"><img alt="" border="0" src="../_/https/www.artima.com/zcr/adview.html$/what=zone:2&amp;n=a74ab060.html"/></a></noscript>
</center>
</td>
</tr>
</table>
<p>
<p>
In <a href="../_/http/www.artima.com/weblogs/viewpost.html$/thread=238562.html">Part
1</a>, we looked at Bordello, a simple implementation of the Service
Locator Pattern to aid in making code more testable.  Of course, the
Service Locator Pattern isn't the only way to accomplish this; using a
Dependency Injection framework such
as <a href="../_/http/www.springframework.org/index.html">Spring</a>
or <a href="../_/http/code.google.com/p/google-guice/index.html">Guice</a> is
another popular technique.  One reason for the popularity of
Dependency Injection is the perceived difficulty associated with the
Service Locator Pattern.  Indeed, Crazy Bob Lee
<a href="../_/http/crazybob.org/2007/10/guice-interview-on-tss.html">touts
this</a> as one of the motivations for Guice:</p>
<blockquote>
<p>Before Guice, I had to make the same up-front decision over and
over: do I call a constructor directly, or do I write a factory and
call it instead? If you start out calling a constructor and later
decide that you need a factory, you have to go back and change all the
callers. On the other hand, factories come at a cost: they clutter
your API and result in a bunch of boilerplate code which you have to
both write and maintain.</p>
</blockquote>
<p>
As we saw in Part 1, it's actually quite easy to have a lightweight
Service Locator which doesn't require writing new factories for each
service.  To quickly review, client code simply
calls <code>Bordello.get</code> to acquire services as it needs them.

<blockquote>
<code>
<font color="#7f0055"><b>public class </b></font><font color="#000000">HelloClient </font><font color="#000000">{</font><br>
<font color="#ffffff">  </font><font color="#7f0055"><b>public </b></font><font color="#7f0055"><b>void </b></font><font color="#000000">greetFormally</font><font color="#000000">(</font><font color="#000000">String surname</font><font color="#000000">) {</font><br/>
<font color="#ffffff">    </font><font color="#000000">Bordello.get</font><font color="#000000">(</font><font color="#000000">HelloService.</font><font color="#7f0055"><b>class</b></font><font color="#000000">)</font><font color="#000000">.sayHello</font><font color="#000000">(</font><font color="#2a00ff">"Sir " </font><font color="#000000">+ surname</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">  </font><font color="#000000">}</font><br/>
<font color="#000000">}</font></br></code>
</blockquote>

By contrast, a client using Guice will have services injected at
construction time, and might look like:

<blockquote>
<code>
<font color="#7f0055"><b>public class </b></font><font color="#000000">HelloClient {</font><br/>
  <font color="#646464">@Inject</font><br/>
  <font color="#7f0055"><b>private </b></font><font color="#000000">HelloService service;</font><br/>
<br/>
  <font color="#7f0055"><b>public </b></font><font color="#7f0055"><b>void </b></font><font color="#000000">greetFormally(String surname) {</font><br/>
    <font color="#000000">helloService.sayHello("Sir " + surname);</font><br/>
  <font color="#000000">}</font><br/>
<font color="#000000">}</font></code>

</blockquote>
<h2>Comparing Bordello with Dependency Injection</h2>
<p>On the surface, DI frameworks and this sort of "generic" service
locator seem very different.  It turns out, however, that while the
two approaches feel quite different, their behavior in most ways is
strikingly similar.  Both use interfaces to enable testability.  Both
require some means of specifying the preferred implementation of a
service; Bordello uses annotations for this (as does Guice, and later
versions of Spring), but XML or other code-based configuration could
just as easily be used, as could a convention-over-configuration
approach.  To determine what DI services a class uses, you look for
member variables which are flagged for injection; to determine the
Bordello services used, look for occurrences
of <code>Bordello.get</code>.</p>
<p>There, however are a few notable differences.  Perhaps the most
obvious is the ways in which each approach ties code to the framework.
On the plus side for DI, a typical DI client might not have any
reference to the framework which will be used to inject its
dependencies.  As such, client code has no dependency on the DI
framework.  In contrast, a client relying on Bordello will have a
reference to the Bordello class.  In practice, I'm not convinced that
this is that great of a cost; I've not heard any cases of a project
switching DI frameworks in midstream.  However, while a class can
reference a client which uses Bordello and be none the wiser,
typically to use a client which relies on DI, one must have the DI
framework provide that client.  While this may not create dependencies
in a formal sense, it does place certain restrictions on how one can
go about acquiring instances.</p>
<p>Another impact of using DI is the requirement that a member
variable be declared for each injected service; depending on one's
style preferences, a setter or constructor argument might be required
as well.  While this is a fairly lightweight requirement as
boilerplate goes, it does have a couple undesirable side effects.  The
first effect is that (in the case of using setter methods or
constructor arguments) the services a class chooses to interact with
now become part of its API.  The fact that a class is a client of
<code>HelloService</code> is an implementation detail, and should not
need to be advertised.  The second effect is that all of a class's
dependencies must be instantiated when an instance of that class is
first created.  Because of the transitive nature of DI, this
effectively means creating a whole object graph upon startup.  On the
up side, this means that a DI framework can catch certain problems
with circular or undefined dependencies early rather than late.  On
the down side, if you want to lazily construct a service on an
as-needed basis, you are forced to go back to the Factory Pattern, and
just inject a factory for your service, rather than the service
itself.  Notably, if that service has its own requirements, the
factory may need to explicitely reference the DI framework in order
to inject dependencies.</p>
<p>
A nice feature of Bordello is that it is self-managing; no start up
code is required.  While DI frameworks generally require some initial
bootstrap work to create a container, Bordello is designed to create
service instances upon first request, with no prior initialization
work.  This is particularly handy for libraries which want
to avoid creating any unnecessary usage requirements for their
clients.</p>
<p>One thing that Bordello does not attempt to do is provide multiple
different implementations of a service in production.  This could
certainly be done; for example, an <code>@Implementors</code>
annotation could contain multiple <code>@Implementation</code>
annotations, each distinguished by some sort of key.  At my company,
however, we have simply found very little need for this.  Notably, we
do not produce shrink-wrapped software which would need to be deployed
in a variety of environments, so we don't need to, for example,
support multiple different ORM strategies.</p>
<p>An area easily addressed by both approaches is configuration of
services.  For example, one can have Spring configure a service by
providing configuration information in their beans.xml file, which
Spring will then inject into their instances.  With Bordello,
configuration is up to the instance itself; it helps therefore to have
a <code>ConfigurationService</code> which services can use; this
service of course can be acquired through Bordello.</p>
<h2>Conclusion</h2>
<p>Despite the cosmetic differences between the Service Locator
Pattern and Dependency Injection, the two are functionally quite
similar.  The biggest difference between them is not what can be
accomplished, or even accomplished easily, but rather the style of
programming that each requires.  The Service Locator Pattern is a
code-focused approach; when an instance of a service is needed, code
explicitely calls out to a service locator to obtain it.  In contrast,
Dependency Injection is a more extralinguistic approach, providing
clients their dependencies without any explicit action on the clients
behalf.<img align="top" height="15" src="../_/https/www.artima.com/images/ik.gif" width="15"/>
</p>
<h1>Talk Back!</h1>
<p>
Have an opinion?


Readers have already posted

<a href="../_/https/www.artima.com/forums/flat.html$/forum=106&amp;thread=238700.html">12

comments</a>
about this weblog entry. Why not

<a href="../_/https/www.artima.com/forums/post.html$/forum=106&amp;thread=238700&amp;reply=true.html">add yours</a>?


<h1>RSS Feed</h1>
<p>
If you'd like to be notified whenever Ian Robertson adds a new entry to <a href="../index.html$/blogger=ianr.html">his weblog</a>, subscribe to his <a href="../feeds/bloggers/ianr.rss">RSS feed</a>.

<center>
<div class="sociallinks">
<a href="../_/http/digg.com/submit$/phase=2&amp;url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D238700&amp;title=Service+Locator+Pattern+Revisited%2C+Part+2&amp;bodytext=Once+the+boilerplate+traditionally+associated+with+the+Service+Locator+Pattern+is+eliminated%2C+one+of+the+key+motivations+for+Dependency+Injection+is+reduced%2C+if+not+eliminated.++This+article%2C+the+second+of+a+two+part+series%2C+looks+at+the+pros+and+cons+_&amp;topic=programming">
<img alt="Digg" border="0" height="14" hspace="8" src="../_/https/www.artima.com/images/digg.gif" width="16">Digg
  </img></a>
  |
  <a href="../_/http/del.icio.us/post$/url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D238700&amp;title=Service+Locator+Pattern+Revisited%2C+Part+2">
<img alt="del.icio.us" border="0" height="16" hspace="8" src="../_/https/www.artima.com/images/delicious.gif" vspace="1" width="16">del.icio.us
  </img></a>
  |
  <a href="../_/http/programming.reddit.com/submit$/url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D238700&amp;title=Service+Locator+Pattern+Revisited%2C+Part+2">
<img alt="Reddit" border="0" height="18" hspace="8" src="../_/https/www.artima.com/images/reddit.gif" width="18">Reddit
  </img></a>
</div>
</center>
<h1>About the Blogger</h1>
<p>
<table><tr valign="bottom"><td><img align="right" src="../_/https/www.artima.com/images/ianRobertson.jpg"/></td><td>Ian Robertson is an application architect at Verisk Health. He is interested in finding concise means of expression in Java without sacrificing type safety. He contributes to various open source projects, including <a href="../_/http/www.jamon.org/index.html">jamon</a> and <a href="../_/http/www.pojomatic.org/index.html">pojomatic</a>.</td></tr></table><p>
<div class="sp">This weblog entry is Copyright © 2008 Ian Robertson. All rights reserved.</div>
</p></p></p></p></p></p></div>

<hr width="100%">
<table align="center" width="50%">
<tr>
<td>
<div class="horizontaltextadbox">
<div class="adheadline">Sponsored Links</div>
<div id="sponsoredlinks">
</div>
</div>
</td>
</tr>
</table>
<hr width="100%"/>
<center>
<script type="text/javascript"><!--
google_ad_client = "pub-3911176865765226";
google_alternate_color = "ffffff";
google_ad_width = 728;
google_ad_height = 15;
google_ad_format = "728x15_0ads_al";
google_ad_channel = "";
google_color_border = "ffffff";
google_color_bg = "FFFFFF";
google_color_link = "003090";
google_color_text = "000000";
google_color_url = "666666";
//--></script>
<script src="../_/https/pagead2.googlesyndication.com/pagead/show_ads.js" type="text/javascript">
</script>
<br/>
<br/>
<!-- SiteSearch Google -->
<form action="../_/https/www.google.com/custom/index.html" method="get">
<table bgcolor="#ffffff" border="0">
<tr><td align="left" height="32" nowrap="nowrap" valign="top">
<a href="../_/https/www.google.com/index.html">
<img alt="Google" border="0" src="../_/https/www.google.com/logos/Logo_25wht.gif"/></a>
</td>
<td nowrap="nowrap">
<input name="domains" type="hidden" value="Artima.com"/>
<input maxlength="255" name="q" size="31" type="text" value=""/>
<input name="sa" type="submit" value="Search"/>
</td></tr>
<tr>
<td> </td>
<td nowrap="nowrap">
<font color="#000000" size="-1">
<input name="sitesearch" type="radio" value=""/> Web
<input checked="checked" name="sitesearch" type="radio" value="Artima.com"/>Artima.com
</font>  
<input name="client" type="hidden" value="pub-3911176865765226"/>
<input name="forid" type="hidden" value="1"/>
<input name="ie" type="hidden" value="ISO-8859-1"/>
<input name="oe" type="hidden" value="ISO-8859-1"/>
<input name="cof" type="hidden" value="GALT:#008000;GL:1;DIV:#336699;VLC:663399;AH:center;BGC:FFFFFF;LBGC:FFFFFF;ALC:0000FF;LC:0000FF;T:000000;GFNT:0000FF;GIMP:0000FF;LH:50;LW:150;L:https://www.artima.com/images/artima150.gif;S:https://www.artima.com;FORID:1;"/>
<input name="hl" type="hidden" value="en"/>
</td></tr></table>
</form>
<!-- SiteSearch Google -->
</center>
<br/>
<div class="sp">
<div style="text-align: center;">
<a href="../_/https/www.artima.com/copyright.html">Copyright</a> © 1996-2019 Artima, Inc. All Rights Reserved. - <a href="../_/https/www.artima.com/privacy.html">Privacy Policy</a> - <a href="../_/https/www.artima.com/termsofuse.html">Terms of Use</a>
</div>
</div>
<br/>
<script language="JavaScript" type="text/javascript">
<!--
function initBannerVarForZone(zone) {
        initBannerVarForZoneWithScript(zone, 'adjs_modified');
}

function initBannerVarForZoneWithScript(zone, phpScript) {

        if (!document.phpAds_used) document.phpAds_used = ',';
        phpAds_random = new String (Math.random());
        phpAds_random = phpAds_random.substring(2,11);

        var nextScriptSrc = '../_/https/www.artima.com/zcr/index.html' + phpScript + '.php?n=' +
                phpAds_random  +
                '&amp;what=zone:' + zone + '&amp;target=_top&amp;block=1&amp;blockcampaign=1' +
                '&amp;exclude=' + document.phpAds_used;

        document.write("<script language='JavaScript' type='text/javascript' src='");
        document.write(nextScriptSrc);
        document.write("'><\/script>");

}

function replaceDiv(divID) {
        document.getElementById(divID).innerHTML = phpadsbanner;
}
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
initBannerVarForZone(3);
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
replaceDiv('leftskyscraper');
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
initBannerVarForZoneWithScript(4, 'textman');
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
replaceDiv('sponsoredlinks');
-->
</script>
</hr><a href="https://dafoster.net/projects/crystal-web-archiver/" id="cr-footer-banner" style="border-top: 2px #B40010 solid;background: #FFFAE1;font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;font-variant: initial;font-weight: initial;text-transform: none;font-size: 14px;color: #6c757d;line-height: 2.0;cursor: pointer;display: flex;align-items: center;justify-content: center;gap: 4px;clear: both;" target="_blank"><img height="24" onerror="this.style['display'] = 'none';" src="../_/crystal/resources/appicon.png" width="24"/><span>This page was archived with Crystal</span><script>window.addEventListener('load', function() { const $1 = document.querySelector('#cr-footer-banner'); if (!$1) { return; } if (window !== window.top) { let $2 = false; if (window.name) { const $3 = window.parent.document.getElementsByName(window.name); if ($3.length === 1) { const $4 = $3[0]; if ($4.tagName === 'FRAME' && $4.parentElement.tagName === 'FRAMESET') { let $5 = $4; while (true) { if ($5.parentElement.tagName !== 'FRAMESET') { $2 = true; break; } if ($5.parentElement.attributes['rows'] !== undefined) { const $6 = $5.parentElement.children; if ($5 === $6[$6.length - 1]) { $5 = $5.parentElement; continue; } else { break; } } else if ($5.parentElement.attributes['cols'] !== undefined) { const $7 = Array.from($5.parentElement.children); const $8 = $7.indexOf($5); if ($8 === -1) { break; } const $9 = $5.parentElement.attributes['cols'].value.split(','); const $10 = $9.map((s) => parseInt(s.trim())); if ($9[$8].trim() === '*' || $10[$8] === Math.max.apply(null, $10)) { $5 = $5.parentElement; continue; } else { break; } } else { break; } } } } } if (!$2) { $1.style['display'] = 'none'; } } const $11 = $1.getBoundingClientRect(); const $12 = ($11.y < window.innerHeight - $11.height); if ($12) { $1.style['position'] = 'fixed'; $1.style['bottom'] = '0'; $1.style['left'] = '0'; $1.style['right'] = '0'; $1.style['z-index'] = '9999'; } const $13 = ( document.body.getBoundingClientRect().height < $11.height * 2 ); if ($13) { $1.style['display'] = 'none'; }
});</script></a></body>
</html>
