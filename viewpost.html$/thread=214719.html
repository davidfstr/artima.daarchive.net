
<!DOCTYPE html>

<html>
<head><meta content="noindex,nofollow" name="robots"/>
<title>Using Java classes in JRuby</title>
<meta charset="utf-8"/>
<meta content="Eric Armstrong" name="author">
<link href="../_/https/www.artima.com/artima.css" rel="stylesheet" type="text/css"/>
<link href="../_/https/www.artima.com/favicon.ico" rel="shortcut icon"/>
</meta></head>
<body><table cellspacing="0" width="100%">
<tr>
<td align="left" valign="bottom">
<a href="../_/https/www.artima.com/index.html"><img alt="The Artima Developer Community" border="0" height="43" src="../_/https/www.artima.com/images/a7.gif" width="550"/></a>
</td>
</tr></table>
<table bgcolor="#333333" width="100%">
<tr>
<td align="center">
<div class="ml">
<a class="hl" href="../_/https/www.artima.com/articles/index.html">Articles</a> |
<a class="hl" href="../_/https/www.artima.com/news/index.html">News</a> |
<a class="hl" href="../index.html">Weblogs</a> |
<a class="hl" href="../_/https/www.artima.com/shop/catalog/index.html">Books</a> |
<a class="hl" href="../_/https/www.artima.com/forums/index.html">Forums</a>
</div>
</td>
</tr>
</table>
<table bgcolor="#CCCCCC" width="100%">
<tr>
<td align="center">
<div class="sc">
<a href="../index.html">Artima Weblogs</a> | 

<a href="../index.html$/blogger=cooltools.html">Eric Armstrong's Weblog</a> | 

<a href="../_/https/www.artima.com/forums/flat.html$/forum=106&amp;thread=214719.html">Discuss</a> | 
<a href="mailto:?subject=Using Java classes in JRuby&amp;body= %0AArtima Weblogs %0AUsing Java classes in JRuby %0Aby Eric Armstrong %0A%0Ahttps://www.artima.com/weblogs/viewpost.jsp?thread=214719">Email</a> | 
<a href="../viewpostP.html$/thread=214719.html">Print</a> | 
<a href="../bloggers.html">Bloggers</a> | 
<a class="sl" href="thread=205945.html" title="JavaOne 2007, #4: Wrapup">Previous</a> | 
<a class="sl" href="thread=220774.html" title="Why I want a Ruby version of &lt;Project-X&gt;">Next</a>
</div>
</td>
</tr>
</table>
<table bgcolor="#EEEEEE" width="100%">
<tr>
<td align="center">
<div class="sc">
<span style="color: #555555;">Sponsored Link</span> <span style="color: #888888;">•</span>
<script language="JavaScript" src="../_/https/www.artima.com/zcr/adx.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
   if (!document.phpAds_used) document.phpAds_used = ',';
   phpAds_random = new String (Math.random()); phpAds_random = phpAds_random.substring(2,11);
   
   document.write ("<" + "script language='JavaScript' type='text/javascript' src='");
   document.write ("../_/https/www.artima.com/zcr/adjs.html$/n=.html" + phpAds_random);
   document.write ("&amp;what=zone:9&amp;target=_top");   document.write ("&amp;exclude=" + document.phpAds_used);
   if (document.referrer)
      document.write ("&amp;referer=" + escape(document.referrer));
   document.write ("'><" + "/script>");
//-->
</script><noscript><a href="../_/https/www.artima.com/zcr/adclick.html$/n=a799ecf6.html" target="_top"><img alt="" border="0" src="../_/https/www.artima.com/zcr/adview.html$/what=zone:9&amp;n=a0587811.html"/></a></noscript>
</div>
</td>
</tr>
</table>
<br/>
<div class="vegies">
<div class="tc">
<span class="sts">Cool Tools and Other Stuff</span><br>
<span class="ts">Using Java classes in JRuby</span><br/>
<span class="as">by Eric Armstrong</span><br/>
<span class="pd">September 18, 2007</span><br/>
</br></div>
<blockquote>
<b>Summary</b><br/>
I put several pieces of information together and experimented to fill in the missing bits. When I was done, I had a program that implemented Java interfaces and accessed external classes, as well as core classes.

</blockquote>
<hr align="left" width="90%"/>
<table align="right">
<tr>
<td>
<div class="adnotice">
Advertisement
</div>
<center>
<script language="JavaScript" src="../_/https/www.artima.com/zcr/adx.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
if (!document.phpAds_used) document.phpAds_used = ',';
phpAds_random = new String (Math.random()); phpAds_random = phpAds_random.substring(2,11);
document.write ("<" + "script language='JavaScript' type='text/javascript' src='");
document.write ("../_/https/www.artima.com/zcr/adjs.html$/n=.html" + phpAds_random);
document.write ("&amp;what=zone:2");
document.write ("&amp;exclude=" + document.phpAds_used);
if (document.referrer)
document.write ("&amp;referer=" + escape(document.referrer));
document.write ("'><" + "/script>");
//-->
</script><noscript><a href="../_/https/www.artima.com/zcr/adclick.html$/n=a74ab060.html" target="_blank"><img alt="" border="0" src="../_/https/www.artima.com/zcr/adview.html$/what=zone:2&amp;n=a74ab060.html"/></a></noscript>
</center>
</td>
</tr>
</table>
<p>
<p>I recently had occasion to write a JRuby script that used Java APIs in the
XDocs CMS. I found most of the information I needed scattered around the
web (the URLs are listed in the Resources section at the end). </p>
<p>I decided to collect the relevant stuff in one place, leaving out the
stuff that seemed extraneous, and adding the additional little bits that
turned out to be necessary. This post contains the results. (But things may well change, so let me know if there are errors or it needs to be brought up to date!)</p>
<blockquote>
<b>Note:</b><br>
  The original of this article (along with any updates) is here:
  <a href="../_/http/blogs.sun.com/coolstuff/entry/using_java_classes_in_jruby/index.html">
  http://blogs.sun.com/coolstuff/entry/using_java_classes_in_jruby</a>
</br></blockquote>
<h2>Requiring JAR Files</h2>
<p>
First, of course, it's necessary to bring in the module that provides the bridge to the JVM:
</p>
<pre>
include Java
</pre>
<p>Some things to note:</p>
<ul><li>Capitalization is significant. </li>
<li>This version generates an error, saying a module name is required but a string has been supplied:
<pre>include 'java'</pre>
</li>
<li>This pre 1.0 form is still out there on some web pages. It doesn't generate any obvious errors, but it doesn't work:
<pre>require 'java'</pre>
</li>
<li>Quotes are an error in this <code>include</code> statement and in the <code>include_class</code> statement. But they're required in the <code>require</code> statement, which comes between them. The mnemonic is "Quotes are required, not included."</li>
</ul>
<p>The program then needed to <code>require</code> every jar file that the program eventually used, even if it wasn't directly referenced in the JRuby script.</p>
<p>Many of the jar files I wound up requiring were implicit. Given a code sample like this: 

<pre>
x = someMethod().someOtherMethod.aThirdMethod()
</pre>
<p>then every intermediate class had to be required into the code. (Since I was converting a Groovy script, I often didn't know what those classes were.) But even when those objects accessed classes internally, those classes had to be required into the program so the JVM knew where to find them. </p>
<p>So I kept running the program, getting a missing class error, looking for it in the 30 or 40 jar files that make up the CMS, and then adding a new <code>require</code> statement when I found it. I eventually wrote a script to search the jars. But it was an interesting lesson. The API documents tell me what package a class is in, but it would be delightful if there were a cross-reference to the JAR it's contained in.)</p>
<p>As a side-note, wildcards in the <code>CLASSPATH</code> setting would be cool. But the <code>require</code>statements, at least, should allow for wildcards. Something like that would have saved me a lot of trouble:</p>
<pre>
require "<em>some/path*.</em>jar"
</pre>
<h2>Including Class Names and Referencing Them</h2>
<p>A lot of the time, requiring the jar files is pretty much <i>all</i> you need to do.
JRuby can generally figure out what the type is by inspection (the
return value from a method, say), so you don't have to explicitly include those classes. But there are times when you do need to specify the class
name in the code (for example, to access a static method). In those
cases, you need to add an <code>include_class</code> statement to your code.</p>
<p>When including classes, and when referencing classes in the code, package names that start with <code>java</code>, <code>javax</code>, <code>org</code>, and <code>com </code> are "magic". You can use those package prefixes as you would any other variable. Other packages referenced in the code need to be prefixed with <code>Java::</code></p>
<p>The "magic" prefixes are "magic" for external packages, as well as for core JVM classes. If you forget the prefix, JRuby gives you an "invalid method" error, because it assumes that the first part of the package is a method that returns an object.</p>
<p>You can also set up constants to shorten the paths:</p>
<pre>
JFrame = javax.swing.JFrame
...
_frame = JFrame.new()
</pre>
<h2>Accessing External Classes</h2>
<p>So far, so good. But somehow I couldn't find quite enough
information on the web to access 3rd party classes. After
examining the writeups listed in the Resources and doing
a lot of experimenting, I was able to make things work
by doing the following:</p>
<p>1. Tell JRuby where to find the JAR files. Options:</p>
<ol type="a">
<li>Put them in the <code>CLASSPATH</code> (did not work for me. JRuby didn't seem to read the environment)</li>
<li>Put them in <code>$RUBY_HOME/lib</code> (haven't tried this)</li>
<li>For NetBeans on Windows, in <code>JRUBY_EXTRA_CLASSPATH</code>
(also didn't work for me)</li>
<li>Give up and specify the jar files with a full path, as I did in Step #2.</li>
<li>Follow the example Rob Di Marco's example and put <code>-I&lt;directory&gt;</code> on the command line for every directory that contains a jar file.</li>
</ol>
<p>
<b>AND</b> </p>
<p>2. Require each jar by name, specifying the full path if the directory it's in hasn't been specified on the command line, as in Step #1.</p>
<p>To my surprise, the <code>CLASSPATH</code> setting in the environment wasn't picked up when the JRuby script was running on Solaris. So this worked:</p>
<pre>
require "/some/path/MyStuff.jar"
</pre>
<p>But not this:</p>
<pre>
require "MyStuff.jar"
</pre>
<p>Without the <code>-I</code> entries on the command line, the latter fails with "no such file to load".</p>
<p>
<b>AND </b></p>
<p>3. Do an <code>include_class</code> on each class that needs to be named in the code,
using a fully qualified package name. Specify the <code>Java::</code> prefix if the package name doesn't start with one of the "magic" packages.</p>
<p>So if a static method returns a <code>Foo</code> object, the code will look like this:</p>
<pre>
include_class Java::some.package.MyClass
...
x = MyClass.staticGetMethod()

</pre>
<p>Note that <code>Foo</code> does not need an <code>include_class</code> statement, since it is not explicitly named in the code.)</p>
<h2>Implementing a Java Interface</h2>
<p>As per the Nabble page (<a href="../_/http/www.nabble.com/What-is-the-current-syntax-for-defining-a-class-in-JRuby-that-implements-a-Java-interface--t4277539.html">http://www.nabble.com/What-is-the-current-syntax-for-defining-a-class-in-JRuby-that-implements-a-Java-interface--t4277539.html</a>), include interfaces into the class as though they were modules:</p>
<pre>
class SomeClass
  include java.lang.Runnable
  include java.lang.Comparable
  def run
  ...
  end
  ...
</pre>
<p>
Or group them together into a single module and include that:</p>
<pre>
module RunCompare
    include java.lang.Runnable
    include java.lang.Comparable
end

class SomeClass
    include RunCompare
    def run
    ...    
    end
    ...
</pre>
<h2>Resources</h2>
<p>Headius:
<br/><a href="../_/http/www.headius.com/jrubywiki/index.php/Calling_Java_from_JRuby/index.html">http://www.headius.com/jrubywiki/index.php/Calling_Java_from_JRuby</a>
<br/>
</p>
<p>Sun:
<br/><a href="../_/http/java.sun.com/developer/technicalArticles/scripting/jruby/index.html">http://java.sun.com/developer/technicalArticles/scripting/jruby/</a>
<br/>
</p>
<p>Nabble:
<br/>
<a href="../_/http/www.nabble.com/What-is-the-current-syntax-for-defining-a-class-in-JRuby-that-implements-a-Java-interface--t4277539.html">http://www.nabble.com/What-is-the-current-syntax-for-defining-a-class-in-JRuby-that-implements-a-Java-interface--t4277539.html</a>
<br/>
</p>
<p>Rob Di Marco's post at Innovation on the Run:<br/>
<a href="../_/http/www.innovationontherun.com/scraping-dynamic-websites-using-jruby-and-htmlunit/index.html">http://www.innovationontherun.com/scraping-dynamic-websites-using-jruby-and-htmlunit/</a><br/></p>
<h1>Talk Back!</h1>
<p>
Have an opinion?


Readers have already posted

<a href="../_/https/www.artima.com/forums/flat.html$/forum=106&amp;thread=214719.html">2

comments</a>
about this weblog entry. Why not

<a href="../_/https/www.artima.com/forums/post.html$/forum=106&amp;thread=214719&amp;reply=true.html">add yours</a>?


<h1>RSS Feed</h1>
<p>
If you'd like to be notified whenever Eric Armstrong adds a new entry to <a href="../index.html$/blogger=cooltools.html">his weblog</a>, subscribe to his <a href="../feeds/bloggers/cooltools.rss">RSS feed</a>.

<center>
<div class="sociallinks">
<a href="../_/http/digg.com/submit$/phase=2&amp;url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D214719&amp;title=Using+Java+classes+in+JRuby&amp;bodytext=I+put+several+pieces+of+information+together+and+experimented+to+fill+in+the+missing+bits.+When+I+was+done%2C+I+had+a+program+that+implemented+Java+interfaces+and+accessed+external+classes%2C+as+well+as+core+classes.&amp;topic=programming">
<img alt="Digg" border="0" height="14" hspace="8" src="../_/https/www.artima.com/images/digg.gif" width="16">Digg
  </img></a>
  |
  <a href="../_/http/del.icio.us/post$/url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D214719&amp;title=Using+Java+classes+in+JRuby">
<img alt="del.icio.us" border="0" height="16" hspace="8" src="../_/https/www.artima.com/images/delicious.gif" vspace="1" width="16">del.icio.us
  </img></a>
  |
  <a href="../_/http/programming.reddit.com/submit$/url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D214719&amp;title=Using+Java+classes+in+JRuby">
<img alt="Reddit" border="0" height="18" hspace="8" src="../_/https/www.artima.com/images/reddit.gif" width="18"/>Reddit
  </a>
</div>
</center>
<h1>About the Blogger</h1>
<p>
<table><tr valign="bottom"><td><img align="right" src="../_/https/www.artima.com/images/ericarmstrong.jpg"/></td><td>Eric Armstrong has been programming and writing professionally since
before there were personal computers. His production experience includes artificial intelligence (AI) programs, system libraries, real-time
programs, and business applications in a variety of languages. He works as a writer and software consultant in
the San Francisco Bay Area. He wrote The JBuilder2 Bible and authored the Java/XML programming tutorial available at http://java.sun.com. Eric is also involved in efforts to design knowledge-based collaboration systems.</td></tr></table><p>
<div class="sp">This weblog entry is Copyright © 2007 Eric Armstrong. All rights reserved.</div>
</p></p></p></p></p></p></div>

<hr width="100%">
<table align="center" width="50%">
<tr>
<td>
<div class="horizontaltextadbox">
<div class="adheadline">Sponsored Links</div>
<div id="sponsoredlinks">
</div>
</div>
</td>
</tr>
</table>
<hr width="100%"/>
<center>
<script type="text/javascript"><!--
google_ad_client = "pub-3911176865765226";
google_alternate_color = "ffffff";
google_ad_width = 728;
google_ad_height = 15;
google_ad_format = "728x15_0ads_al";
google_ad_channel = "";
google_color_border = "ffffff";
google_color_bg = "FFFFFF";
google_color_link = "003090";
google_color_text = "000000";
google_color_url = "666666";
//--></script>
<script src="../_/https/pagead2.googlesyndication.com/pagead/show_ads.js" type="text/javascript">
</script>
<br/>
<br/>
<!-- SiteSearch Google -->
<form action="../_/https/www.google.com/custom/index.html" method="get">
<table bgcolor="#ffffff" border="0">
<tr><td align="left" height="32" nowrap="nowrap" valign="top">
<a href="../_/https/www.google.com/index.html">
<img alt="Google" border="0" src="../_/https/www.google.com/logos/Logo_25wht.gif"/></a>
</td>
<td nowrap="nowrap">
<input name="domains" type="hidden" value="Artima.com"/>
<input maxlength="255" name="q" size="31" type="text" value=""/>
<input name="sa" type="submit" value="Search"/>
</td></tr>
<tr>
<td> </td>
<td nowrap="nowrap">
<font color="#000000" size="-1">
<input name="sitesearch" type="radio" value=""/> Web
<input checked="checked" name="sitesearch" type="radio" value="Artima.com"/>Artima.com
</font>  
<input name="client" type="hidden" value="pub-3911176865765226"/>
<input name="forid" type="hidden" value="1"/>
<input name="ie" type="hidden" value="ISO-8859-1"/>
<input name="oe" type="hidden" value="ISO-8859-1"/>
<input name="cof" type="hidden" value="GALT:#008000;GL:1;DIV:#336699;VLC:663399;AH:center;BGC:FFFFFF;LBGC:FFFFFF;ALC:0000FF;LC:0000FF;T:000000;GFNT:0000FF;GIMP:0000FF;LH:50;LW:150;L:https://www.artima.com/images/artima150.gif;S:https://www.artima.com;FORID:1;"/>
<input name="hl" type="hidden" value="en"/>
</td></tr></table>
</form>
<!-- SiteSearch Google -->
</center>
<br/>
<div class="sp">
<div style="text-align: center;">
<a href="../_/https/www.artima.com/copyright.html">Copyright</a> © 1996-2019 Artima, Inc. All Rights Reserved. - <a href="../_/https/www.artima.com/privacy.html">Privacy Policy</a> - <a href="../_/https/www.artima.com/termsofuse.html">Terms of Use</a>
</div>
</div>
<br/>
<script language="JavaScript" type="text/javascript">
<!--
function initBannerVarForZone(zone) {
        initBannerVarForZoneWithScript(zone, 'adjs_modified');
}

function initBannerVarForZoneWithScript(zone, phpScript) {

        if (!document.phpAds_used) document.phpAds_used = ',';
        phpAds_random = new String (Math.random());
        phpAds_random = phpAds_random.substring(2,11);

        var nextScriptSrc = '../_/https/www.artima.com/zcr/index.html' + phpScript + '.php?n=' +
                phpAds_random  +
                '&amp;what=zone:' + zone + '&amp;target=_top&amp;block=1&amp;blockcampaign=1' +
                '&amp;exclude=' + document.phpAds_used;

        document.write("<script language='JavaScript' type='text/javascript' src='");
        document.write(nextScriptSrc);
        document.write("'><\/script>");

}

function replaceDiv(divID) {
        document.getElementById(divID).innerHTML = phpadsbanner;
}
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
initBannerVarForZone(3);
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
replaceDiv('leftskyscraper');
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
initBannerVarForZoneWithScript(4, 'textman');
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
replaceDiv('sponsoredlinks');
-->
</script>
</hr><a href="https://dafoster.net/projects/crystal-web-archiver/" id="cr-footer-banner" style="border-top: 2px #B40010 solid;background: #FFFAE1;font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;font-variant: initial;font-weight: initial;text-transform: none;font-size: 14px;color: #6c757d;line-height: 2.0;cursor: pointer;display: flex;align-items: center;justify-content: center;gap: 4px;clear: both;" target="_blank"><img height="24" onerror="this.style['display'] = 'none';" src="../_/crystal/resources/appicon.png" width="24"/><span>This page was archived with Crystal</span><script>window.addEventListener('load', function() { const $1 = document.querySelector('#cr-footer-banner'); if (!$1) { return; } if (window !== window.top) { let $2 = false; if (window.name) { const $3 = window.parent.document.getElementsByName(window.name); if ($3.length === 1) { const $4 = $3[0]; if ($4.tagName === 'FRAME' && $4.parentElement.tagName === 'FRAMESET') { let $5 = $4; while (true) { if ($5.parentElement.tagName !== 'FRAMESET') { $2 = true; break; } if ($5.parentElement.attributes['rows'] !== undefined) { const $6 = $5.parentElement.children; if ($5 === $6[$6.length - 1]) { $5 = $5.parentElement; continue; } else { break; } } else if ($5.parentElement.attributes['cols'] !== undefined) { const $7 = Array.from($5.parentElement.children); const $8 = $7.indexOf($5); if ($8 === -1) { break; } const $9 = $5.parentElement.attributes['cols'].value.split(','); const $10 = $9.map((s) => parseInt(s.trim())); if ($9[$8].trim() === '*' || $10[$8] === Math.max.apply(null, $10)) { $5 = $5.parentElement; continue; } else { break; } } else { break; } } } } } if (!$2) { $1.style['display'] = 'none'; } } const $11 = $1.getBoundingClientRect(); const $12 = ($11.y < window.innerHeight - $11.height); if ($12) { $1.style['position'] = 'fixed'; $1.style['bottom'] = '0'; $1.style['left'] = '0'; $1.style['right'] = '0'; $1.style['z-index'] = '9999'; } const $13 = ( document.body.getBoundingClientRect().height < $11.height * 2 ); if ($13) { $1.style['display'] = 'none'; }
});</script></a></body>
</html>
