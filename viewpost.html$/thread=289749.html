
<!DOCTYPE html>

<html>
<head><meta content="noindex,nofollow" name="robots"/>
<title>Heron 1.0 Alpha 3 : Compile-Time Reflection, the HeronEdit IDE, and more</title>
<meta charset="utf-8"/>
<meta content="Christopher Diggins" name="author">
<link href="../_/https/www.artima.com/artima.css" rel="stylesheet" type="text/css"/>
<link href="../_/https/www.artima.com/favicon.ico" rel="shortcut icon"/>
</meta></head>
<body><table cellspacing="0" width="100%">
<tr>
<td align="left" valign="bottom">
<a href="../_/https/www.artima.com/index.html"><img alt="The Artima Developer Community" border="0" height="43" src="../_/https/www.artima.com/images/a7.gif" width="550"/></a>
</td>
</tr></table>
<table bgcolor="#333333" width="100%">
<tr>
<td align="center">
<div class="ml">
<a class="hl" href="../_/https/www.artima.com/articles/index.html">Articles</a> |
<a class="hl" href="../_/https/www.artima.com/news/index.html">News</a> |
<a class="hl" href="../index.html">Weblogs</a> |
<a class="hl" href="../_/https/www.artima.com/shop/catalog/index.html">Books</a> |
<a class="hl" href="../_/https/www.artima.com/forums/index.html">Forums</a>
</div>
</td>
</tr>
</table>
<table bgcolor="#CCCCCC" width="100%">
<tr>
<td align="center">
<div class="sc">
<a href="../index.html">Artima Weblogs</a> | 

<a href="../index.html$/blogger=cdiggins.html">Christopher Diggins' Weblog</a> | 

<a href="../_/https/www.artima.com/forums/flat.html$/forum=106&amp;thread=289749.html">Discuss</a> | 
<a href="mailto:?subject=Heron 1.0 Alpha 3 : Compile-Time Reflection, the HeronEdit IDE, and more&amp;body= %0AArtima Weblogs %0AHeron 1.0 Alpha 3 : Compile-Time Reflection, the HeronEdit IDE, and more %0Aby Christopher Diggins %0A%0Ahttps://www.artima.com/weblogs/viewpost.jsp?thread=289749">Email</a> | 
<a href="../viewpostP.html$/thread=289749.html">Print</a> | 
<a href="../bloggers.html">Bloggers</a> | 
<a class="sl" href="thread=285952.html" title="Heron Tackles the WideFinder Challenge">Previous</a> | 
<a class="sl" href="thread=331531.html" title="The Principles of Good Programming">Next</a>
</div>
</td>
</tr>
</table>
<table bgcolor="#EEEEEE" width="100%">
<tr>
<td align="center">
<div class="sc">
<span style="color: #555555;">Sponsored Link</span> <span style="color: #888888;">•</span>
<script language="JavaScript" src="../_/https/www.artima.com/zcr/adx.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
   if (!document.phpAds_used) document.phpAds_used = ',';
   phpAds_random = new String (Math.random()); phpAds_random = phpAds_random.substring(2,11);
   
   document.write ("<" + "script language='JavaScript' type='text/javascript' src='");
   document.write ("../_/https/www.artima.com/zcr/adjs.html$/n=.html" + phpAds_random);
   document.write ("&amp;what=zone:9&amp;target=_top");   document.write ("&amp;exclude=" + document.phpAds_used);
   if (document.referrer)
      document.write ("&amp;referer=" + escape(document.referrer));
   document.write ("'><" + "/script>");
//-->
</script><noscript><a href="../_/https/www.artima.com/zcr/adclick.html$/n=a799ecf6.html" target="_top"><img alt="" border="0" src="../_/https/www.artima.com/zcr/adview.html$/what=zone:9&amp;n=a0587811.html"/></a></noscript>
</div>
</td>
</tr>
</table>
<br/>
<div class="vegies">
<div class="tc">
<span class="sts">Heron-Centric: Ruminations of a Language Designer</span><br>
<span class="ts">Heron 1.0 Alpha 3 : Compile-Time Reflection, the HeronEdit IDE, and more</span><br/>
<span class="as">by Christopher Diggins</span><br/>
<span class="pd">April 21, 2010</span><br/>
</br></div>
<blockquote>
<b>Summary</b><br/>
The Alpha 3 release of Heron 1.0 is now available for download from Google code. The completion of a couple of features, such as compile-time code reflection, and the inclusion of an editor, makes this one of the most interesting releases of Heron yet.

</blockquote>
<hr align="left" width="90%"/>
<table align="right">
<tr>
<td>
<div class="adnotice">
Advertisement
</div>
<center>
<script language="JavaScript" src="../_/https/www.artima.com/zcr/adx.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
if (!document.phpAds_used) document.phpAds_used = ',';
phpAds_random = new String (Math.random()); phpAds_random = phpAds_random.substring(2,11);
document.write ("<" + "script language='JavaScript' type='text/javascript' src='");
document.write ("../_/https/www.artima.com/zcr/adjs.html$/n=.html" + phpAds_random);
document.write ("&amp;what=zone:2");
document.write ("&amp;exclude=" + document.phpAds_used);
if (document.referrer)
document.write ("&amp;referer=" + escape(document.referrer));
document.write ("'><" + "/script>");
//-->
</script><noscript><a href="../_/https/www.artima.com/zcr/adclick.html$/n=a74ab060.html" target="_blank"><img alt="" border="0" src="../_/https/www.artima.com/zcr/adview.html$/what=zone:2&amp;n=a74ab060.html"/></a></noscript>
</center>
</td>
</tr>
</table>
<p>
<h1>Heron 1.0 Alpha 3</h1>
<p>
    The Alpha 3 release of Heron 1.0 is now <a href="../_/http/code.google.com/p/heron-language/downloads/list/index.html">available for download</a>. There are a number of minor bug fixes, and a couple of significant new additions: compile-time reflection, a mini IDE, and enhanced duck-typing.
</p>
<p>
This version is still an Alpha since I am still on the fence whether a couple of features may make it into the official 1.0 gold version. 
</p>
<h2>Compile-Time Reflection (Metaprogramming)</h2>
<p>
    In previous versions of Heron you could only examine the code model of a Heron program at compile-time (i.e. compile-time
    introspection). In this version you have full read and write access to the code model at compile-time. So for example you could
    iterate over the functions of a class and insert trace statements where you want.  
</p>
<p>
    Compile-time reflection in Heron is enabled by providing a second program entry point called <code>Meta()</code> (in addition 
    to the run-time entry-point <code>Main()</code>). 
    The <code>Meta()</code> function accepts a <code>ProgramDefn</code> object as an argument. 
    A <code>ProgramDefn</code> type represents the abstract syntax
    tree (AST) of a Heron program and can be modified as much as the programmer desires. When a Heron program is finally run 
    (or interpreted) the <code>Main()</code> function of the transformed AST is run instead of the original. This means that a 
    programmer can do virtually anything they want to a program at compile-time. The only caveat is that it won't work if the original 
    program wasn't a syntactically valid Heron program to begin with. 
</p>
<p> 
    The following code example demonstrates how compile-time reflection works in Heron, by adding trace statements
    to all of the functions in the program:
</p>
<pre>
module TestMetaProgramming
{
    imports
    {
        console = new Heron.Windows.Console();
        meta = new Heron.Standard.Metaprogramming();
    }
    methods
    {
        Meta(p : ProgramDefn)
        {
            var m : ModuleDefn = p.GetModule("TestMetaProgramming");
            foreach (f in m.GetDeclaredMethods())
            {
                if (f.name != "Meta")
                {
                    var st = CodeModelBuilder
                        .CreateStatement("WriteLine(\"At function " + f.name + "()\");");
                    f.body.statements.Prepend(st);
                }
            }
        }

        Main()
        {
            f();
        }

        f()
        {
            WriteLine("Nothing to see here, carry on");
        }
    }
}
</pre>
<p>
Running this program produces the following output: 
</p>
<pre>
At function Main()
At function f()
Nothing to see here, carry on
</pre>
<p>
    Compile-time code generation can be very useful in a number of ways:
    <ul>
<li>code optimization</li>
<li>static code analysis tools (e.g. type checkers)</li>
<li>automatic test generation</li>
<li>documentation generation</li>
</ul>
</p>
<h2>The HeronEdit mini-IDE</h2>
<p>
    With the Alpha 3 release I have introduced a simple IDE for editing and running 
    Heron programs called HeronEdit. HeronEdit is effectively with the 
    following enhancements for working with Heron files:
</p>
<ul>
<li>Syntax coloring</li>
<li>On-the-fly parse error reporting</li>
<li>Multi-level undo</li>
<li>Single key-press for running a file</li>
<li>The editor can be programmatically extended via macros (scripts) written in Heron.</li>
</ul>
<p>
    So while HeronEdit is written in C#, with full source code provided and licened under the 
    MIT License 1.0, it does provide the interesting ability to be extended using scripts 
    written in Heron. 
</p>
<p>
    A sample macro script for HeronEdit can be seen at 
    <a href="../_/http/code.google.com/p/heron-language/source/browse/trunk/HeronEngine/macros/Macros.heron">Macros.heron</a>.
</p>
<h2>Duck-Typing</h2>
<p>
    Previous versions of Heron supported only explicit duck-typing via the <code>as</code> operator. Using <code>as</code> an object (class instance or interface instance) could be cast to any interface instance as long as the required interfaces were supported. In the current version of Heron this has been modified so that the <code>as</code> operator is no longer required. Now simply casting to an interface instance (i.e. via assignment or by passing a value as an argument to a function) will cause the object to be coerced into the new type.    
</p>
<p>
   Heron also allows type annotations to be omitted. A value with no type annotation will have its type checked at run-time, and thus provides another form of duck-typing.  
</p>
<h2>Candidate Features for Heron 1.0 Gold</h2>
<p> 
  I plan on moving Heron into the beta phase once I have definitively decided whether or not to 
  add support for a couple of features. These are:
</p>
<ul>
<li>program piping - One feature that is a must-have in Heron (whether it is released in 1.0 or I push it back to 1.1) is ability to redirect the standard output of a module to the standard input of another module from within Heron.
</li>
<li>annotations - This is another must-have feature, and will probably make it into 1.0. Annotations are expressions that are associated with various program elements (e.g. types, methods, fields) that can be accessed at compile-time when examining the code model. 
</li>
</ul>
<h1>Talk Back!</h1>
<p>
Have an opinion?


Readers have already posted

<a href="../_/https/www.artima.com/forums/flat.html$/forum=106&amp;thread=289749.html">2

comments</a>
about this weblog entry. Why not

<a href="../_/https/www.artima.com/forums/post.html$/forum=106&amp;thread=289749&amp;reply=true.html">add yours</a>?


<h1>RSS Feed</h1>
<p>
If you'd like to be notified whenever Christopher Diggins adds a new entry to <a href="../index.html$/blogger=cdiggins.html">his weblog</a>, subscribe to his <a href="../feeds/bloggers/cdiggins.rss">RSS feed</a>.

<center>
<div class="sociallinks">
<a href="../_/http/digg.com/submit$/phase=2&amp;url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D289749&amp;title=Heron+1.0+Alpha+3+%3A+Compile-Time+Reflection%2C+the+HeronEdit+IDE%2C+and+more&amp;bodytext=The+Alpha+3+release+of+Heron+1.0+is+now+available+for+download+from+Google+code.+The+completion+of+a+couple+of+features%2C+such+as+compile-time+code+reflection%2C+and+the+inclusion+of+an+editor%2C+makes+this+one+of+the+most+interesting+releases+of+Heron+yet.&amp;topic=programming">
<img alt="Digg" border="0" height="14" hspace="8" src="../_/https/www.artima.com/images/digg.gif" width="16">Digg
  </img></a>
  |
  <a href="../_/http/del.icio.us/post$/url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D289749&amp;title=Heron+1.0+Alpha+3+%3A+Compile-Time+Reflection%2C+the+HeronEdit+IDE%2C+and+more">
<img alt="del.icio.us" border="0" height="16" hspace="8" src="../_/https/www.artima.com/images/delicious.gif" vspace="1" width="16">del.icio.us
  </img></a>
  |
  <a href="../_/http/programming.reddit.com/submit$/url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D289749&amp;title=Heron+1.0+Alpha+3+%3A+Compile-Time+Reflection%2C+the+HeronEdit+IDE%2C+and+more">
<img alt="Reddit" border="0" height="18" hspace="8" src="../_/https/www.artima.com/images/reddit.gif" width="18"/>Reddit
  </a>
</div>
</center>
<h1>About the Blogger</h1>
<p>
<table><tr valign="bottom"><td><img align="right" src="../_/https/www.artima.com/images/christopherdiggins.jpg"/></td><td>Christopher Diggins is a software developer and freelance writer. Christopher loves programming, but is eternally frustrated by the shortcomings of modern programming languages. As would any reasonable person in his shoes, he decided to quit his day job to write his own ( <a href="../_/http/www.heron-language.com/index.html">www.heron-language.com</a> ). Christopher is the co-author of the <a href="../_/http/www.cpp-cookbook.com/index.html">C++ Cookbook</a> from O'Reilly. Christopher can be reached through his home page at  <a href="../_/http/www.cdiggins.com/index.html">www.cdiggins.com</a>.</td></tr></table><p>
<div class="sp">This weblog entry is Copyright © 2010 Christopher Diggins. All rights reserved.</div>
</p></p></p></p></p></div>

<hr width="100%">
<table align="center" width="50%">
<tr>
<td>
<div class="horizontaltextadbox">
<div class="adheadline">Sponsored Links</div>
<div id="sponsoredlinks">
</div>
</div>
</td>
</tr>
</table>
<hr width="100%"/>
<center>
<script type="text/javascript"><!--
google_ad_client = "pub-3911176865765226";
google_alternate_color = "ffffff";
google_ad_width = 728;
google_ad_height = 15;
google_ad_format = "728x15_0ads_al";
google_ad_channel = "";
google_color_border = "ffffff";
google_color_bg = "FFFFFF";
google_color_link = "003090";
google_color_text = "000000";
google_color_url = "666666";
//--></script>
<script src="../_/https/pagead2.googlesyndication.com/pagead/show_ads.js" type="text/javascript">
</script>
<br>
<br/>
<!-- SiteSearch Google -->
<form action="../_/https/www.google.com/custom/index.html" method="get">
<table bgcolor="#ffffff" border="0">
<tr><td align="left" height="32" nowrap="nowrap" valign="top">
<a href="../_/https/www.google.com/index.html">
<img alt="Google" border="0" src="../_/https/www.google.com/logos/Logo_25wht.gif"/></a>
</td>
<td nowrap="nowrap">
<input name="domains" type="hidden" value="Artima.com"/>
<input maxlength="255" name="q" size="31" type="text" value=""/>
<input name="sa" type="submit" value="Search"/>
</td></tr>
<tr>
<td> </td>
<td nowrap="nowrap">
<font color="#000000" size="-1">
<input name="sitesearch" type="radio" value=""/> Web
<input checked="checked" name="sitesearch" type="radio" value="Artima.com"/>Artima.com
</font>  
<input name="client" type="hidden" value="pub-3911176865765226"/>
<input name="forid" type="hidden" value="1"/>
<input name="ie" type="hidden" value="ISO-8859-1"/>
<input name="oe" type="hidden" value="ISO-8859-1"/>
<input name="cof" type="hidden" value="GALT:#008000;GL:1;DIV:#336699;VLC:663399;AH:center;BGC:FFFFFF;LBGC:FFFFFF;ALC:0000FF;LC:0000FF;T:000000;GFNT:0000FF;GIMP:0000FF;LH:50;LW:150;L:https://www.artima.com/images/artima150.gif;S:https://www.artima.com;FORID:1;"/>
<input name="hl" type="hidden" value="en"/>
</td></tr></table>
</form>
<!-- SiteSearch Google -->
</br></center>
<br/>
<div class="sp">
<div style="text-align: center;">
<a href="../_/https/www.artima.com/copyright.html">Copyright</a> © 1996-2019 Artima, Inc. All Rights Reserved. - <a href="../_/https/www.artima.com/privacy.html">Privacy Policy</a> - <a href="../_/https/www.artima.com/termsofuse.html">Terms of Use</a>
</div>
</div>
<br/>
<script language="JavaScript" type="text/javascript">
<!--
function initBannerVarForZone(zone) {
        initBannerVarForZoneWithScript(zone, 'adjs_modified');
}

function initBannerVarForZoneWithScript(zone, phpScript) {

        if (!document.phpAds_used) document.phpAds_used = ',';
        phpAds_random = new String (Math.random());
        phpAds_random = phpAds_random.substring(2,11);

        var nextScriptSrc = '../_/https/www.artima.com/zcr/index.html' + phpScript + '.php?n=' +
                phpAds_random  +
                '&amp;what=zone:' + zone + '&amp;target=_top&amp;block=1&amp;blockcampaign=1' +
                '&amp;exclude=' + document.phpAds_used;

        document.write("<script language='JavaScript' type='text/javascript' src='");
        document.write(nextScriptSrc);
        document.write("'><\/script>");

}

function replaceDiv(divID) {
        document.getElementById(divID).innerHTML = phpadsbanner;
}
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
initBannerVarForZone(3);
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
replaceDiv('leftskyscraper');
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
initBannerVarForZoneWithScript(4, 'textman');
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
replaceDiv('sponsoredlinks');
-->
</script>
</hr><a href="https://dafoster.net/projects/crystal-web-archiver/" id="cr-footer-banner" style="border-top: 2px #B40010 solid;background: #FFFAE1;font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;font-variant: initial;font-weight: initial;text-transform: none;font-size: 14px;color: #6c757d;line-height: 2.0;cursor: pointer;display: flex;align-items: center;justify-content: center;gap: 4px;clear: both;" target="_blank"><img height="24" onerror="this.style['display'] = 'none';" src="../_/crystal/resources/appicon.png" width="24"/><span>This page was archived with Crystal</span><script>window.addEventListener('load', function() { const $1 = document.querySelector('#cr-footer-banner'); if (!$1) { return; } if (window !== window.top) { let $2 = false; if (window.name) { const $3 = window.parent.document.getElementsByName(window.name); if ($3.length === 1) { const $4 = $3[0]; if ($4.tagName === 'FRAME' && $4.parentElement.tagName === 'FRAMESET') { let $5 = $4; while (true) { if ($5.parentElement.tagName !== 'FRAMESET') { $2 = true; break; } if ($5.parentElement.attributes['rows'] !== undefined) { const $6 = $5.parentElement.children; if ($5 === $6[$6.length - 1]) { $5 = $5.parentElement; continue; } else { break; } } else if ($5.parentElement.attributes['cols'] !== undefined) { const $7 = Array.from($5.parentElement.children); const $8 = $7.indexOf($5); if ($8 === -1) { break; } const $9 = $5.parentElement.attributes['cols'].value.split(','); const $10 = $9.map((s) => parseInt(s.trim())); if ($9[$8].trim() === '*' || $10[$8] === Math.max.apply(null, $10)) { $5 = $5.parentElement; continue; } else { break; } } else { break; } } } } } if (!$2) { $1.style['display'] = 'none'; } } const $11 = $1.getBoundingClientRect(); const $12 = ($11.y < window.innerHeight - $11.height); if ($12) { $1.style['position'] = 'fixed'; $1.style['bottom'] = '0'; $1.style['left'] = '0'; $1.style['right'] = '0'; $1.style['z-index'] = '9999'; } const $13 = ( document.body.getBoundingClientRect().height < $11.height * 2 ); if ($13) { $1.style['display'] = 'none'; }
});</script></a></body>
</html>
