
<!DOCTYPE html>

<html>
<head><meta content="noindex,nofollow" name="robots"/>
<title>The Autoproxy Plugin - Part I</title>
<meta charset="utf-8"/>
<meta content="Kevin Wright" name="author">
<link href="../_/https/www.artima.com/artima.css" rel="stylesheet" type="text/css"/>
<link href="../_/https/www.artima.com/favicon.ico" rel="shortcut icon"/>
</meta></head>
<body><table cellspacing="0" width="100%">
<tr>
<td align="left" valign="bottom">
<a href="../_/https/www.artima.com/index.html"><img alt="The Artima Developer Community" border="0" height="43" src="../_/https/www.artima.com/images/a7.gif" width="550"/></a>
</td>
</tr></table>
<table bgcolor="#333333" width="100%">
<tr>
<td align="center">
<div class="ml">
<a class="hl" href="../_/https/www.artima.com/articles/index.html">Articles</a> |
<a class="hl" href="../_/https/www.artima.com/news/index.html">News</a> |
<a class="hl" href="../index.html">Weblogs</a> |
<a class="hl" href="../_/https/www.artima.com/shop/catalog/index.html">Books</a> |
<a class="hl" href="../_/https/www.artima.com/forums/index.html">Forums</a>
</div>
</td>
</tr>
</table>
<table bgcolor="#CCCCCC" width="100%">
<tr>
<td align="center">
<div class="sc">
<a href="../index.html">Artima Weblogs</a> | 

<a href="../index.html$/blogger=kevwright.html">Kevin Wright's Weblog</a> | 

<a href="../_/https/www.artima.com/forums/flat.html$/forum=106&amp;thread=275135.html">Discuss</a> | 
<a href="mailto:?subject=The Autoproxy Plugin - Part I&amp;body= %0AArtima Weblogs %0AThe Autoproxy Plugin - Part I %0Aby Kevin Wright %0A%0Ahttps://www.artima.com/weblogs/viewpost.jsp?thread=275135">Email</a> | 
<a href="../viewpostP.html$/thread=275135.html">Print</a> | 
<a href="../bloggers.html">Bloggers</a> | 
Previous | 
<a class="sl" href="thread=275588.html" title="The Autoproxy Plugin - Part II">Next</a>
</div>
</td>
</tr>
</table>
<table bgcolor="#EEEEEE" width="100%">
<tr>
<td align="center">
<div class="sc">
<span style="color: #555555;">Sponsored Link</span> <span style="color: #888888;">•</span>
<script language="JavaScript" src="../_/https/www.artima.com/zcr/adx.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
   if (!document.phpAds_used) document.phpAds_used = ',';
   phpAds_random = new String (Math.random()); phpAds_random = phpAds_random.substring(2,11);
   
   document.write ("<" + "script language='JavaScript' type='text/javascript' src='");
   document.write ("../_/https/www.artima.com/zcr/adjs.html$/n=.html" + phpAds_random);
   document.write ("&amp;what=zone:9&amp;target=_top");   document.write ("&amp;exclude=" + document.phpAds_used);
   if (document.referrer)
      document.write ("&amp;referer=" + escape(document.referrer));
   document.write ("'><" + "/script>");
//-->
</script><noscript><a href="../_/https/www.artima.com/zcr/adclick.html$/n=a799ecf6.html" target="_top"><img alt="" border="0" src="../_/https/www.artima.com/zcr/adview.html$/what=zone:9&amp;n=a0587811.html"/></a></noscript>
</div>
</td>
</tr>
</table>
<br/>
<div class="vegies">
<div class="tc">
<span class="sts">A Taste of Scala</span><br>
<span class="ts">The Autoproxy Plugin - Part I</span><br/>
<span class="as">by Kevin Wright</span><br/>
<span class="pd">November 26, 2009</span><br/>
</br></div>
<blockquote>
<b>Summary</b><br/>
Reducing accidental complexity in Scala

</blockquote>
<hr align="left" width="90%"/>
<table align="right">
<tr>
<td>
<div class="adnotice">
Advertisement
</div>
<center>
<script language="JavaScript" src="../_/https/www.artima.com/zcr/adx.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
if (!document.phpAds_used) document.phpAds_used = ',';
phpAds_random = new String (Math.random()); phpAds_random = phpAds_random.substring(2,11);
document.write ("<" + "script language='JavaScript' type='text/javascript' src='");
document.write ("../_/https/www.artima.com/zcr/adjs.html$/n=.html" + phpAds_random);
document.write ("&amp;what=zone:2");
document.write ("&amp;exclude=" + document.phpAds_used);
if (document.referrer)
document.write ("&amp;referer=" + escape(document.referrer));
document.write ("'><" + "/script>");
//-->
</script><noscript><a href="../_/https/www.artima.com/zcr/adclick.html$/n=a74ab060.html" target="_blank"><img alt="" border="0" src="../_/https/www.artima.com/zcr/adview.html$/what=zone:2&amp;n=a74ab060.html"/></a></noscript>
</center>
</td>
</tr>
</table>
<p>
<p><em>update:</em> <a class="reference" href="../_/http/www.artima.com/weblogs/viewpost.html$/thread=275588.html">part II</a> <em>is now available</em></p>
<div class="section">
<h1><a id="code-considered-harmful" name="code-considered-harmful">Code Considered Harmful</a></h1>
<ul class="simple">
<li>A recent post on the Scala mailing lists stated that (as a rule of thumb) one in every ten lines of freshly written code contains a defect.</li>
<li>The "industry standard" is somewhere closer to 15-50 defects for every 1000 lines of code <em>in production</em>.</li>
<li>Between being written and released, code passes through pair programming, rich IDEs, static analysis, unit testing,
continuous integration, code reviews, integration testing and release candidates.
At every step more errors are detected, accounting for the difference between defects in fresh code and defects in production.</li>
<li>All of of these techniques are now widely used in the industry
<em>(with the possible exceptions of pair programming and code reviews)</em>,
but they are running into a wall of diminishing returns.</li>
<li>It's becoming increasingly costly to add new classes of error to static analysis,
or to move code coverage from 80% to 90%.  Going from 10% to 20% was <strong>much</strong> easier.</li>
</ul>
<p>Weaving a thread throughout these numbers, one idea is pervasive;
the defect rate seems unaffected by the choice of programming language.
So 1 in every 10 lines of Scala will contain a defect, as will 1 in every 10 lines of assembly.
This is important when considering how many lines of code that each of
these languages need in order to implement the same feature.</p>
<p>Given that the rate of defect <em>creation</em> remains constant
and techniques for <em>detection</em> are slowing down,
it makes sense that defects should be tackled from the other direction;
instead of increasing the rate of detection we can reduce the rate of creation.
Specifically, by reducing the number of lines of code.</p>
<p>Modern languages have already made great progress in this area.
For example, studies comparing Scala and Java quote that the same feature requires anywhere from 3x to 10x fewer lines in the Scala implementation.
The extra lines needed in Java are just <a class="reference" href="../_/http/en.wikipedia.org/wiki/Accidental_complexity/index.html">accidental complexity</a>;
as well as providing more places for defects to appear they create more noise.
This is not good news for the developer who later has to come back and read and maintain the code and is <em>exactly</em> what we want to avoid... longer code with more bugs that's harder to maintain.</p>
</div>
<div class="section">
<h1><a id="how-scala-helps-with-accidental-complexity" name="how-scala-helps-with-accidental-complexity">How Scala helps with Accidental Complexity</a></h1>
<p>There are a number of features in Scala that help keep the daemon boilerplate under control.
Many of these have already been documented elsewhere, but they include:</p>
<dl class="docutils">
<dt><strong>Automatic creation of getter/setter methods for properties</strong>:</dt>
<dd>So no need to litter code with getXXX and setXXX methods</dd>
<dt><strong>Functional constructs</strong>:</dt>
<dd>Including closures, for-comprehensions and pattern matching.</dd>
</dl>
<p>This:</p>
<pre class="literal-block">
List(2,3,4).foreach(println)
</pre>
<p>is shorter than this:</p>
<pre class="literal-block">
for(x &lt;- List(2,3,4)) {
  println(x)
}
</pre>
<dl class="docutils">
<dt><strong>Type inference</strong>:</dt>
<dd>Java's type system encourages duplication, which leaves open the possibility that
a type might be modified in one place but forgotten in another,
thus introducing a defect.</dd>
</dl>
<p>Instead of:</p>
<pre class="literal-block">
Map&lt;Integer, String&gt; theMap = new HashMap&lt;Integer, String&gt;
</pre>
<p>a Scala developer can write:</p>
<pre class="literal-block">
val theMap = HashMap[Int, String]
</pre>
<p>There's no need to duplicate the &lt;Integer, String&gt; construct.</p>
<dl class="docutils">
<dt><strong>Traits and Mixins</strong>:</dt>
<dd>Fragments of concrete code can be gathered together in a Trait, the trait can then be mixed-in when constructing another object.
This avoids a lot of code duplication when compared to implementing an interface in Java.  Code duplication usually involves
copying and pasting, long known to be a cause of errors.</dd>
<dt><strong>No checked exceptions</strong>:</dt>
<dd>You don't need to declare that you throw an IOException simply because you call another method that declares it.
All too often, a developer will catch such exceptions and silently swallow them to avoid having to explicitly add
the same declaration to callers, and callers of the callers, etc.  This is a bit of a hack and usually only done
with the intention of doing the right thing at a later date, but - all too often - tomorrow never comes.</dd>
</dl>
<p>Scala code also tends to produce better quality errors.</p>
<ul class="simple">
<li>By using Option correctly, NullPointerExceptions can be avoided.</li>
<li>Without checked exceptions, it's less likely that the true cause of a problem will become obsured in stack traces.</li>
</ul>
</div>
<div class="section">
<h1><a id="but-good-design-sometimes-more-code" name="but-good-design-sometimes-more-code">But... Good Design (sometimes) = More Code</a></h1>
<p>So less is more, right?
Well, sometimes... if you're reducing accidental complexity then less is definitely a good thing.
But not always; many design patterns recognised as good practice also tend to increase the line count of a system.</p>
<p>For example:</p>
<ul class="simple">
<li>introducing an interface</li>
<li>splitting a class into several classes or a function into several functions</li>
<li>unit tests</li>
<li>using composition instead of inheritance</li>
<li>many of the GoF patterns</li>
</ul>
<p><em>lots</em> of Good Things(tm) will add code...</p>
<p>Of course, this isn't without benefit.  Many patterns help to express intent more effectively and make the code more testable.
Good refactoring and splitting up large blocks of functionality will make the code easier to maintain,
and the newly-named fragements also help to document the code.</p>
<p>It might seem a contradiction that less lines are good <em>and</em> more lines are good,
but the increased line count here isn't just adding accidental complexity, it's adding structure and intent and documentation.
This all helps maintainers and testers to keep defects down, so the main goal is still being achieved!</p>
<p>With one exception... The use of forwarders in object composition, decorators, etc.</p>
<p>Take the following example (adapted from an <a class="reference" href="../_/http/en.wikipedia.org/wiki/Delegation_(programming)/index.html">article</a> in Wikipedia):</p>
<pre class="literal-block">
abstract class I {
  def foo()
      def bar()
      def baz()
}

class A extends I {
  def foo() = println("a.foo")
  def bar() = println("a.bar")
      def baz() = println("a.baz")
}

class B(a : A) extends I {
  def foo() = a.foo() // call foo() on the a-instance
  def bar() = println("b.bar")
      def baz() = a.baz()
}

val a = new A
val b = new B(a)
</pre>
<p>Here, class B implements the contract of I by delegating some of the work to an instance of A</p>
<p>In a worst case scenario this could lead to class B containing tens of forwarder methods that do nothing
but call through an instance of A, with hundreds of lines of code just to state that:</p>
<pre class="literal-block">
For any functionality not implemented in this class, delegate to the member variable "a"
</pre>
<p>it's almost as bad as javabean properties...</p>
<p>If "A" doesn't need any additional logic to create an instance, and it's always constructed alongside an instance of B (or some other class)
for purposes of delegation, then it can be made a trait - and the problem is solved:</p>
<pre class="literal-block">
trait A {
      def foo() = println("a.foo")
      def bar() = println("a.bar")
      def baz() = println("a.baz")
}

class B {
      def bar() = println("b.bar")
}

val b = new B with A
</pre>
<p>The trait A contains both the contract and default implementation for the methods
(although it could also leave some definitions abstract if desired)
Multiple traits can be <em>mixed-in</em> like this when constructing the value "b",
which as shown is of type "B with A"</p>
<p>Mix-ins help, a lot!  But if "A" has to be looked up via JNDI, or needs a factory method
to construct, or already exists at the time we need to use it, then mix-ins are powerless to help.</p>
</div>
<div class="section">
<h1><a id="the-autoproxy-plugin" name="the-autoproxy-plugin">The AutoProxy plugin</a></h1>
<p>Autoproxy is a Scala compiler-plugin created to help with exactly this situation</p>
<p>By using a simple annotation, the compiler can be instructed to generate
delegates in situations where mix-ins just don't help.</p>
<p>Returning to the original example:</p>
<pre class="literal-block">
abstract class I {
      def foo()
      def bar()
      def baz()
}

class A extends I {
      def foo() = println("a.foo")
      def bar() = println("a.bar")
      def baz() = println("a.baz")
}

class B(@proxy a : A) extends I {
      def bar() = println("b.bar")
}

val a = new A
val b = new B(a)
</pre>
<p>The @proxy annotation will generate the foo() and baz() methods in class B,
identical to the hand-written versions shown previously.</p>
<p>Using @proxy with a trait, things become even easier:</p>
<pre class="literal-block">
trait A {
  def foo() = println("a.foo")
      def bar() = println("a.bar")
      def baz() = println("a.baz")
}

class B(@proxy a : A) {
      def bar() = println("b.bar")
}

val a = new A
val b = new B(a)
</pre>
<p>Behind the scenes, traits are implemented as interfaces plus a separate class containing any concrete implementation.
This means that @proxy can add A (the interface) to superclasses of B, allowing B to be used as an instance of A.
There is no need to explicitly break out I as an inteface.</p>
<p>The <a class="reference" href="../_/http/wiki.github.com/scala-incubator/autoproxy-plugin/index.html">wiki</a> and <a class="reference" href="../_/http/github.com/scala-incubator/autoproxy-plugin/index.html">source</a> for the autoproxy plugin can be found on github.</p>
</div>
<div class="section">
<h1><a id="what-next" name="what-next">What next?</a></h1>
<p>In the <a class="reference" href="../_/http/www.artima.com/weblogs/viewpost.html$/thread=275588.html">next article</a> I'll cover a few usage scenarios for the plugin</p>
<p>And after that, some of the challenges involved in adding this to the scala compiler,
a process that one commentator described as "bear wrestling"</p>
</div>
<h1>Talk Back!</h1>
<p>
Have an opinion?


Readers have already posted

<a href="../_/https/www.artima.com/forums/flat.html$/forum=106&amp;thread=275135.html">18

comments</a>
about this weblog entry. Why not

<a href="../_/https/www.artima.com/forums/post.html$/forum=106&amp;thread=275135&amp;reply=true.html">add yours</a>?


<h1>RSS Feed</h1>
<p>
If you'd like to be notified whenever Kevin Wright adds a new entry to <a href="../index.html$/blogger=kevwright.html">his weblog</a>, subscribe to his <a href="../feeds/bloggers/kevwright.rss">RSS feed</a>.

<center>
<div class="sociallinks">
<a href="../_/http/digg.com/submit$/phase=2&amp;url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D275135&amp;title=The+Autoproxy+Plugin+-+Part+I&amp;bodytext=Reducing+accidental+complexity+in+Scala&amp;topic=programming">
<img alt="Digg" border="0" height="14" hspace="8" src="../_/https/www.artima.com/images/digg.gif" width="16">Digg
  </img></a>
  |
  <a href="../_/http/del.icio.us/post$/url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D275135&amp;title=The+Autoproxy+Plugin+-+Part+I">
<img alt="del.icio.us" border="0" height="16" hspace="8" src="../_/https/www.artima.com/images/delicious.gif" vspace="1" width="16">del.icio.us
  </img></a>
  |
  <a href="../_/http/programming.reddit.com/submit$/url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D275135&amp;title=The+Autoproxy+Plugin+-+Part+I">
<img alt="Reddit" border="0" height="18" hspace="8" src="../_/https/www.artima.com/images/reddit.gif" width="18"/>Reddit
  </a>
</div>
</center>
<h1>About the Blogger</h1>
<p>
<table><tr valign="bottom"><td>Kevin Wright has finally settled back in London to work on market
analysis for the telecoms industry after having worked his way around
Europe in manufacturing, finance and even online gaming. He's a
self-appointed Scala Evangelist and an active participant in every forum
he can find, where he's currently trying to build interest in the London
Scala Users' Group.</td></tr></table><p>
<div class="sp">This weblog entry is Copyright © 2009 Kevin Wright. All rights reserved.</div>
</p></p></p></p></p></div>

<hr width="100%">
<table align="center" width="50%">
<tr>
<td>
<div class="horizontaltextadbox">
<div class="adheadline">Sponsored Links</div>
<div id="sponsoredlinks">
</div>
</div>
</td>
</tr>
</table>
<hr width="100%"/>
<center>
<script type="text/javascript"><!--
google_ad_client = "pub-3911176865765226";
google_alternate_color = "ffffff";
google_ad_width = 728;
google_ad_height = 15;
google_ad_format = "728x15_0ads_al";
google_ad_channel = "";
google_color_border = "ffffff";
google_color_bg = "FFFFFF";
google_color_link = "003090";
google_color_text = "000000";
google_color_url = "666666";
//--></script>
<script src="../_/https/pagead2.googlesyndication.com/pagead/show_ads.js" type="text/javascript">
</script>
<br>
<br/>
<!-- SiteSearch Google -->
<form action="../_/https/www.google.com/custom/index.html" method="get">
<table bgcolor="#ffffff" border="0">
<tr><td align="left" height="32" nowrap="nowrap" valign="top">
<a href="../_/https/www.google.com/index.html">
<img alt="Google" border="0" src="../_/https/www.google.com/logos/Logo_25wht.gif"/></a>
</td>
<td nowrap="nowrap">
<input name="domains" type="hidden" value="Artima.com"/>
<input maxlength="255" name="q" size="31" type="text" value=""/>
<input name="sa" type="submit" value="Search"/>
</td></tr>
<tr>
<td> </td>
<td nowrap="nowrap">
<font color="#000000" size="-1">
<input name="sitesearch" type="radio" value=""/> Web
<input checked="checked" name="sitesearch" type="radio" value="Artima.com"/>Artima.com
</font>  
<input name="client" type="hidden" value="pub-3911176865765226"/>
<input name="forid" type="hidden" value="1"/>
<input name="ie" type="hidden" value="ISO-8859-1"/>
<input name="oe" type="hidden" value="ISO-8859-1"/>
<input name="cof" type="hidden" value="GALT:#008000;GL:1;DIV:#336699;VLC:663399;AH:center;BGC:FFFFFF;LBGC:FFFFFF;ALC:0000FF;LC:0000FF;T:000000;GFNT:0000FF;GIMP:0000FF;LH:50;LW:150;L:https://www.artima.com/images/artima150.gif;S:https://www.artima.com;FORID:1;"/>
<input name="hl" type="hidden" value="en"/>
</td></tr></table>
</form>
<!-- SiteSearch Google -->
</br></center>
<br/>
<div class="sp">
<div style="text-align: center;">
<a href="../_/https/www.artima.com/copyright.html">Copyright</a> © 1996-2019 Artima, Inc. All Rights Reserved. - <a href="../_/https/www.artima.com/privacy.html">Privacy Policy</a> - <a href="../_/https/www.artima.com/termsofuse.html">Terms of Use</a>
</div>
</div>
<br/>
<script language="JavaScript" type="text/javascript">
<!--
function initBannerVarForZone(zone) {
        initBannerVarForZoneWithScript(zone, 'adjs_modified');
}

function initBannerVarForZoneWithScript(zone, phpScript) {

        if (!document.phpAds_used) document.phpAds_used = ',';
        phpAds_random = new String (Math.random());
        phpAds_random = phpAds_random.substring(2,11);

        var nextScriptSrc = '../_/https/www.artima.com/zcr/index.html' + phpScript + '.php?n=' +
                phpAds_random  +
                '&amp;what=zone:' + zone + '&amp;target=_top&amp;block=1&amp;blockcampaign=1' +
                '&amp;exclude=' + document.phpAds_used;

        document.write("<script language='JavaScript' type='text/javascript' src='");
        document.write(nextScriptSrc);
        document.write("'><\/script>");

}

function replaceDiv(divID) {
        document.getElementById(divID).innerHTML = phpadsbanner;
}
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
initBannerVarForZone(3);
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
replaceDiv('leftskyscraper');
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
initBannerVarForZoneWithScript(4, 'textman');
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
replaceDiv('sponsoredlinks');
-->
</script>
</hr><a href="https://dafoster.net/projects/crystal-web-archiver/" id="cr-footer-banner" style="border-top: 2px #B40010 solid;background: #FFFAE1;font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;font-variant: initial;font-weight: initial;text-transform: none;font-size: 14px;color: #6c757d;line-height: 2.0;cursor: pointer;display: flex;align-items: center;justify-content: center;gap: 4px;clear: both;" target="_blank"><img height="24" onerror="this.style['display'] = 'none';" src="../_/crystal/resources/appicon.png" width="24"/><span>This page was archived with Crystal</span><script>window.addEventListener('load', function() { const $1 = document.querySelector('#cr-footer-banner'); if (!$1) { return; } if (window !== window.top) { let $2 = false; if (window.name) { const $3 = window.parent.document.getElementsByName(window.name); if ($3.length === 1) { const $4 = $3[0]; if ($4.tagName === 'FRAME' && $4.parentElement.tagName === 'FRAMESET') { let $5 = $4; while (true) { if ($5.parentElement.tagName !== 'FRAMESET') { $2 = true; break; } if ($5.parentElement.attributes['rows'] !== undefined) { const $6 = $5.parentElement.children; if ($5 === $6[$6.length - 1]) { $5 = $5.parentElement; continue; } else { break; } } else if ($5.parentElement.attributes['cols'] !== undefined) { const $7 = Array.from($5.parentElement.children); const $8 = $7.indexOf($5); if ($8 === -1) { break; } const $9 = $5.parentElement.attributes['cols'].value.split(','); const $10 = $9.map((s) => parseInt(s.trim())); if ($9[$8].trim() === '*' || $10[$8] === Math.max.apply(null, $10)) { $5 = $5.parentElement; continue; } else { break; } } else { break; } } } } } if (!$2) { $1.style['display'] = 'none'; } } const $11 = $1.getBoundingClientRect(); const $12 = ($11.y < window.innerHeight - $11.height); if ($12) { $1.style['position'] = 'fixed'; $1.style['bottom'] = '0'; $1.style['left'] = '0'; $1.style['right'] = '0'; $1.style['z-index'] = '9999'; } const $13 = ( document.body.getBoundingClientRect().height < $11.height * 2 ); if ($13) { $1.style['display'] = 'none'; }
});</script></a></body>
</html>
