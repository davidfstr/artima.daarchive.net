
<!DOCTYPE html>

<html>
<head><meta content="noindex,nofollow" name="robots"/>
<title>The Adventures of a Pythonista in Rubyland/2 - No Comprehension</title>
<meta charset="utf-8"/>
<meta content="Andy Dent" name="author">
<link href="../_/https/www.artima.com/artima.css" rel="stylesheet" type="text/css"/>
<link href="../_/https/www.artima.com/favicon.ico" rel="shortcut icon"/>
</meta></head>
<body><table cellspacing="0" width="100%">
<tr>
<td align="left" valign="bottom">
<a href="../_/https/www.artima.com/index.html"><img alt="The Artima Developer Community" border="0" height="43" src="../_/https/www.artima.com/images/a7.gif" width="550"/></a>
</td>
</tr></table>
<table bgcolor="#333333" width="100%">
<tr>
<td align="center">
<div class="ml">
<a class="hl" href="../_/https/www.artima.com/articles/index.html">Articles</a> |
<a class="hl" href="../_/https/www.artima.com/news/index.html">News</a> |
<a class="hl" href="../index.html">Weblogs</a> |
<a class="hl" href="../_/https/www.artima.com/shop/catalog/index.html">Books</a> |
<a class="hl" href="../_/https/www.artima.com/forums/index.html">Forums</a>
</div>
</td>
</tr>
</table>
<table bgcolor="#CCCCCC" width="100%">
<tr>
<td align="center">
<div class="sc">
<a href="../index.html">Artima Weblogs</a> | 

<a href="../index.html$/blogger=andydent.html">Andy Dent's Weblog</a> | 

<a href="../_/https/www.artima.com/forums/flat.html$/forum=106&amp;thread=240826.html">Discuss</a> | 
<a href="mailto:?subject=The Adventures of a Pythonista in Rubyland/2 - No Comprehension&amp;body= %0AArtima Weblogs %0AThe Adventures of a Pythonista in Rubyland/2 - No Comprehension %0Aby Andy Dent %0A%0Ahttps://www.artima.com/weblogs/viewpost.jsp?thread=240826">Email</a> | 
<a href="../viewpostP.html$/thread=240826.html">Print</a> | 
<a href="../bloggers.html">Bloggers</a> | 
<a class="sl" href="thread=240319.html" title="The Adventures of a Pythonista in Rubyland/1">Previous</a> | 
<a class="sl" href="thread=268226.html" title="Why Learn New Languages? Being Outlived by C++">Next</a>
</div>
</td>
</tr>
</table>
<table bgcolor="#EEEEEE" width="100%">
<tr>
<td align="center">
<div class="sc">
<span style="color: #555555;">Sponsored Link</span> <span style="color: #888888;">•</span>
<script language="JavaScript" src="../_/https/www.artima.com/zcr/adx.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
   if (!document.phpAds_used) document.phpAds_used = ',';
   phpAds_random = new String (Math.random()); phpAds_random = phpAds_random.substring(2,11);
   
   document.write ("<" + "script language='JavaScript' type='text/javascript' src='");
   document.write ("../_/https/www.artima.com/zcr/adjs.html$/n=.html" + phpAds_random);
   document.write ("&amp;what=zone:9&amp;target=_top");   document.write ("&amp;exclude=" + document.phpAds_used);
   if (document.referrer)
      document.write ("&amp;referer=" + escape(document.referrer));
   document.write ("'><" + "/script>");
//-->
</script><noscript><a href="../_/https/www.artima.com/zcr/adclick.html$/n=a799ecf6.html" target="_top"><img alt="" border="0" src="../_/https/www.artima.com/zcr/adview.html$/what=zone:9&amp;n=a0587811.html"/></a></noscript>
</div>
</td>
</tr>
</table>
<br/>
<div class="vegies">
<div class="tc">
<span class="sts">Thinking Upside Down</span><br>
<span class="ts">The Adventures of a Pythonista in Rubyland/2 - No Comprehension</span><br/>
<span class="as">by Andy Dent</span><br/>
<span class="pd">October 27, 2008</span><br/>
</br></div>
<blockquote>
<b>Summary</b><br/>
Trying to do some simple file processing and strip blank lines, Andy stumbles through the "Ruby is supposed to feel natural" approach and just tries things. The conclusion - Python list comprehensions are still more flexible and powerful than any Ruby feature and inject is possibly the most misleadingly named function I've ever encountered.

</blockquote>
<hr align="left" width="90%"/>
<table align="right">
<tr>
<td>
<div class="adnotice">
Advertisement
</div>
<center>
<script language="JavaScript" src="../_/https/www.artima.com/zcr/adx.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
if (!document.phpAds_used) document.phpAds_used = ',';
phpAds_random = new String (Math.random()); phpAds_random = phpAds_random.substring(2,11);
document.write ("<" + "script language='JavaScript' type='text/javascript' src='");
document.write ("../_/https/www.artima.com/zcr/adjs.html$/n=.html" + phpAds_random);
document.write ("&amp;what=zone:2");
document.write ("&amp;exclude=" + document.phpAds_used);
if (document.referrer)
document.write ("&amp;referer=" + escape(document.referrer));
document.write ("'><" + "/script>");
//-->
</script><noscript><a href="../_/https/www.artima.com/zcr/adclick.html$/n=a74ab060.html" target="_blank"><img alt="" border="0" src="../_/https/www.artima.com/zcr/adview.html$/what=zone:2&amp;n=a74ab060.html"/></a></noscript>
</center>
</td>
</tr>
</table>
<p>
<p>Ruby gurus, be gentle with me and please correct any misunderstandings below and in the rest of this series!</p>
<div class="section">
<h1><a id="stripping-blank-lines" name="stripping-blank-lines">Stripping Blank Lines</a></h1>
<p>I want to simply build a list of strings with the empty strings removed.</p>
<p>The following examples are taken directly from the Python and irb interactive interpreters. The &gt;&gt;&gt; are standard Python interpreter prompts, showing what I typed, with responses lacking any prefix. The Ruby irb interpreter is similar with &gt;&gt; prefixing my entries and =&gt; prefixing the interpreter responses.</p>
<p>The generator-based approach in Python is very compact:</p>
<pre class="literal-block">
&gt;&gt;&gt; aList = ["fred", " ", "harry"]
&gt;&gt;&gt; [x for x in aList if len(x.strip()) &gt; 0]
['fred', 'harry']
</pre>
<p>So I first tried an iterator block with trailing conditional logic - it <em>felt</em> natural to write, pity it didn't work:</p>
<pre class="literal-block">
&gt;&gt; aList = ["fred", " ", "harry"]
=&gt; ["fred", " ", "harry"]
&gt;&gt; aList.each { |x| x unless x.rstrip.empty? }
=&gt; ["fred", " ", "harry"]
</pre>
<p>it appears that <em>each</em> just returns the original object.</p>
<p>Although it didn't work, this attempt provides a useful jumping-off point to discuss what I think is the single most powerful idiom in Ruby and how it is implemented - <strong>yield</strong> and the optional code block.</p>
<p>Just one quite note on container types, before we move on - Ruby arrays are equivalent to Python lists, hashes to dictionaries and there's no equivalent of the immutable Python tuples.</p>
<p>Any method in Ruby can have a code block argument attached to the parameters, some methods like <em>each</em> require such a block. The role of yield inside a method seems identical to that in Python generators. The difference is in the recipient of the yield and the resulting programming pattern. One way of looking at it would be to say Ruby yield is inside-out compared to Python yield.</p>
<p>Python yield is used to return control with one or more values to the calling context, which is then in charge and makes a decision as to whether to invoke the yielding function again. There is no obligation on the calling code to keep calling the generator which yielded, even if there are values in a container just begging their turn to be iterated.</p>
<p>Ruby yield is used to pass control and one or more values to a code block that has been sent to a method. Your yielding method is in charge and when the code block exits, control returns automatically to the yielder.</p>
<p>Yield is the <a class="reference" href="../_/http/en.wikipedia.org/wiki/Strategy_pattern/index.html">Strategy Pattern</a> provided in the core of the language.</p>
<p>For example, the open method can take a block and return the results of the block. You can write some code like a typical Python idiom:</p>
<pre class="literal-block">
&gt;&gt;&gt; to_clean = open("test.txt").readlines()
</pre>
<p>identically in Ruby:</p>
<pre class="literal-block">
&gt;&gt; to_clean = open("test.txt").readlines()
</pre>
<p>or in Ruby with a block:</p>
<pre class="literal-block">
&gt;&gt; to_clean = open("test.txt") { |f| f.readlines() }
</pre>
<p>The block-based Ruby version is more predictable and safer. If there is a failure within the block, it guarantees the file closure. Blocks in Ruby have their own scope and are also <em>closures</em> - they retain the context for variables from outside the block which are used inside the block. Blocks in Smalltalk are typically used to pass logic into other method calls. With the yield style of using blocks in Ruby, they seem to have a more local purpose.</p>
<p>The declaration of Ruby blocks is very similar to Smalltalk blocks and straightforward. Blocks are bounded by the words <strong>do</strong> and <strong>end</strong> or a pair of braces. The Ruby convention that has evolved is to use braces for single-line examples as I've done here and use do/end for bounding multiple-line blocks.</p>
<p>The vertical bar or pipe character is used to bound the parameters to the block. These parameters are populated by whatever is yielding to the block so their purpose and count depends on the method you're sending the block to. The comma-separated list of parameter names is just names, no typing information of course!</p>
<p>Recipe 7.2 in <a class="reference" href="../_/http/www.crummy.com/writing/RubyCookbook/index.html">Ruby Cookbook</a> has a nice detailed explanation of yielding to blocks and subsequent recipes show more examples iterating over data structures.</p>
</div>
<div class="section">
<h1><a id="back-to-our-blanks" name="back-to-our-blanks">Back to Our Blanks</a></h1>
<p>The each method returns the container, as all Ruby expressions return a value. If you do something like printing the parameters to the block, you will see them printed first:</p>
<pre class="literal-block">
&gt;&gt; aList = ["fred", " ", "harry"]
=&gt; ["fred", " ", "harry"]
&gt;&gt; aList.each { |x| print x }
fred harry=&gt; ["fred", " ", "harry"]
</pre>
<p>Looking through the definition of the Enumerable mixin (more on what <em>mixin</em> means later),  I spotted the <em>collect</em> method which <em>does</em> create a new array from the results of the block:</p>
<pre class="literal-block">
&gt;&gt; aList = ["fred", " ", "harry"]
=&gt; ["fred", " ", "harry"]
&gt;&gt; aList.collect { |x| x.length unless x.rstrip.empty? }
=&gt; [4, nil, 5]
</pre>
<p>Oops: it is very literal-minded - if you don't return anything in the block, a nil is put in that slot in the array being created.</p>
<p>Enough elegance - rather than trying to write an expression which returns the data I want, I gave up and decided to have the code block act on some data storage from outside that was pre-declared:</p>
<pre class="literal-block">
&gt;&gt; destList = []
=&gt; []
&gt;&gt; aList = ["fred", " ", "harry"]
=&gt; ["fred", " ", "harry"]
&gt;&gt; aList.each { |x| destList &lt;&lt; x unless x.rstrip.empty? }
=&gt; ["fred", " ", "harry"]
&gt;&gt; destList
=&gt; ["fred", "harry"]
</pre>
<p>More on blocks in a future episode, this one posted from Hokitika on the West Coast of New Zealand's South island where we are enjoying a holiday.</p>
</div>
<h1>Talk Back!</h1>
<p>
Have an opinion?


Readers have already posted

<a href="../_/https/www.artima.com/forums/flat.html$/forum=106&amp;thread=240826.html">30

comments</a>
about this weblog entry. Why not

<a href="../_/https/www.artima.com/forums/post.html$/forum=106&amp;thread=240826&amp;reply=true.html">add yours</a>?


<h1>RSS Feed</h1>
<p>
If you'd like to be notified whenever Andy Dent adds a new entry to <a href="../index.html$/blogger=andydent.html">his weblog</a>, subscribe to his <a href="../feeds/bloggers/andydent.rss">RSS feed</a>.

<center>
<div class="sociallinks">
<a href="../_/http/digg.com/submit$/phase=2&amp;url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D240826&amp;title=The+Adventures+of+a+Pythonista+in+Rubyland%2F2+-+No+Comprehension&amp;bodytext=Trying+to+do+some+simple+file+processing+and+strip+blank+lines%2C+Andy+stumbles+through+the+%26quot%3BRuby+is+supposed+to+feel+natural%26quot%3B+approach+and+just+tries+things.+The+conclusion+-+Python+list+comprehensions+are+still+more+flexible+and+powerful+_&amp;topic=programming">
<img alt="Digg" border="0" height="14" hspace="8" src="../_/https/www.artima.com/images/digg.gif" width="16">Digg
  </img></a>
  |
  <a href="../_/http/del.icio.us/post$/url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D240826&amp;title=The+Adventures+of+a+Pythonista+in+Rubyland%2F2+-+No+Comprehension">
<img alt="del.icio.us" border="0" height="16" hspace="8" src="../_/https/www.artima.com/images/delicious.gif" vspace="1" width="16">del.icio.us
  </img></a>
  |
  <a href="../_/http/programming.reddit.com/submit$/url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D240826&amp;title=The+Adventures+of+a+Pythonista+in+Rubyland%2F2+-+No+Comprehension">
<img alt="Reddit" border="0" height="18" hspace="8" src="../_/https/www.artima.com/images/reddit.gif" width="18"/>Reddit
  </a>
</div>
</center>
<h1>About the Blogger</h1>
<p>
<table><tr valign="bottom"><td><img align="right" src="../_/https/www.artima.com/images/andyDent.jpg"/></td><td>Andy is a free-lance developer in C++, REALbasic, Python, AJAX and other XML technologies. He works out of Perth, Western Australia for a local and international clients on cross-platform projects with a focus on usability for naive and infrequent users.  Included in his range of interests are generative solutions, software usability and small-team software processes. He still bleeds six colors, even though Apple stopped, and uses migration projects from legacy Mac OS to justify the hardware collection.</td></tr></table><p>
<div class="sp">This weblog entry is Copyright © 2008 Andy Dent. All rights reserved.</div>
</p></p></p></p></p></div>

<hr width="100%">
<table align="center" width="50%">
<tr>
<td>
<div class="horizontaltextadbox">
<div class="adheadline">Sponsored Links</div>
<div id="sponsoredlinks">
</div>
</div>
</td>
</tr>
</table>
<hr width="100%"/>
<center>
<script type="text/javascript"><!--
google_ad_client = "pub-3911176865765226";
google_alternate_color = "ffffff";
google_ad_width = 728;
google_ad_height = 15;
google_ad_format = "728x15_0ads_al";
google_ad_channel = "";
google_color_border = "ffffff";
google_color_bg = "FFFFFF";
google_color_link = "003090";
google_color_text = "000000";
google_color_url = "666666";
//--></script>
<script src="../_/https/pagead2.googlesyndication.com/pagead/show_ads.js" type="text/javascript">
</script>
<br>
<br/>
<!-- SiteSearch Google -->
<form action="../_/https/www.google.com/custom/index.html" method="get">
<table bgcolor="#ffffff" border="0">
<tr><td align="left" height="32" nowrap="nowrap" valign="top">
<a href="../_/https/www.google.com/index.html">
<img alt="Google" border="0" src="../_/https/www.google.com/logos/Logo_25wht.gif"/></a>
</td>
<td nowrap="nowrap">
<input name="domains" type="hidden" value="Artima.com"/>
<input maxlength="255" name="q" size="31" type="text" value=""/>
<input name="sa" type="submit" value="Search"/>
</td></tr>
<tr>
<td> </td>
<td nowrap="nowrap">
<font color="#000000" size="-1">
<input name="sitesearch" type="radio" value=""/> Web
<input checked="checked" name="sitesearch" type="radio" value="Artima.com"/>Artima.com
</font>  
<input name="client" type="hidden" value="pub-3911176865765226"/>
<input name="forid" type="hidden" value="1"/>
<input name="ie" type="hidden" value="ISO-8859-1"/>
<input name="oe" type="hidden" value="ISO-8859-1"/>
<input name="cof" type="hidden" value="GALT:#008000;GL:1;DIV:#336699;VLC:663399;AH:center;BGC:FFFFFF;LBGC:FFFFFF;ALC:0000FF;LC:0000FF;T:000000;GFNT:0000FF;GIMP:0000FF;LH:50;LW:150;L:https://www.artima.com/images/artima150.gif;S:https://www.artima.com;FORID:1;"/>
<input name="hl" type="hidden" value="en"/>
</td></tr></table>
</form>
<!-- SiteSearch Google -->
</br></center>
<br/>
<div class="sp">
<div style="text-align: center;">
<a href="../_/https/www.artima.com/copyright.html">Copyright</a> © 1996-2019 Artima, Inc. All Rights Reserved. - <a href="../_/https/www.artima.com/privacy.html">Privacy Policy</a> - <a href="../_/https/www.artima.com/termsofuse.html">Terms of Use</a>
</div>
</div>
<br/>
<script language="JavaScript" type="text/javascript">
<!--
function initBannerVarForZone(zone) {
        initBannerVarForZoneWithScript(zone, 'adjs_modified');
}

function initBannerVarForZoneWithScript(zone, phpScript) {

        if (!document.phpAds_used) document.phpAds_used = ',';
        phpAds_random = new String (Math.random());
        phpAds_random = phpAds_random.substring(2,11);

        var nextScriptSrc = '../_/https/www.artima.com/zcr/index.html' + phpScript + '.php?n=' +
                phpAds_random  +
                '&amp;what=zone:' + zone + '&amp;target=_top&amp;block=1&amp;blockcampaign=1' +
                '&amp;exclude=' + document.phpAds_used;

        document.write("<script language='JavaScript' type='text/javascript' src='");
        document.write(nextScriptSrc);
        document.write("'><\/script>");

}

function replaceDiv(divID) {
        document.getElementById(divID).innerHTML = phpadsbanner;
}
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
initBannerVarForZone(3);
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
replaceDiv('leftskyscraper');
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
initBannerVarForZoneWithScript(4, 'textman');
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
replaceDiv('sponsoredlinks');
-->
</script>
</hr><a href="https://dafoster.net/projects/crystal-web-archiver/" id="cr-footer-banner" style="border-top: 2px #B40010 solid;background: #FFFAE1;font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;font-variant: initial;font-weight: initial;text-transform: none;font-size: 14px;color: #6c757d;line-height: 2.0;cursor: pointer;display: flex;align-items: center;justify-content: center;gap: 4px;clear: both;" target="_blank"><img height="24" onerror="this.style['display'] = 'none';" src="../_/crystal/resources/appicon.png" width="24"/><span>This page was archived with Crystal</span><script>window.addEventListener('load', function() { const $1 = document.querySelector('#cr-footer-banner'); if (!$1) { return; } if (window !== window.top) { let $2 = false; if (window.name) { const $3 = window.parent.document.getElementsByName(window.name); if ($3.length === 1) { const $4 = $3[0]; if ($4.tagName === 'FRAME' && $4.parentElement.tagName === 'FRAMESET') { let $5 = $4; while (true) { if ($5.parentElement.tagName !== 'FRAMESET') { $2 = true; break; } if ($5.parentElement.attributes['rows'] !== undefined) { const $6 = $5.parentElement.children; if ($5 === $6[$6.length - 1]) { $5 = $5.parentElement; continue; } else { break; } } else if ($5.parentElement.attributes['cols'] !== undefined) { const $7 = Array.from($5.parentElement.children); const $8 = $7.indexOf($5); if ($8 === -1) { break; } const $9 = $5.parentElement.attributes['cols'].value.split(','); const $10 = $9.map((s) => parseInt(s.trim())); if ($9[$8].trim() === '*' || $10[$8] === Math.max.apply(null, $10)) { $5 = $5.parentElement; continue; } else { break; } } else { break; } } } } } if (!$2) { $1.style['display'] = 'none'; } } const $11 = $1.getBoundingClientRect(); const $12 = ($11.y < window.innerHeight - $11.height); if ($12) { $1.style['position'] = 'fixed'; $1.style['bottom'] = '0'; $1.style['left'] = '0'; $1.style['right'] = '0'; $1.style['z-index'] = '9999'; } const $13 = ( document.body.getBoundingClientRect().height < $11.height * 2 ); if ($13) { $1.style['display'] = 'none'; }
});</script></a></body>
</html>
