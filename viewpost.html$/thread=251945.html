
<!DOCTYPE html>

<html>
<head><meta content="noindex,nofollow" name="robots"/>
<title>Comparing DSLs in Ruby and Scala</title>
<meta charset="utf-8"/>
<meta content="Bill Venners" name="author">
<link href="../_/https/www.artima.com/artima.css" rel="stylesheet" type="text/css"/>
<link href="../_/https/www.artima.com/favicon.ico" rel="shortcut icon"/>
</meta></head>
<body><table cellspacing="0" width="100%">
<tr>
<td align="left" valign="bottom">
<a href="../_/https/www.artima.com/index.html"><img alt="The Artima Developer Community" border="0" height="43" src="../_/https/www.artima.com/images/a7.gif" width="550"/></a>
</td>
</tr></table>
<table bgcolor="#333333" width="100%">
<tr>
<td align="center">
<div class="ml">
<a class="hl" href="../_/https/www.artima.com/articles/index.html">Articles</a> |
<a class="hl" href="../_/https/www.artima.com/news/index.html">News</a> |
<a class="hl" href="../index.html">Weblogs</a> |
<a class="hl" href="../_/https/www.artima.com/shop/catalog/index.html">Books</a> |
<a class="hl" href="../_/https/www.artima.com/forums/index.html">Forums</a>
</div>
</td>
</tr>
</table>
<table bgcolor="#D3D3D3" width="100%">
<tr>
<td align="center">
<div class="sc">
<a href="../index.html">Artima Weblogs</a> | 

<a href="../index.html$/blogger=bv.html">Bill Venners' Weblog</a> | 

<a href="../_/https/www.artima.com/forums/flat.html$/forum=106&amp;thread=251945.html">Discuss</a> | 
<a href="mailto:?subject=Comparing DSLs in Ruby and Scala&amp;body= %0AArtima Weblogs %0AComparing DSLs in Ruby and Scala %0Aby Bill Venners %0A%0Ahttps://www.artima.com/weblogs/viewpost.jsp?thread=251945">Email</a> | 
<a href="../viewpostP.html$/thread=251945.html">Print</a> | 
<a href="../bloggers.html">Bloggers</a> | 
<a class="sl" href="thread=246279.html" title="ScalaTest Matchers Preview">Previous</a> | 
<a class="sl" href="thread=252702.html" title='What Do You Consider "Readable" Code?'>Next</a>
</div>
</td>
</tr>
</table>
<table bgcolor="#EEEEEE" width="100%">
<tr>
<td align="center">
<div class="sc">
<span style="color: #555555;">Sponsored Link</span> <span style="color: #888888;">•</span>
<script language="JavaScript" src="../_/https/www.artima.com/zcr/adx.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
   if (!document.phpAds_used) document.phpAds_used = ',';
   phpAds_random = new String (Math.random()); phpAds_random = phpAds_random.substring(2,11);
   
   document.write ("<" + "script language='JavaScript' type='text/javascript' src='");
   document.write ("../_/https/www.artima.com/zcr/adjs.html$/n=.html" + phpAds_random);
   document.write ("&amp;what=zone:9&amp;target=_top");   document.write ("&amp;exclude=" + document.phpAds_used);
   if (document.referrer)
      document.write ("&amp;referer=" + escape(document.referrer));
   document.write ("'><" + "/script>");
//-->
</script><noscript><a href="../_/https/www.artima.com/zcr/adclick.html$/n=a799ecf6.html" target="_top"><img alt="" border="0" src="../_/https/www.artima.com/zcr/adview.html$/what=zone:9&amp;n=a0587811.html"/></a></noscript>
</div>
</td>
</tr>
</table>
<br/>
<div class="vegies">
<div class="tc">
<span class="sts">Angle Brackets and Curly Braces</span><br>
<span class="ts">Comparing DSLs in Ruby and Scala</span><br/>
<span class="as">by Bill Venners</span><br/>
<span class="pd">March 10, 2009</span><br/>
</br></div>
<blockquote>
<b>Summary</b><br/>
Last week I released a new version of ScalaTest (0.9.5) that includes a "matchers DSL" for writing more expressive assertions in tests. In this post I show differences between ScalaTest matchers and those in Ruby's RSpec tool, and discuss some of the general differences in DSL creation in Ruby and Scala.

</blockquote>
<hr align="left" width="90%"/>
<table align="right">
<tr>
<td>
<div class="adnotice">
Advertisement
</div>
<center>
<script language="JavaScript" src="../_/https/www.artima.com/zcr/adx.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
if (!document.phpAds_used) document.phpAds_used = ',';
phpAds_random = new String (Math.random()); phpAds_random = phpAds_random.substring(2,11);
document.write ("<" + "script language='JavaScript' type='text/javascript' src='");
document.write ("../_/https/www.artima.com/zcr/adjs.html$/n=.html" + phpAds_random);
document.write ("&amp;what=zone:2");
document.write ("&amp;exclude=" + document.phpAds_used);
if (document.referrer)
document.write ("&amp;referer=" + escape(document.referrer));
document.write ("'><" + "/script>");
//-->
</script><noscript><a href="../_/https/www.artima.com/zcr/adclick.html$/n=a74ab060.html" target="_blank"><img alt="" border="0" src="../_/https/www.artima.com/zcr/adview.html$/what=zone:2&amp;n=a74ab060.html"/></a></noscript>
</center>
</td>
</tr>
</table>
<p>
<p>
Dynamic languages such as Ruby and Groovy have a reputation for enabling "internal" domain specific language (DSL) creation, but internal DSLs are not only a feature of dynamic languages. Although Scala is statically typed, its flexible syntax is quite accommodating to internal DSLs. However, the different languages place different constraints on DSL design.
</p>
<h2>Invoking methods without parentheses (or dots)</h2>
<p>
One feature of Ruby that helps in DSL creation, for example, is that you can leave off parentheses when you invoke a method. For example, given a string in Ruby:
</p>
<pre class="indent">
&gt;&gt; s = "hello"
=&gt; "hello"
</pre>
<p>
You can determine whether it contains a substring like this:
</p>
<pre class="indent">
&gt;&gt; s.include?("el")
=&gt; true
</pre>
<p>
Or, alternatively, by leaving off the parentheses, like this:
</p>
<pre class="indent">
&gt;&gt; s.include? "el"
=&gt; true
</pre>
<p>
Scala does not let you leave off the parentheses in the same way:
</p>
<pre class="indent">
scala&gt; val s = "hello"                                             
s: java.lang.String = hello

scala&gt; s.contains("el")
res5: Boolean = true

scala&gt; s.contains "el" 
<console>:1: error: ';' expected but string literal found.
       s.contains "el"
                  ^
</console></pre>
<p>
However, Scala supports an "operator notation," which allows you to leave off both the dot and the parentheses:
</p>
<pre class="indent">
scala&gt; s contains "el" 
res6: Boolean = true
</pre>
<p>
By contrast, Ruby does not support this kind of operator notation:
</p>
<pre class="indent">
&gt;&gt; s include? "el"
(irb):21: warning: parenthesize argument(s) for future version
NoMethodError: undefined method `include?' for main:Object
	from (irb):21
</pre>
<h2>Adding methods to existing classes</h2>
<p>
Another feature of Ruby that facilitates DSL creation is its <em>open classes</em>, which among other things allows you to add new methods to existing classes. For example, class <code>String</code> in Ruby has no method named <code>should</code>:
</p>
<pre class="indent">
&gt;&gt; "".should
NoMethodError: undefined method `should' for "":String
	from (irb):1
</pre>
<p>
Nevertheless, here's how you could, using open classes, add a method named <code>should</code> to class <code>String</code> in Ruby:
</p>
<pre class="indent">
&gt;&gt; class String
&gt;&gt;   def should
&gt;&gt;     "should was invoked!"
&gt;&gt;   end
&gt;&gt; end
=&gt; nil
</pre>
<p>
Now you can invoke <code>should</code> on Ruby <code>String</code>:
</p>
<pre class="indent">
&gt;&gt; puts "".should
should was invoked!
=&gt; nil
</pre>
<p>
Scala, being statically typed, doesn't support open classes. The methods supported by a class are fixed at compile time. However, Scala's <em>implicit conversion</em> feature provides much the same benefit, allowing you to write code in which it <em>appears</em> you are invoking new methods on existing classes. For example, because Scala's string is <code>java.lang.String</code>, you can't invoke <code>should</code> on it:
</p>
<pre class="indent">
scala&gt; "".should
<console>:5: error: value should is not a member of java.lang.String
       "".should
          ^
</console></pre>
<p>
Nevertheless, you can define an implicit conversion from <code>String</code> to a type that does have a <code>should</code> method. The Scala compiler will apply the implicit conversion to solve a type error. Here's how you could define the implicit conversion:
</p>
<pre class="indent">
scala&gt; class ShouldWrapper(s: String) {
     |   def should = "should was invoked on " + s
     | }
defined class ShouldWrapper

scala&gt; implicit def convert(s: String) = new ShouldWrapper(s)
convert: (String)ShouldWrapper
</pre>
<p>
Given this implicit conversion, you can now write code that appears to invoke should on a string:
</p>
<pre class="indent">
scala&gt; "howdy".should
res10: java.lang.String = should was invoked on howdy
</pre>
<p>
Behind the scenes, the Scala compiler will implicitly convert the <code>String</code> to a <code>ShouldWrapper</code>, and then invoke <code>should</code> on the <code>ShouldWrapper</code>, like this:
</p>
<pre class="indent">
scala&gt; convert("howdy").should
res11: java.lang.String = should was invoked on howdy
</pre>
<h2>Comparing Matchers DSLs</h2>
<p>
Ruby's <a href="../_/http/rspec.info/index.html">RSpec</a> tool includes a <a href="../_/http/rspec.rubyforge.org/rspec/1.1.12/classes/Spec/Matchers.html">matchers DSL</a>, that allows you to write assertions in tests that look like this:
</p>
<pre class="indent">
result.should be_true         # this is RSpec
result.should_not be_nil
num.should eql(5)
map.should_not have_key("a")
</pre>
<p>
One thing to note is that Ruby's convention of separating words with underscores helps make these expressions read more like English. Between each word is either a space, underscore, or dot. In Scala, you could use operator notation to get rid of the dot, yielding expressions like:
</p>
<pre class="indent">
result should be_true      // Could do this in Scala
result should_not be_null
num should eql(5)
map should_not have_key("a")
</pre>
<p>
The problem is that this use of the underscore is not idiomatic in Scala. Like Java, Scala style suggests using camel case, which would yield expressions like:
</p>
<pre class="indent">
result should beTrue      // Could do this in Scala
result shouldNot beNull
num should eql(5)
map shouldNot haveKey("a")
</pre>
<p>
This works, but is not quite as satisfying, because the words do not separate as nicely in camel case compared to underscores. When designing a <a href="../_/http/www.artima.com/scalatest/doc-0.9.5/org/scalatest/matchers/ShouldMatchers.html">matchers DSL</a> for <a href="../_/http/www.artima.com/scalatest/index.html">ScalaTest</a>, I decided to try and see how far I could go with operator notation. The corresponding expressions in ScalaTest are:
</p>
<pre class="indent">
result should be (true)      // This is ScalaTest
result should not be (null)
num should equal (5)
map should not contain key ("a")
</pre>
<p>
The parentheses on the rightmost value are not always required, but the rule is subtle, so I recommend you always use them. The parentheses also serve to emphasize what is usually the expected value. Here's how one of these expressions will be rewritten by the Scala compiler, when it desugars the operator notation back into normal method call notation during compilation:
</p>
<pre class="indent">
result.should(not).be(null)
</pre>
<p>
The <code>should</code> method is invoked on <code>result</code> (via an implicit conversion), passing in the object referred to by a variable named <code>not</code>. Then <code>be</code> is invoked on that return value, passing in <code>null</code>. In other words, in this expression, operator notation is used twice in a row.
</p>
<h2>Conclusion</h2>
<p>
When designing an internal DSL, you don't have as much freedom as when you design an external DSL—<em>i.e.</em>, a new language from scratch. With an internal DSL you need to work within the confines of the host language, and so will your users. In RSpec's matchers, for example, users need to keep track of where to put dots, underscores, and spaces. Similarly, in ScalaTest matchers, users need to keep track of where to put parentheses. In both cases, the syntax is nevertheless quite easy to learn, and the resulting code is quite readable. 
</p>
<h2>Resources</h2>
<p>
RSpec:<br>
<a href="../_/http/rspec.info/index.html">http://rspec.info/</a>
</br></p>
<p>
ScalaTest<br/>
<a href="../_/http/www.artima.com/scalatest/index.html">http://www.artima.com/scalatest</a>
</p>
<p>
Programming in Scala<br/>
<a href="../_/http/www.artima.com/shop/programming_in_scala/index.html">http://www.artima.com/shop/programming_in_scala</a>
</p>
<h1>Talk Back!</h1>
<p>
Have an opinion?


Readers have already posted

<a href="../_/https/www.artima.com/forums/flat.html$/forum=106&amp;thread=251945.html">6

comments</a>
about this weblog entry. Why not

<a href="../_/https/www.artima.com/forums/post.html$/forum=106&amp;thread=251945&amp;reply=true.html">add yours</a>?


<h1>RSS Feed</h1>
<p>
If you'd like to be notified whenever Bill Venners adds a new entry to <a href="../index.html$/blogger=bv.html">his weblog</a>, subscribe to his <a href="../feeds/bloggers/bv.rss">RSS feed</a>.

<center>
<div class="sociallinks">
<a href="../_/http/digg.com/submit$/phase=2&amp;url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D251945&amp;title=Comparing+DSLs+in+Ruby+and+Scala&amp;bodytext=Last+week+I+released+a+new+version+of+ScalaTest+%280.9.5%29+that+includes+a+%26quot%3Bmatchers+DSL%26quot%3B+for+writing+more+expressive+assertions+in+tests.+In+this+post+I+show+differences+between+ScalaTest+matchers+and+those+in+Ruby%27s+RSpec+tool%2C+and+discuss+_&amp;topic=programming">
<img alt="Digg" border="0" height="14" hspace="8" src="../_/https/www.artima.com/images/digg.gif" width="16">Digg
  </img></a>
  |
  <a href="../_/http/del.icio.us/post$/url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D251945&amp;title=Comparing+DSLs+in+Ruby+and+Scala">
<img alt="del.icio.us" border="0" height="16" hspace="8" src="../_/https/www.artima.com/images/delicious.gif" vspace="1" width="16">del.icio.us
  </img></a>
  |
  <a href="../_/http/programming.reddit.com/submit$/url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D251945&amp;title=Comparing+DSLs+in+Ruby+and+Scala">
<img alt="Reddit" border="0" height="18" hspace="8" src="../_/https/www.artima.com/images/reddit.gif" width="18"/>Reddit
  </a>
</div>
</center>
<h1>About the Blogger</h1>
<p>
<table><tr valign="bottom"><td><img align="right" src="../_/https/www.artima.com/images/bv.jpg"/></td><td>Bill Venners is president of Artima, Inc., publisher of Artima Developer (www.artima.com). He is author of the book, <em>Inside the Java Virtual Machine</em>, a programmer-oriented survey of the Java platform's architecture and internals. His popular columns in JavaWorld magazine covered Java internals, object-oriented design, and Jini. Active in the Jini Community since its inception, Bill led the Jini Community's ServiceUI project, whose ServiceUI API became the de facto standard way to associate user interfaces to Jini services.  Bill is also the lead developer and designer of ScalaTest, an open source testing tool for Scala and Java developers, and coauthor with Martin Odersky and Lex Spoon of the book, <em>Programming in Scala</em>.</td></tr></table><p>
<div class="sp">This weblog entry is Copyright © 2009 Bill Venners. All rights reserved.</div>
</p></p></p></p></p></div>

<hr width="100%">
<table align="center" width="50%">
<tr>
<td>
<div class="horizontaltextadbox">
<div class="adheadline">Sponsored Links</div>
<div id="sponsoredlinks">
</div>
</div>
</td>
</tr>
</table>
<hr width="100%"/>
<center>
<script type="text/javascript"><!--
google_ad_client = "pub-3911176865765226";
google_alternate_color = "ffffff";
google_ad_width = 728;
google_ad_height = 15;
google_ad_format = "728x15_0ads_al";
google_ad_channel = "";
google_color_border = "ffffff";
google_color_bg = "FFFFFF";
google_color_link = "003090";
google_color_text = "000000";
google_color_url = "666666";
//--></script>
<script src="../_/https/pagead2.googlesyndication.com/pagead/show_ads.js" type="text/javascript">
</script>
<br/>
<br/>
<!-- SiteSearch Google -->
<form action="../_/https/www.google.com/custom/index.html" method="get">
<table bgcolor="#ffffff" border="0">
<tr><td align="left" height="32" nowrap="nowrap" valign="top">
<a href="../_/https/www.google.com/index.html">
<img alt="Google" border="0" src="../_/https/www.google.com/logos/Logo_25wht.gif"/></a>
</td>
<td nowrap="nowrap">
<input name="domains" type="hidden" value="Artima.com"/>
<input maxlength="255" name="q" size="31" type="text" value=""/>
<input name="sa" type="submit" value="Search"/>
</td></tr>
<tr>
<td> </td>
<td nowrap="nowrap">
<font color="#000000" size="-1">
<input name="sitesearch" type="radio" value=""/> Web
<input checked="checked" name="sitesearch" type="radio" value="Artima.com"/>Artima.com
</font>  
<input name="client" type="hidden" value="pub-3911176865765226"/>
<input name="forid" type="hidden" value="1"/>
<input name="ie" type="hidden" value="ISO-8859-1"/>
<input name="oe" type="hidden" value="ISO-8859-1"/>
<input name="cof" type="hidden" value="GALT:#008000;GL:1;DIV:#336699;VLC:663399;AH:center;BGC:FFFFFF;LBGC:FFFFFF;ALC:0000FF;LC:0000FF;T:000000;GFNT:0000FF;GIMP:0000FF;LH:50;LW:150;L:https://www.artima.com/images/artima150.gif;S:https://www.artima.com;FORID:1;"/>
<input name="hl" type="hidden" value="en"/>
</td></tr></table>
</form>
<!-- SiteSearch Google -->
</center>
<br/>
<div class="sp">
<div style="text-align: center;">
<a href="../_/https/www.artima.com/copyright.html">Copyright</a> © 1996-2019 Artima, Inc. All Rights Reserved. - <a href="../_/https/www.artima.com/privacy.html">Privacy Policy</a> - <a href="../_/https/www.artima.com/termsofuse.html">Terms of Use</a>
</div>
</div>
<br/>
<script language="JavaScript" type="text/javascript">
<!--
function initBannerVarForZone(zone) {
        initBannerVarForZoneWithScript(zone, 'adjs_modified');
}

function initBannerVarForZoneWithScript(zone, phpScript) {

        if (!document.phpAds_used) document.phpAds_used = ',';
        phpAds_random = new String (Math.random());
        phpAds_random = phpAds_random.substring(2,11);

        var nextScriptSrc = '../_/https/www.artima.com/zcr/index.html' + phpScript + '.php?n=' +
                phpAds_random  +
                '&amp;what=zone:' + zone + '&amp;target=_top&amp;block=1&amp;blockcampaign=1' +
                '&amp;exclude=' + document.phpAds_used;

        document.write("<script language='JavaScript' type='text/javascript' src='");
        document.write(nextScriptSrc);
        document.write("'><\/script>");

}

function replaceDiv(divID) {
        document.getElementById(divID).innerHTML = phpadsbanner;
}
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
initBannerVarForZone(3);
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
replaceDiv('leftskyscraper');
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
initBannerVarForZoneWithScript(4, 'textman');
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
replaceDiv('sponsoredlinks');
-->
</script>
</hr><a href="https://dafoster.net/projects/crystal-web-archiver/" id="cr-footer-banner" style="border-top: 2px #B40010 solid;background: #FFFAE1;font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;font-variant: initial;font-weight: initial;text-transform: none;font-size: 14px;color: #6c757d;line-height: 2.0;cursor: pointer;display: flex;align-items: center;justify-content: center;gap: 4px;clear: both;" target="_blank"><img height="24" onerror="this.style['display'] = 'none';" src="../_/crystal/resources/appicon.png" width="24"/><span>This page was archived with Crystal</span><script>window.addEventListener('load', function() { const $1 = document.querySelector('#cr-footer-banner'); if (!$1) { return; } if (window !== window.top) { let $2 = false; if (window.name) { const $3 = window.parent.document.getElementsByName(window.name); if ($3.length === 1) { const $4 = $3[0]; if ($4.tagName === 'FRAME' && $4.parentElement.tagName === 'FRAMESET') { let $5 = $4; while (true) { if ($5.parentElement.tagName !== 'FRAMESET') { $2 = true; break; } if ($5.parentElement.attributes['rows'] !== undefined) { const $6 = $5.parentElement.children; if ($5 === $6[$6.length - 1]) { $5 = $5.parentElement; continue; } else { break; } } else if ($5.parentElement.attributes['cols'] !== undefined) { const $7 = Array.from($5.parentElement.children); const $8 = $7.indexOf($5); if ($8 === -1) { break; } const $9 = $5.parentElement.attributes['cols'].value.split(','); const $10 = $9.map((s) => parseInt(s.trim())); if ($9[$8].trim() === '*' || $10[$8] === Math.max.apply(null, $10)) { $5 = $5.parentElement; continue; } else { break; } } else { break; } } } } } if (!$2) { $1.style['display'] = 'none'; } } const $11 = $1.getBoundingClientRect(); const $12 = ($11.y < window.innerHeight - $11.height); if ($12) { $1.style['position'] = 'fixed'; $1.style['bottom'] = '0'; $1.style['left'] = '0'; $1.style['right'] = '0'; $1.style['z-index'] = '9999'; } const $13 = ( document.body.getBoundingClientRect().height < $11.height * 2 ); if ($13) { $1.style['display'] = 'none'; }
});</script></a></body>
</html>
