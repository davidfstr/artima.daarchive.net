
<!DOCTYPE html>

<html>
<head><meta content="noindex,nofollow" name="robots"/>
<title>Generic functions vs mixins: a case study</title>
<meta charset="utf-8"/>
<meta content="Michele Simionato" name="author">
<link href="../_/https/www.artima.com/artima.css" rel="stylesheet" type="text/css"/>
<link href="../_/https/www.artima.com/favicon.ico" rel="shortcut icon"/>
</meta></head>
<body><table cellspacing="0" width="100%">
<tr>
<td align="left" valign="bottom">
<a href="../_/https/www.artima.com/index.html"><img alt="The Artima Developer Community" border="0" height="43" src="../_/https/www.artima.com/images/a7.gif" width="550"/></a>
</td>
</tr></table>
<table bgcolor="#333333" width="100%">
<tr>
<td align="center">
<div class="ml">
<a class="hl" href="../_/https/www.artima.com/articles/index.html">Articles</a> |
<a class="hl" href="../_/https/www.artima.com/news/index.html">News</a> |
<a class="hl" href="../index.html">Weblogs</a> |
<a class="hl" href="../_/https/www.artima.com/shop/catalog/index.html">Books</a> |
<a class="hl" href="../_/https/www.artima.com/forums/index.html">Forums</a>
</div>
</td>
</tr>
</table>
<table bgcolor="#CCCCCC" width="100%">
<tr>
<td align="center">
<div class="sc">
<a href="../index.html">Artima Weblogs</a> | 

<a href="../index.html$/blogger=micheles.html">Michele Simionato's Weblog</a> | 

<a href="../_/https/www.artima.com/forums/flat.html$/forum=106&amp;thread=237764.html">Discuss</a> | 
<a href="mailto:?subject=Generic functions vs mixins: a case study&amp;body= %0AArtima Weblogs %0AGeneric functions vs mixins: a case study %0Aby Michele Simionato %0A%0Ahttps://www.artima.com/weblogs/viewpost.jsp?thread=237764">Email</a> | 
<a href="../viewpostP.html$/thread=237764.html">Print</a> | 
<a href="../bloggers.html">Bloggers</a> | 
<a class="sl" href="thread=237121.html" title="Things to Know About Python Super [3 of 3]">Previous</a> | 
<a class="sl" href="thread=238789.html" title="The Adventures of a Pythonista in Schemeland/1">Next</a>
</div>
</td>
</tr>
</table>
<table bgcolor="#EEEEEE" width="100%">
<tr>
<td align="center">
<div class="sc">
<span style="color: #555555;">Sponsored Link</span> <span style="color: #888888;">•</span>
<script language="JavaScript" src="../_/https/www.artima.com/zcr/adx.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
   if (!document.phpAds_used) document.phpAds_used = ',';
   phpAds_random = new String (Math.random()); phpAds_random = phpAds_random.substring(2,11);
   
   document.write ("<" + "script language='JavaScript' type='text/javascript' src='");
   document.write ("../_/https/www.artima.com/zcr/adjs.html$/n=.html" + phpAds_random);
   document.write ("&amp;what=zone:9&amp;target=_top");   document.write ("&amp;exclude=" + document.phpAds_used);
   if (document.referrer)
      document.write ("&amp;referer=" + escape(document.referrer));
   document.write ("'><" + "/script>");
//-->
</script><noscript><a href="../_/https/www.artima.com/zcr/adclick.html$/n=a799ecf6.html" target="_top"><img alt="" border="0" src="../_/https/www.artima.com/zcr/adview.html$/what=zone:9&amp;n=a0587811.html"/></a></noscript>
</div>
</td>
</tr>
</table>
<br/>
<div class="vegies">
<div class="tc">
<span class="sts">The Explorer</span><br>
<span class="ts">Generic functions vs mixins: a case study</span><br/>
<span class="as">by Michele Simionato</span><br/>
<span class="pd">September 3, 2008</span><br/>
</br></div>
<blockquote>
<b>Summary</b><br/>
Just yesterday at work I had a good real-life use case
for generic functions which deserved a blog post.

</blockquote>
<hr align="left" width="90%"/>
<table align="right">
<tr>
<td>
<div class="adnotice">
Advertisement
</div>
<center>
<script language="JavaScript" src="../_/https/www.artima.com/zcr/adx.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
if (!document.phpAds_used) document.phpAds_used = ',';
phpAds_random = new String (Math.random()); phpAds_random = phpAds_random.substring(2,11);
document.write ("<" + "script language='JavaScript' type='text/javascript' src='");
document.write ("../_/https/www.artima.com/zcr/adjs.html$/n=.html" + phpAds_random);
document.write ("&amp;what=zone:2");
document.write ("&amp;exclude=" + document.phpAds_used);
if (document.referrer)
document.write ("&amp;referer=" + escape(document.referrer));
document.write ("'><" + "/script>");
//-->
</script><noscript><a href="../_/https/www.artima.com/zcr/adclick.html$/n=a74ab060.html" target="_blank"><img alt="" border="0" src="../_/https/www.artima.com/zcr/adview.html$/what=zone:2&amp;n=a74ab060.html"/></a></noscript>
</center>
</td>
</tr>
</table>
<p>
<p>In the last few weeks my collegues and me have been involved in a
project which required a command line interface. We did so by
leveraging on the <tt class="docutils literal"><span class="pre">cmd</span></tt> module in the standard Python library, to
which we added a network layer using Twisted. In the end, we had
classes interacting with the standard streams <tt class="docutils literal"><span class="pre">stdin</span></tt>, <tt class="docutils literal"><span class="pre">stdout</span></tt>,
<tt class="docutils literal"><span class="pre">stderr</span></tt> and classes interacting with nonstandard streams such as
Twisted transports.  All the I/O was line oriented and we basically
needed three methods:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">print_out(self,</span> <span class="pre">text,</span> <span class="pre">*args)</span></tt> to print a line
on <tt class="docutils literal"><span class="pre">self.stdout</span></tt></li>
<li><tt class="docutils literal"><span class="pre">print_err(self,</span> <span class="pre">text,</span> <span class="pre">*args)</span></tt> to print a line
on <tt class="docutils literal"><span class="pre">self.stderr</span></tt></li>
<li><tt class="docutils literal"><span class="pre">readln_in(self)</span></tt> to read a line from <tt class="docutils literal"><span class="pre">self.stdin</span></tt></li>
</ul>
<p>Depending on the type of <tt class="docutils literal"><span class="pre">self</span></tt>, <tt class="docutils literal"><span class="pre">self.stdout</span></tt> was
<tt class="docutils literal"><span class="pre">sys.stdout</span></tt>, a Twisted transport, a log file or a file-like
wrapper to a database. Likewise for <tt class="docutils literal"><span class="pre">self.stderr</span></tt> and <tt class="docutils literal"><span class="pre">self.stdin</span></tt>.</p>
<p>This is a problem that begs for generic functions. Unfortunately,
nobody in the Python world uses them (with the exception of P. J. Eby)
so for the moment we are using a suboptimal design involving mixins instead.
I am not really happy with that.
The aim of this blog post is to explain why a mixin solution is inferior
to a generic functions solution.</p>
<div class="section">
<h1><a id="a-mixin-oriented-solution" name="a-mixin-oriented-solution">A mixin-oriented solution</a></h1>
<p>In the mixin solution, instead of generic functions one uses plain
old methods, stored into a mixin class. In this specific
case let me call the class <tt class="docutils literal"><span class="pre">StdIOMixin</span></tt>:</p>
<pre class="literal-block">
class StdIOMixin(object):
    "A mixin implementing line-oriented I/O"
    stdin = sys.stdin
    stdout = sys.stdout
    stderr = sys.stderr
    linesep = os.linesep

    def print_out(self, text, *args):
        "Write on self.stdout by flushing"
        write(self.stdout, str(text) + self.linesep, *args)

    def print_err(self, text, *args):
        "Write on self.stderr by flushing"
        write(self.stderr, str(text) + self.linesep, *args)

    def readln_in(self):
        "Read a line from self.stdin (without trailing newline) or None"
        line = self.stdin.readline()
        if line:
            return line[:-1] # strip trailing newline
</pre>
<p>where <tt class="docutils literal"><span class="pre">write</span></tt> is the following helper function:</p>
<pre class="literal-block">
def write(stream, text, *args):
    'Write on a stream by flushing if possible'
    if args: # when no args, do not consider '%' a special char
        text = text % args
    stream.write(text)
    flush = getattr(stream, 'flush', False)
    if flush:
        flush()
</pre>
<p><tt class="docutils literal"><span class="pre">StdIOMixin</span></tt> is there to be mixed with other classes, providing
them with the ability to perform line-oriented I/O. By default, it
works on the standard streams, but if the client class overrides
the attributes <tt class="docutils literal"><span class="pre">stdout</span></tt>, <tt class="docutils literal"><span class="pre">stderr</span></tt>, <tt class="docutils literal"><span class="pre">stdin</span></tt> with suitable file-like
objects, it can be made to work with Twisted transports, files and
databases. For instance, here is an example where <tt class="docutils literal"><span class="pre">stdout</span></tt> and <tt class="docutils literal"><span class="pre">stderr</span></tt>
are overridden as files:</p>
<pre class="literal-block">
class FileIO(StdIOMixin):
    def __init__(self):
        self.stdout = file('out.txt', 'w')
        self.stderr = file('err.txt', 'w')
</pre>
<pre class="doctest-block">
&gt;&gt;&gt; FileIO().print_out('hello!') # prints a line on out.txt
</pre>
<p>The design works and it looks elegant, but still I say that it is sub-optimal
compared to generic functions.</p>
<p>The basic problem of this design is that it adds methods
to the client classes and therefore it adds to the learning
curve. Suppose you have four client classes - one managing standard
stream, one managing files, one managing Twisted transports and one
managing database connections - then you have to add the mixin four
times. If you generate the documentation for your classes, the
methods <tt class="docutils literal"><span class="pre">print_out</span></tt>, <tt class="docutils literal"><span class="pre">print_err</span></tt> and <tt class="docutils literal"><span class="pre">readln_in</span></tt> will be
documented four times. And this is not a shortcoming of pydoc:
the three methods are effectively cluttering your application
in a linear way, proportionally to the number of classes you have.</p>
<p>Moreover, those methods will add to the pollution of your class namespace,
with the potential risk on name collisions, especially in large frameworks.
In large frameworks (i.e. Plone, where a class my have 700+ attributes)
this is a serious problem: for instance, you cannot even use
auto-completion, since there are just too many completions. You must know
that I am <a class="reference" href="../_/http/stacktrace.it/articoli/2008/08/i-pericoli-della-programmazione-con-i-mixin3/index.html">very sensitive to namespace pollution</a> so I always favor
approaches that can avoid it.</p>
<p>Also, suppose you only need the <tt class="docutils literal"><span class="pre">print_out</span></tt> functionality; the mixin
approach naturally would invite you to include the entire
<tt class="docutils literal"><span class="pre">StdIOMixin</span></tt>, importing in your class methods you don't need.  The
alternative would be to create three mixin classes <tt class="docutils literal"><span class="pre">StdinMixin</span></tt>,
<tt class="docutils literal"><span class="pre">StdoutMixin</span></tt>, <tt class="docutils literal"><span class="pre">StderrMixin</span></tt>, but most of the time you would need
all of them; it seems overkill to complicate so much your inheritance
hierarchy for a very simple functionality.</p>
<p><a class="reference" href="../_/http/www.artima.com/weblogs/viewpost.html$/thread=237121.html">As you may know</a>, I am always looking for solutions avoiding
(multiple) inheritance and
generic functions fit the bill perfectly.</p>
</div>
<div class="section">
<h1><a id="a-generic-functions-solution" name="a-generic-functions-solution">A generic functions solution</a></h1>
<p>I am sure most people do not
know about it, but Python 2.5 ships with an implementation of generic
functions in the standard library, in the <tt class="docutils literal"><span class="pre">pkgutil</span></tt> module (by P.J. Eby).
Currently, the implementation is only used
internally in <tt class="docutils literal"><span class="pre">pkgutil</span></tt> and it is completely undocumented;
therefore I never had the courage to use it in production, but
it works well. Even if it is simple, it is able to cover
most practical uses of generic functions. For instance, in our case we need
three generic functions:</p>
<pre class="literal-block">
from pkgutil import simplegeneric

@simplegeneric
def print_out(self, text, *args):
    if args:
        text = text % args
    print &gt;&gt; self.stdout, text

@simplegeneric
def print_err(self, text, *args):
    if args:
        text = text % args
    print &gt;&gt; self.stderr, text

@simplegeneric
def readln_in(self):
    "Read a line from self.stdin (without trailing newline)"
    line = self.stdin.readline()
    if line:
        return line[:-1] # strip trailing newline
</pre>
<p>The power of generic functions is that you don't need to use inheritance:
<tt class="docutils literal"><span class="pre">print_out</span></tt> will work on any object with a <tt class="docutils literal"><span class="pre">.stdout</span></tt> attribute
even if it does not derive from <tt class="docutils literal"><span class="pre">StdIOMixin</span></tt>. For instance, if you
define the class</p>
<pre class="literal-block">
class FileOut(object):
    def __init__(self):
        self.stdout = file('out.txt', 'w')
</pre>
<p>the following will print a message on the file <tt class="docutils literal"><span class="pre">out.txt</span></tt>:</p>
<pre class="doctest-block">
&gt;&gt;&gt; print_out(FileOut(), 'writing on file') # prints a line on out.txt
</pre>
<p>Simple, isn't it?</p>
</div>
<div class="section">
<h1><a id="extending-generic-functions" name="extending-generic-functions">Extending generic functions</a></h1>
<p>One advantage of methods with respect to ordinary functions is that they can
be overridden in subclasses; however, generic functions can be overridden
too - this is why they are also called multimethods. For instance,
you could define a class <tt class="docutils literal"><span class="pre">AddTimeStamp</span></tt> and override <tt class="docutils literal"><span class="pre">print_out</span></tt>
to add a time stamp when applied to instances of <tt class="docutils literal"><span class="pre">AddTimeStamp</span></tt>.
Here is how you would do it:</p>
<pre class="literal-block">
class AddTimeStamp(object):
    stdout = sys.stdout
</pre>
<pre class="literal-block">
@print_out.register(AddTimeStamp) # add an implementation to print_out
def impl(self, text, *args):
    "Implementation of print_out for AddTimeStamp instances"
    if args:
        text = text % args
    print &gt;&gt; self.stdout, datetime.datetime.now().isoformat(), text
</pre>
<p>and here in an example of use:</p>
<pre class="doctest-block">
&gt;&gt;&gt; print_out(AddTimeStamp(), 'writing on stdout')
2008-09-02T07:28:46.863932 writing on stdout
</pre>
<p>The syntax  <tt class="docutils literal"><span class="pre">@print_out.register(AddTimeStamp)</span></tt> is not the most beatiful
in the world, but its purposes should be clear: we are registering the
implementation of <tt class="docutils literal"><span class="pre">print_out</span></tt> to be used for instances of <tt class="docutils literal"><span class="pre">AddTimeStamp</span></tt>.
When <tt class="docutils literal"><span class="pre">print_out</span></tt> is invoked on an instance of
<tt class="docutils literal"><span class="pre">AddTimeStamp</span></tt> a time stamp is printed; otherwise, the default implementation
is used.</p>
<p>Notice that since the implementation of <tt class="docutils literal"><span class="pre">simplegeneric</span></tt> is simple,
the internal registry of implementations is not exposed and there is no
introspection API; moreover, <tt class="docutils literal"><span class="pre">simplegeneric</span></tt> works for single dispatch
only and there is no explicit support for multimethod
cooperation (i.e. <tt class="docutils literal"><span class="pre">call-next-method</span></tt>, for the ones familiar with
Common Lisp). Yet, you cannot pretend too much from thirty lines of code ;)</p>
<p>In this example I have named the <tt class="docutils literal"><span class="pre">AddTimeStamp</span></tt> implementation
of <tt class="docutils literal"><span class="pre">print_out</span></tt>
<tt class="docutils literal"><span class="pre">impl</span></tt>,  but you could have used any valid Python identifier,
including <tt class="docutils literal"><span class="pre">print_out_AddTimeStamp</span></tt>
or <tt class="docutils literal"><span class="pre">_</span></tt>, if you felt so. Since the name <tt class="docutils literal"><span class="pre">print_out</span></tt> is explicit in
the decorator and since in practice you do not need to access the
explicit implementation directly, I have settled for a generic name like
<tt class="docutils literal"><span class="pre">impl</span></tt>. There is no standard convention since nobody uses
generic functions in Python (yet).</p>
<p>There were plan to add generic functions to Python 3.0, but the
proposal have been shifted to Python 3.1, with a syntax yet to
define. Nevertheless, for people who don't want to wait,
<tt class="docutils literal"><span class="pre">pkgutil.simplegeneric</span></tt> is already there and you can start
experimenting with generic functions right now.  Have fun!</p>
</div>
<h1>Talk Back!</h1>
<p>
Have an opinion?


Readers have already posted

<a href="../_/https/www.artima.com/forums/flat.html$/forum=106&amp;thread=237764.html">11

comments</a>
about this weblog entry. Why not

<a href="../_/https/www.artima.com/forums/post.html$/forum=106&amp;thread=237764&amp;reply=true.html">add yours</a>?


<h1>RSS Feed</h1>
<p>
If you'd like to be notified whenever Michele Simionato adds a new entry to <a href="../index.html$/blogger=micheles.html">his weblog</a>, subscribe to his <a href="../feeds/bloggers/micheles.rss">RSS feed</a>.

<center>
<div class="sociallinks">
<a href="../_/http/digg.com/submit$/phase=2&amp;url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D237764&amp;title=Generic+functions+vs+mixins%3A+a+case+study&amp;bodytext=Just+yesterday+at+work+I+had+a+good+real-life+use+case%0D%0Afor+generic+functions+which+deserved+a+blog+post.&amp;topic=programming">
<img alt="Digg" border="0" height="14" hspace="8" src="../_/https/www.artima.com/images/digg.gif" width="16">Digg
  </img></a>
  |
  <a href="../_/http/del.icio.us/post$/url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D237764&amp;title=Generic+functions+vs+mixins%3A+a+case+study">
<img alt="del.icio.us" border="0" height="16" hspace="8" src="../_/https/www.artima.com/images/delicious.gif" vspace="1" width="16">del.icio.us
  </img></a>
  |
  <a href="../_/http/programming.reddit.com/submit$/url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D237764&amp;title=Generic+functions+vs+mixins%3A+a+case+study">
<img alt="Reddit" border="0" height="18" hspace="8" src="../_/https/www.artima.com/images/reddit.gif" width="18"/>Reddit
  </a>
</div>
</center>
<h1>About the Blogger</h1>
<p>
<table><tr valign="bottom"><td><img align="right" src="../_/https/www.artima.com/images/micheleSimionato.jpg"/></td><td>Michele Simionato started his career as a Theoretical Physicist, working in Italy, France and the U.S. He turned to programming in 2003; since then he has been working professionally as a Python developer and now he lives in Milan, Italy. Michele is well known in the Python community for his posts in the newsgroup(s), his articles and his Open Source libraries and recipes. His interests include object oriented programming, functional programming, and in general programming metodologies that enable us to manage the complexity of modern software developement.</td></tr></table><p>
<div class="sp">This weblog entry is Copyright © 2008 Michele Simionato. All rights reserved.</div>
</p></p></p></p></p></div>

<hr width="100%">
<table align="center" width="50%">
<tr>
<td>
<div class="horizontaltextadbox">
<div class="adheadline">Sponsored Links</div>
<div id="sponsoredlinks">
</div>
</div>
</td>
</tr>
</table>
<hr width="100%"/>
<center>
<script type="text/javascript"><!--
google_ad_client = "pub-3911176865765226";
google_alternate_color = "ffffff";
google_ad_width = 728;
google_ad_height = 15;
google_ad_format = "728x15_0ads_al";
google_ad_channel = "";
google_color_border = "ffffff";
google_color_bg = "FFFFFF";
google_color_link = "003090";
google_color_text = "000000";
google_color_url = "666666";
//--></script>
<script src="../_/https/pagead2.googlesyndication.com/pagead/show_ads.js" type="text/javascript">
</script>
<br>
<br/>
<!-- SiteSearch Google -->
<form action="../_/https/www.google.com/custom/index.html" method="get">
<table bgcolor="#ffffff" border="0">
<tr><td align="left" height="32" nowrap="nowrap" valign="top">
<a href="../_/https/www.google.com/index.html">
<img alt="Google" border="0" src="../_/https/www.google.com/logos/Logo_25wht.gif"/></a>
</td>
<td nowrap="nowrap">
<input name="domains" type="hidden" value="Artima.com"/>
<input maxlength="255" name="q" size="31" type="text" value=""/>
<input name="sa" type="submit" value="Search"/>
</td></tr>
<tr>
<td> </td>
<td nowrap="nowrap">
<font color="#000000" size="-1">
<input name="sitesearch" type="radio" value=""/> Web
<input checked="checked" name="sitesearch" type="radio" value="Artima.com"/>Artima.com
</font>  
<input name="client" type="hidden" value="pub-3911176865765226"/>
<input name="forid" type="hidden" value="1"/>
<input name="ie" type="hidden" value="ISO-8859-1"/>
<input name="oe" type="hidden" value="ISO-8859-1"/>
<input name="cof" type="hidden" value="GALT:#008000;GL:1;DIV:#336699;VLC:663399;AH:center;BGC:FFFFFF;LBGC:FFFFFF;ALC:0000FF;LC:0000FF;T:000000;GFNT:0000FF;GIMP:0000FF;LH:50;LW:150;L:https://www.artima.com/images/artima150.gif;S:https://www.artima.com;FORID:1;"/>
<input name="hl" type="hidden" value="en"/>
</td></tr></table>
</form>
<!-- SiteSearch Google -->
</br></center>
<br/>
<div class="sp">
<div style="text-align: center;">
<a href="../_/https/www.artima.com/copyright.html">Copyright</a> © 1996-2019 Artima, Inc. All Rights Reserved. - <a href="../_/https/www.artima.com/privacy.html">Privacy Policy</a> - <a href="../_/https/www.artima.com/termsofuse.html">Terms of Use</a>
</div>
</div>
<br/>
<script language="JavaScript" type="text/javascript">
<!--
function initBannerVarForZone(zone) {
        initBannerVarForZoneWithScript(zone, 'adjs_modified');
}

function initBannerVarForZoneWithScript(zone, phpScript) {

        if (!document.phpAds_used) document.phpAds_used = ',';
        phpAds_random = new String (Math.random());
        phpAds_random = phpAds_random.substring(2,11);

        var nextScriptSrc = '../_/https/www.artima.com/zcr/index.html' + phpScript + '.php?n=' +
                phpAds_random  +
                '&amp;what=zone:' + zone + '&amp;target=_top&amp;block=1&amp;blockcampaign=1' +
                '&amp;exclude=' + document.phpAds_used;

        document.write("<script language='JavaScript' type='text/javascript' src='");
        document.write(nextScriptSrc);
        document.write("'><\/script>");

}

function replaceDiv(divID) {
        document.getElementById(divID).innerHTML = phpadsbanner;
}
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
initBannerVarForZone(3);
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
replaceDiv('leftskyscraper');
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
initBannerVarForZoneWithScript(4, 'textman');
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
replaceDiv('sponsoredlinks');
-->
</script>
</hr><a href="https://dafoster.net/projects/crystal-web-archiver/" id="cr-footer-banner" style="border-top: 2px #B40010 solid;background: #FFFAE1;font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;font-variant: initial;font-weight: initial;text-transform: none;font-size: 14px;color: #6c757d;line-height: 2.0;cursor: pointer;display: flex;align-items: center;justify-content: center;gap: 4px;clear: both;" target="_blank"><img height="24" onerror="this.style['display'] = 'none';" src="../_/crystal/resources/appicon.png" width="24"/><span>This page was archived with Crystal</span><script>window.addEventListener('load', function() { const $1 = document.querySelector('#cr-footer-banner'); if (!$1) { return; } if (window !== window.top) { let $2 = false; if (window.name) { const $3 = window.parent.document.getElementsByName(window.name); if ($3.length === 1) { const $4 = $3[0]; if ($4.tagName === 'FRAME' && $4.parentElement.tagName === 'FRAMESET') { let $5 = $4; while (true) { if ($5.parentElement.tagName !== 'FRAMESET') { $2 = true; break; } if ($5.parentElement.attributes['rows'] !== undefined) { const $6 = $5.parentElement.children; if ($5 === $6[$6.length - 1]) { $5 = $5.parentElement; continue; } else { break; } } else if ($5.parentElement.attributes['cols'] !== undefined) { const $7 = Array.from($5.parentElement.children); const $8 = $7.indexOf($5); if ($8 === -1) { break; } const $9 = $5.parentElement.attributes['cols'].value.split(','); const $10 = $9.map((s) => parseInt(s.trim())); if ($9[$8].trim() === '*' || $10[$8] === Math.max.apply(null, $10)) { $5 = $5.parentElement; continue; } else { break; } } else { break; } } } } } if (!$2) { $1.style['display'] = 'none'; } } const $11 = $1.getBoundingClientRect(); const $12 = ($11.y < window.innerHeight - $11.height); if ($12) { $1.style['position'] = 'fixed'; $1.style['bottom'] = '0'; $1.style['left'] = '0'; $1.style['right'] = '0'; $1.style['z-index'] = '9999'; } const $13 = ( document.body.getBoundingClientRect().height < $11.height * 2 ); if ($13) { $1.style['display'] = 'none'; }
});</script></a></body>
</html>
