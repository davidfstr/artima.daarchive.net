
<!DOCTYPE html>

<html>
<head><meta content="noindex,nofollow" name="robots"/>
<title>The Adventures of a Pythonista in Schemeland/23</title>
<meta charset="utf-8"/>
<meta content="Michele Simionato" name="author">
<link href="../_/https/www.artima.com/artima.css" rel="stylesheet" type="text/css"/>
<link href="../_/https/www.artima.com/favicon.ico" rel="shortcut icon"/>
</meta></head>
<body><table cellspacing="0" width="100%">
<tr>
<td align="left" valign="bottom">
<a href="../_/https/www.artima.com/index.html"><img alt="The Artima Developer Community" border="0" height="43" src="../_/https/www.artima.com/images/a7.gif" width="550"/></a>
</td>
</tr></table>
<table bgcolor="#333333" width="100%">
<tr>
<td align="center">
<div class="ml">
<a class="hl" href="../_/https/www.artima.com/articles/index.html">Articles</a> |
<a class="hl" href="../_/https/www.artima.com/news/index.html">News</a> |
<a class="hl" href="../index.html">Weblogs</a> |
<a class="hl" href="../_/https/www.artima.com/shop/catalog/index.html">Books</a> |
<a class="hl" href="../_/https/www.artima.com/forums/index.html">Forums</a>
</div>
</td>
</tr>
</table>
<table bgcolor="#CCCCCC" width="100%">
<tr>
<td align="center">
<div class="sc">
<a href="../index.html">Artima Weblogs</a> | 

<a href="../index.html$/blogger=micheles.html">Michele Simionato's Weblog</a> | 

<a href="../_/https/www.artima.com/forums/flat.html$/forum=106&amp;thread=257998.html">Discuss</a> | 
<a href="mailto:?subject=The Adventures of a Pythonista in Schemeland/23&amp;body= %0AArtima Weblogs %0AThe Adventures of a Pythonista in Schemeland/23 %0Aby Michele Simionato %0A%0Ahttps://www.artima.com/weblogs/viewpost.jsp?thread=257998">Email</a> | 
<a href="../viewpostP.html$/thread=257998.html">Print</a> | 
<a href="../bloggers.html">Bloggers</a> | 
<a class="sl" href="thread=256848.html" title="The Adventures of a Pythonista in Schemeland/22">Previous</a> | 
<a class="sl" href="thread=258103.html" title="The Adventures of a Pythonista in Schemeland/24">Next</a>
</div>
</td>
</tr>
</table>
<table bgcolor="#EEEEEE" width="100%">
<tr>
<td align="center">
<div class="sc">
<span style="color: #555555;">Sponsored Link</span> <span style="color: #888888;">•</span>
<script language="JavaScript" src="../_/https/www.artima.com/zcr/adx.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
   if (!document.phpAds_used) document.phpAds_used = ',';
   phpAds_random = new String (Math.random()); phpAds_random = phpAds_random.substring(2,11);
   
   document.write ("<" + "script language='JavaScript' type='text/javascript' src='");
   document.write ("../_/https/www.artima.com/zcr/adjs.html$/n=.html" + phpAds_random);
   document.write ("&amp;what=zone:9&amp;target=_top");   document.write ("&amp;exclude=" + document.phpAds_used);
   if (document.referrer)
      document.write ("&amp;referer=" + escape(document.referrer));
   document.write ("'><" + "/script>");
//-->
</script><noscript><a href="../_/https/www.artima.com/zcr/adclick.html$/n=a799ecf6.html" target="_top"><img alt="" border="0" src="../_/https/www.artima.com/zcr/adview.html$/what=zone:9&amp;n=a0587811.html"/></a></noscript>
</div>
</td>
</tr>
</table>
<br/>
<div class="vegies">
<div class="tc">
<span class="sts">The Explorer</span><br>
<span class="ts">The Adventures of a Pythonista in Schemeland/23</span><br/>
<span class="as">by Michele Simionato</span><br/>
<span class="pd">May 19, 2009</span><br/>
</br></div>
<blockquote>
<b>Summary</b><br/>
In episode 19 I noticed that the R6RS module system allows for
separate compilation, but I have not mentioned the subtilities
associated with it. This episode discusses the topic, the concept of visit time and the intricacies of the "import" semantics.

</blockquote>
<hr align="left" width="90%"/>
<table align="right">
<tr>
<td>
<div class="adnotice">
Advertisement
</div>
<center>
<script language="JavaScript" src="../_/https/www.artima.com/zcr/adx.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
if (!document.phpAds_used) document.phpAds_used = ',';
phpAds_random = new String (Math.random()); phpAds_random = phpAds_random.substring(2,11);
document.write ("<" + "script language='JavaScript' type='text/javascript' src='");
document.write ("../_/https/www.artima.com/zcr/adjs.html$/n=.html" + phpAds_random);
document.write ("&amp;what=zone:2");
document.write ("&amp;exclude=" + document.phpAds_used);
if (document.referrer)
document.write ("&amp;referer=" + escape(document.referrer));
document.write ("'><" + "/script>");
//-->
</script><noscript><a href="../_/https/www.artima.com/zcr/adclick.html$/n=a74ab060.html" target="_blank"><img alt="" border="0" src="../_/https/www.artima.com/zcr/adview.html$/what=zone:2&amp;n=a74ab060.html"/></a></noscript>
</center>
</td>
</tr>
</table>
<p>
<h1 class="title">Separate compilation and import semantics</h1>
<p>Scheme is all about times: there is a run-time, an expand-time, and a
discrete set of times associated to the meta-levels. When
separate compilation is taken in consideration, there is also another set
of times: the times when the libraries are separately compiled.
Finally, if the separately compiled libraries define macros which are used
in client code, there is yet another set of times, the <em>visit times</em>.</p>
<img alt="../_/http/www.phyast.pitt.edu/~micheles/scheme/time.jpg" src="../_/http/www.phyast.pitt.edu/~micheles/scheme/time.jpg">
<p>To explain what the visit time is, suppose you have a low level
library <tt class="docutils literal"><span class="pre">L</span></tt>, compiled yesterday, defining a macro you want to use in
another middle level library <tt class="docutils literal"><span class="pre">M</span></tt>, to be compiled today. The compiler
needs to know about the macro defined in <tt class="docutils literal"><span class="pre">L</span></tt> at the time of the
compilation of <tt class="docutils literal"><span class="pre">M</span></tt>, because it has to expand code in
<tt class="docutils literal"><span class="pre">M</span></tt>. Therefore, the compiler must look at <tt class="docutils literal"><span class="pre">L</span></tt> and re-evaluate the
macro definition today (the process is called <em>visiting</em>). The visit
time is different from the time of the compilation of <tt class="docutils literal"><span class="pre">L</span></tt> as it
happens just before the compilation of <tt class="docutils literal"><span class="pre">M</span></tt>.</p>
<p>Here is a concrete example. Consider the following low level library
<tt class="docutils literal"><span class="pre">L</span></tt>, defining a macro <tt class="docutils literal"><span class="pre">m</span></tt> and an integer variable <tt class="docutils literal"><span class="pre">a</span></tt>:</p>
<pre class="literal-block">
#!r6rs
(library (experimental L)
(export m a)
(import (rnrs) (sweet-macros))
(def-syntax m
  (begin
    (display "visiting L\n")
    (lambda (x) #f)))
(define a 42)
(display "L instantiated\n")
)
</pre>
<p>You may compile it with PLT Scheme:</p>
<pre class="literal-block">
$ plt-r6rs --compile L.sls
 [Compiling /usr/home/micheles/gcode/scheme/experimental/L.sls]
visiting L
</pre>
<p>Since the right hand side of a macro definition is evaluated at
compile time the message <tt class="docutils literal"><span class="pre">visiting</span> <span class="pre">L</span></tt> is printed during compilation,
as expected.
Consider now the following middle level library <tt class="docutils literal"><span class="pre">M</span></tt> using the macro <tt class="docutils literal"><span class="pre">m</span></tt>:</p>
<pre class="literal-block">
#!r6rs
(library (experimental M)
(export a)
(import (rnrs) (experimental L))
(m); this line is expanded at compile-time
(display "M instantiated\n"); at run-time
)
</pre>
<p>In this example the compiler needs to visit <tt class="docutils literal"><span class="pre">L</span></tt> in order
to compile <tt class="docutils literal"><span class="pre">M</span></tt>. This is actually what happens:</p>
<pre class="literal-block">
$ plt-r6rs --compile M.sls
 [Compiling /usr/home/micheles/gcode/scheme/experimental/M.sls]
visiting L
</pre>
<p>If you comment out the line with the macro call, the compiler
does not need to visit <tt class="docutils literal"><span class="pre">L</span></tt> anymore; some implementations may take
advantage of this fact (Ypsilon and Ikarus do). However, PLT Scheme will
continue to visit <tt class="docutils literal"><span class="pre">L</span></tt> in any case.</p>
<div class="section">
<h1><a id="the-mysterious-import-semantics" name="the-mysterious-import-semantics">The mysterious import semantics</a></h1>
<p>It is time to ask ourselves the crucial question:
what does it mean to <em>import</em> a library?</p>
<p>For a Pythonista, things are very simple: importing a library means
executing it at run-time.  For a Schemer, things are somewhat complicated:
importing a library implies that some basic operations are performed at
compile time - such as looking at the exported identifiers and at the
dependencies of the library - but there is also a lot of unspecified
behavior which may happen both a compile-time and at run-time.
In particular at compile-time a library may be only visited,
i.e. its macro definitions can be re-evaluated - or can be
only instantiated, or both. Different things happens in different
situations and in the same situation different implementations
can perform different operations.</p>
<p>The example of the previous paragraph is useful in order to get a feeling
of what is portable behavior and what is not.
Let me first consider what happens in Ikarus.
If I want to compile <tt class="docutils literal"><span class="pre">L</span></tt> and <tt class="docutils literal"><span class="pre">M</span></tt> in Ikarus, I need to introduce
a helper script <tt class="docutils literal"><span class="pre">H.ss</span></tt>, since Ikarus has no direct way to compile
a library from the command line. Here is the script:</p>
<pre class="literal-block">
$ cat H.ss
</pre>
<pre class="literal-block">
#!r6rs
(import (rnrs) (experimental M))
(display a)
</pre>
<p>Here is what I get:</p>
<pre class="literal-block">
$ ikarus --compile-dependencies H.ss
visiting L
Serializing "/home/micheles/gcode/scheme/experimental/M.sls.ikarus-fasl" ...
Serializing "/home/micheles/gcode/scheme/experimental/L.sls.ikarus-fasl" ...
</pre>
<p>Ikarus is lazier than PLT: for instance, if you comment the
line invoking the macro in <tt class="docutils literal"><span class="pre">M.sls</span></tt> and you recompile the dependencies,
then the library <tt class="docutils literal"><span class="pre">M</span></tt> is not visited.</p>
<p>Both PLT and Ikarus do not instantiate <tt class="docutils literal"><span class="pre">L</span></tt> in order to compile
<tt class="docutils literal"><span class="pre">M</span></tt> (it is not needed) but Ypsilon does. You may check that if you
introduce a dummy macro in <tt class="docutils literal"><span class="pre">M</span></tt>, depending on the variable <tt class="docutils literal"><span class="pre">a</span></tt>
defined in <tt class="docutils literal"><span class="pre">L</span></tt> (for instance if you add a line <tt class="docutils literal"><span class="pre">(def-syntax</span>
<span class="pre">dummy</span> <span class="pre">(lambda</span> <span class="pre">(x)</span> <span class="pre">a))</span></tt>) then the library <tt class="docutils literal"><span class="pre">L</span></tt> must be instantiated
in order to compile <tt class="docutils literal"><span class="pre">M</span></tt>, and all implementations do so.</p>
<p>Let us consider the peculiarities of Ypsilon, now.
Ypsilon does not have a switch to compile a library without
executing it - even if this is possible by invoking the low level
compiler API - so we must execute <tt class="docutils literal"><span class="pre">H.ss</span></tt> to compile its dependencies:</p>
<pre class="literal-block">
$ ypsilon --r6rs H.ss
L instantiated
visiting L
M instantiated
42
</pre>
<p>There are several things to notice here, since the output of Ypsilon is
quite different from the output of Ikarus</p>
<pre class="literal-block">
$ ikarus --r6rs-script H.ss
L instantiated
42
</pre>
<p>and the output of PLT:</p>
<pre class="literal-block">
$ plt-r6rs H.ss
visiting L
visiting L
L instantiated
M instantiated
42
</pre>
<p>The first thing to notice is that both in Ikarus and in PLT we relied on the
fact that the libraries were precompiled, so in order to perform a fair
comparison we must run Ypsilon again (this second time the libraries
L and M will be precompiled):</p>
<pre class="literal-block">
$ ypsilon --r6rs H.ss
L instantiated
M instantiated
42
</pre>
<p>You my notice that this time the library <tt class="docutils literal"><span class="pre">L</span></tt> is not visited: it was visited
the first time, in order to compile <tt class="docutils literal"><span class="pre">M</span></tt>, but there is no need
to do so now. During compilation of <tt class="docutils literal"><span class="pre">M</span></tt> macros has been expanded and
the byte-code of <tt class="docutils literal"><span class="pre">M</span></tt> contains the expanded version of the library; moreover
the helper script <tt class="docutils literal"><span class="pre">H</span></tt> does not use any macro so it does not really need
to visit <tt class="docutils literal"><span class="pre">L</span></tt> or <tt class="docutils literal"><span class="pre">M</span></tt> to be compiled. The same happens for Ikarus.
PLT instead visits <tt class="docutils literal"><span class="pre">L</span></tt> twice
to compile <tt class="docutils literal"><span class="pre">H.ss</span></tt>. In PLT all dependencies (both direct and indirect)
are always visited when compiling. Only if we compile
the script once and for all</p>
<pre class="literal-block">
$ plt-r6rs --compile H.ss
 [Compiling /usr/home/micheles/gcode/scheme/experimental/H.ss]
 [Compiling /home/micheles/.plt-scheme/4.1.5.5/collects/experimental/M.sls]
visiting L
visiting L
</pre>
<p>the <tt class="docutils literal"><span class="pre">visiting</span> <span class="pre">L</span></tt> message will not be printed:</p>
<pre class="literal-block">
$ plt-r6rs H.ss
L instantiated
M instantiated
42
</pre>
</div>
<div class="section">
<h1><a id="more-implementation-dependent-details" name="more-implementation-dependent-details">More implementation-dependent details</a></h1>
<p>Having performed the right number of compilations now
the output of PLT and Ypsilon are the same; nevertheless, the output of
Ikarus is different, since Ikarus does not instantiate the middle level
library <tt class="docutils literal"><span class="pre">M</span></tt>. The reason is the <em>implicit phasing</em> semantics of Ikarus
(other implementations based on psyntax would exhibit the same behavior): the
helper script <tt class="docutils literal"><span class="pre">H.ss</span></tt> is printing the variable <tt class="docutils literal"><span class="pre">a</span></tt> which really
comes from the library <tt class="docutils literal"><span class="pre">L</span></tt>. Ikarus is clever enough to recognize this
fact and lazy enough to avoid instantiating <tt class="docutils literal"><span class="pre">M</span></tt> without
need.</p>
<p>On the other hand, Ypsilon performs eager instantiation and it
instantiates (once) all the libraries it imports
(both directly and indirectly), even at compile time and even in situations
when the instantiation would not be needed for compilation of the client
library. As you see, Scheme implementations have a lot of latitude in
such matters.</p>
<p>The implementations based on psyntax are the smartest out there, but
begin smart is not always the same thing as being good.
It is good to avoid instantiating a library if the instantiation is
really unneeded; it is bad if the library has some side effect, since
the side effect will mysteriously disappear. In our example the side
effect is just printing the message <tt class="docutils literal"><span class="pre">M</span> <span class="pre">instantiated</span></tt>, in more
sophisticated examples the side effect could be writing a log on a
database, or initializing some variable, or registering an object, or
something else.</p>
<p>For instance, suppose you want to collect a bunch of
functions into a global registry acting as a dictionary of functions.
You may do so as follows:</p>
<pre class="literal-block">
(library (my-library)
(export)
(import (registry))

(registry-set! 'f1 (lambda (x) 'something1))
(registry-set! 'f2 (lambda (x) 'something2))
...
)
</pre>
<p>The library here does not export anything, since it relies on side
effects to populate the global registry of functions; the idea is to
access the functions later, with a call of kind <tt class="docutils literal"><span class="pre">(registry-ref</span>
<span class="pre">&lt;func-name&gt;)</span></tt>.  This design as it is is not always portable to
systems based on psyntax, because such systems will not instantiate
the library (the library does not export any variable, nothing of the
library can be used in client code!).  This can easily be fixed, by
introducing an initialization function to be exported and called
explicitly from client code, which is a good idea in any case.</p>
<p>Analogously, a library based on side effects at visit time,
i.e. in the right hand side of macro definitions, is not portable,
since systems based on psyntax will not visit a library with
macros which are not used. This is relevant if you want to use the
technique described in the <a class="reference" href="../_/http/www.cs.utah.edu/plt/publications/macromod.pdf">You want it when?</a> paper: in order
to make sure that the technique work on systems based on psyntax, you
must make sure that the library exports at least one macro which
is used in client code. Curious readers will find the gory
details <a class="reference" href="../_/http/groups.google.com/group/plt-scheme/browse_frm/thread/c124fa9c48dc5b6a$/hl=en/index.html">in this thread</a> on the PLT mailing list.</p>
<p>Generally speaking, you cannot
rely on the number of times a library will be instantiated,
even within the <em>same</em> implementation!
Abdulaziz Ghuloum gave a nice example in the Ikarus and PLT lists. You
have the following libraries:</p>
<pre class="literal-block">
(library (T0) (export) (import (rnrs)) (display "T0\n"))
(library (T1) (export) (import (for (T0) run expand)))
(library (T2) (export) (import (for (T1) run expand)))
(library (T3) (export) (import (for (T2) run expand)))
</pre>
<p>and the following script:</p>
<pre class="literal-block">
#!r6rs
(import (T3))
</pre>
<p>Running the script (without precompilation) results in printing T0:</p>
<pre class="literal-block">
0 times for Ikarus and Mosh
1 time for Larceny and Ypsilon
10 times for plt-r6rs
13 times for mzscheme
22 times for DrScheme
</pre>
<p>T0 is not printed in psyntax-based implementations, since it does not export
any identifier that can be used. T0 is printed once in Larceny and Ypsilon
since they are single instantiation implementations with eager import.
The situation in PLT Scheme is subtle, and you can find a detailed explanation
of what it is happening <a class="reference" href="../_/http/groups.google.com/group/ikarus-users/msg/7df9b8800141610c$/hl=en/index.html">in this other thread</a>. Otherwise, you will have to
wait for the next (and last!) episode of this series, where I will explain
the reason why PLT is instantiating (and visiting) modules so many times.</p>
</div>
<h1>Talk Back!</h1>
<p>
Have an opinion?


Be the first to

<a href="../_/https/www.artima.com/forums/post.html$/forum=106&amp;thread=257998&amp;reply=true.html">post a comment</a> about
this weblog entry.


<h1>RSS Feed</h1>
<p>
If you'd like to be notified whenever Michele Simionato adds a new entry to <a href="../index.html$/blogger=micheles.html">his weblog</a>, subscribe to his <a href="../feeds/bloggers/micheles.rss">RSS feed</a>.

<center>
<div class="sociallinks">
<a href="../_/http/digg.com/submit$/phase=2&amp;url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D257998&amp;title=The+Adventures+of+a+Pythonista+in+Schemeland%2F23&amp;bodytext=In+episode+19+I+noticed+that+the+R6RS+module+system+allows+for%0D%0Aseparate+compilation%2C+but+I+have+not+mentioned+the+subtilities%0D%0Aassociated+with+it.+This+episode+discusses+the+topic%2C+the+concept+of+visit+time+and+the+intricacies+of+the+_&amp;topic=programming">
<img alt="Digg" border="0" height="14" hspace="8" src="../_/https/www.artima.com/images/digg.gif" width="16">Digg
  </img></a>
  |
  <a href="../_/http/del.icio.us/post$/url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D257998&amp;title=The+Adventures+of+a+Pythonista+in+Schemeland%2F23">
<img alt="del.icio.us" border="0" height="16" hspace="8" src="../_/https/www.artima.com/images/delicious.gif" vspace="1" width="16"/>del.icio.us
  </a>
  |
  <a href="../_/http/programming.reddit.com/submit$/url=http%3A%2F%2Fwww.artima.com%2Fweblogs%2Fviewpost.jsp%3Fthread%3D257998&amp;title=The+Adventures+of+a+Pythonista+in+Schemeland%2F23">
<img alt="Reddit" border="0" height="18" hspace="8" src="../_/https/www.artima.com/images/reddit.gif" width="18"/>Reddit
  </a>
</div>
</center>
<h1>About the Blogger</h1>
<p>
<table><tr valign="bottom"><td><img align="right" src="../_/https/www.artima.com/images/micheleSimionato.jpg"/></td><td>Michele Simionato started his career as a Theoretical Physicist, working in Italy, France and the U.S. He turned to programming in 2003; since then he has been working professionally as a Python developer and now he lives in Milan, Italy. Michele is well known in the Python community for his posts in the newsgroup(s), his articles and his Open Source libraries and recipes. His interests include object oriented programming, functional programming, and in general programming metodologies that enable us to manage the complexity of modern software developement.</td></tr></table><p>
<div class="sp">This weblog entry is Copyright © 2009 Michele Simionato. All rights reserved.</div>
</p></p></p></p></img></p></div>

<hr width="100%">
<table align="center" width="50%">
<tr>
<td>
<div class="horizontaltextadbox">
<div class="adheadline">Sponsored Links</div>
<div id="sponsoredlinks">
</div>
</div>
</td>
</tr>
</table>
<hr width="100%"/>
<center>
<script type="text/javascript"><!--
google_ad_client = "pub-3911176865765226";
google_alternate_color = "ffffff";
google_ad_width = 728;
google_ad_height = 15;
google_ad_format = "728x15_0ads_al";
google_ad_channel = "";
google_color_border = "ffffff";
google_color_bg = "FFFFFF";
google_color_link = "003090";
google_color_text = "000000";
google_color_url = "666666";
//--></script>
<script src="../_/https/pagead2.googlesyndication.com/pagead/show_ads.js" type="text/javascript">
</script>
<br>
<br/>
<!-- SiteSearch Google -->
<form action="../_/https/www.google.com/custom/index.html" method="get">
<table bgcolor="#ffffff" border="0">
<tr><td align="left" height="32" nowrap="nowrap" valign="top">
<a href="../_/https/www.google.com/index.html">
<img alt="Google" border="0" src="../_/https/www.google.com/logos/Logo_25wht.gif"/></a>
</td>
<td nowrap="nowrap">
<input name="domains" type="hidden" value="Artima.com"/>
<input maxlength="255" name="q" size="31" type="text" value=""/>
<input name="sa" type="submit" value="Search"/>
</td></tr>
<tr>
<td> </td>
<td nowrap="nowrap">
<font color="#000000" size="-1">
<input name="sitesearch" type="radio" value=""/> Web
<input checked="checked" name="sitesearch" type="radio" value="Artima.com"/>Artima.com
</font>  
<input name="client" type="hidden" value="pub-3911176865765226"/>
<input name="forid" type="hidden" value="1"/>
<input name="ie" type="hidden" value="ISO-8859-1"/>
<input name="oe" type="hidden" value="ISO-8859-1"/>
<input name="cof" type="hidden" value="GALT:#008000;GL:1;DIV:#336699;VLC:663399;AH:center;BGC:FFFFFF;LBGC:FFFFFF;ALC:0000FF;LC:0000FF;T:000000;GFNT:0000FF;GIMP:0000FF;LH:50;LW:150;L:https://www.artima.com/images/artima150.gif;S:https://www.artima.com;FORID:1;"/>
<input name="hl" type="hidden" value="en"/>
</td></tr></table>
</form>
<!-- SiteSearch Google -->
</br></center>
<br/>
<div class="sp">
<div style="text-align: center;">
<a href="../_/https/www.artima.com/copyright.html">Copyright</a> © 1996-2019 Artima, Inc. All Rights Reserved. - <a href="../_/https/www.artima.com/privacy.html">Privacy Policy</a> - <a href="../_/https/www.artima.com/termsofuse.html">Terms of Use</a>
</div>
</div>
<br/>
<script language="JavaScript" type="text/javascript">
<!--
function initBannerVarForZone(zone) {
        initBannerVarForZoneWithScript(zone, 'adjs_modified');
}

function initBannerVarForZoneWithScript(zone, phpScript) {

        if (!document.phpAds_used) document.phpAds_used = ',';
        phpAds_random = new String (Math.random());
        phpAds_random = phpAds_random.substring(2,11);

        var nextScriptSrc = '../_/https/www.artima.com/zcr/index.html' + phpScript + '.php?n=' +
                phpAds_random  +
                '&amp;what=zone:' + zone + '&amp;target=_top&amp;block=1&amp;blockcampaign=1' +
                '&amp;exclude=' + document.phpAds_used;

        document.write("<script language='JavaScript' type='text/javascript' src='");
        document.write(nextScriptSrc);
        document.write("'><\/script>");

}

function replaceDiv(divID) {
        document.getElementById(divID).innerHTML = phpadsbanner;
}
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
initBannerVarForZone(3);
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
replaceDiv('leftskyscraper');
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
initBannerVarForZoneWithScript(4, 'textman');
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
replaceDiv('sponsoredlinks');
-->
</script>
</hr><a href="https://dafoster.net/projects/crystal-web-archiver/" id="cr-footer-banner" style="border-top: 2px #B40010 solid;background: #FFFAE1;font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;font-variant: initial;font-weight: initial;text-transform: none;font-size: 14px;color: #6c757d;line-height: 2.0;cursor: pointer;display: flex;align-items: center;justify-content: center;gap: 4px;clear: both;" target="_blank"><img height="24" onerror="this.style['display'] = 'none';" src="../_/crystal/resources/appicon.png" width="24"/><span>This page was archived with Crystal</span><script>window.addEventListener('load', function() { const $1 = document.querySelector('#cr-footer-banner'); if (!$1) { return; } if (window !== window.top) { let $2 = false; if (window.name) { const $3 = window.parent.document.getElementsByName(window.name); if ($3.length === 1) { const $4 = $3[0]; if ($4.tagName === 'FRAME' && $4.parentElement.tagName === 'FRAMESET') { let $5 = $4; while (true) { if ($5.parentElement.tagName !== 'FRAMESET') { $2 = true; break; } if ($5.parentElement.attributes['rows'] !== undefined) { const $6 = $5.parentElement.children; if ($5 === $6[$6.length - 1]) { $5 = $5.parentElement; continue; } else { break; } } else if ($5.parentElement.attributes['cols'] !== undefined) { const $7 = Array.from($5.parentElement.children); const $8 = $7.indexOf($5); if ($8 === -1) { break; } const $9 = $5.parentElement.attributes['cols'].value.split(','); const $10 = $9.map((s) => parseInt(s.trim())); if ($9[$8].trim() === '*' || $10[$8] === Math.max.apply(null, $10)) { $5 = $5.parentElement; continue; } else { break; } } else { break; } } } } } if (!$2) { $1.style['display'] = 'none'; } } const $11 = $1.getBoundingClientRect(); const $12 = ($11.y < window.innerHeight - $11.height); if ($12) { $1.style['position'] = 'fixed'; $1.style['bottom'] = '0'; $1.style['left'] = '0'; $1.style['right'] = '0'; $1.style['z-index'] = '9999'; } const $13 = ( document.body.getBoundingClientRect().height < $11.height * 2 ); if ($13) { $1.style['display'] = 'none'; }
});</script></a></body>
</html>
